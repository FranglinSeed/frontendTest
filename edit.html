
<!-- saved from url=(0129)https://localhost:8443/sunbase/index.jsp?nomenu=1&page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="stylesheet" type="text/css" href="./edit_files/foundation.css">
<link rel="stylesheet" type="text/css" href="./edit_files/notification.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />-->
<link rel="stylesheet" type="text/css" href="./edit_files/bootstrap.css">       

<link rel="stylesheet" type="text/css" href="./edit_files/croppie.min.css">
<script src="./edit_files/croppie.min.js.download"></script>
<script src="./edit_files/html2canvas.min.js.download"></script>


  
  
 
  
  <style>

.ui-dialog-titlebar {
    background: teal !important;
    height: 35px;
}

#newJob {
	overflow:hidden;
}
.detailForm2 * label {
    width: unset;
    font-size: 14px !important;
	padding-right:5px;
}
.ui-dialog-buttonset > button
{
    padding: 5px 25px;
    background: #215ca0;
	color:white;
	padding: 6px 30px 25px 25px;
    font-size: 1em;
}
 
  .prettyForm * input[type='checkbox'] {
  position: relative;
  outline: none !important;
  width: 30px;
  height: 25px;
  transition: .4s;
}
 
  
/* cyrillic-ext */
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 400;
  src: local('Montserrat Regular'), local('Montserrat-Regular'), url(font/montserrat/JTUSjIg1_i6t8kCHKm459WRhyzbi.woff2) format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
/* cyrillic */
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 400;
  src: local('Montserrat Regular'), local('Montserrat-Regular'), url(font/montserrat/JTUSjIg1_i6t8kCHKm459W1hyzbi.woff2) format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
/* vietnamese */
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 400;
  src: local('Montserrat Regular'), local('Montserrat-Regular'), url(font/montserrat/JTUSjIg1_i6t8kCHKm459WZhyzbi.woff2) format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
/* latin-ext */
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 400;
  src: local('Montserrat Regular'), local('Montserrat-Regular'), url(font/montserrat/JTUSjIg1_i6t8kCHKm459Wdhyzbi.woff2) format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
/* latin */
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 400;
  src: local('Montserrat Regular'), local('Montserrat-Regular'), url(font/montserrat/JTUSjIg1_i6t8kCHKm459Wlhyw.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}



body {
    font-family: 'Montserrat';font-size: 22px;
}
#resetBtn img {
	margin-top: 4px;
}
  
#advancedSearchForm1 {
  position:absolute;
  right:0;
  height: auto;
  width: 1px;
  top:250px;
  opacity: 0;
  z-index:0;
   -moz-transition: background 0.75s linear; /* Firefox 4 */
    -webkit-transition: background 0.75s linear; /* Safari and Chrome */
    -o-transition: background 0.75s linear; /* Opera */
    -ms-transition: background 0.75s linear; /* Explorer 10 */
	transition: all .75s ease;
}

#advancedSearchForm1.show {
  opacity: 1;
  height: auto;
  width: 600px;
  position:absolute;
  right:0;
  z-index:600;
  top:250px;
  border:1px;
  border-style:groove;
  overflow-y:scroll;

}

#advancedSearchForm1 fieldset {
	background: white;
	margin-bottom: 0px;
}
  
.blue-btn {
	background-color: #4DB5F0;
} 
.blue-btn-dis {
	background-color: #8BA8B9;
} 
.red-btn {
	background-color: #F05651;
} 
.red-btn-dis {
	background-color: #A9504D;
} 

.btn8-dialer {
    display: block;
    background: #5cbcf6;
    outline: 1px solid transparent;
    -webkit-transform-style: preserve-3d;
    -moz-transform-style: preserve-3d;
    transform-style: preserve-3d;
}
.btn-dialer {
    border: none;
    font-family: inherit;
    font-size: inherit;
    color: white;
    cursor: pointer;
    display: inline-block;
    font-weight: 700;
	min-width:150px;
    outline: none;
    position: relative;
    -webkit-transition: all 0.3s;
    -moz-transition: all 0.3s;
    transition: all 0.3s;
}

img{
    -khtml-user-select: none;
    -o-user-select: none;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
}
.btnbox {
    background-color: white; /* blue */
    border: none;
    color: #008CBA;
    padding: 5px 12px;
	height:80px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 12px;
}
input.text { margin-bottom:12px; width:95%; padding: .4em; }

img.action {
	vertical-align: bottom;
	height: 15px;
	margin-top: -1px;
	margin-bottom: -1px;
	margin-left: 3px;
}

fieldset { padding:0; border:0; margin-top:25px; }
h1 { font-size: 1.2em; margin: .6em 0; }
div#users-contain { width: 350px; margin: 20px 0; }
div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left; }
.ui-dialog .ui-state-error { padding: .3em; }
.validateTips { border: 1px solid transparent; padding: 0.3em; }


.badge1 {
   position:relative;
}
.badge1[data-badge]:after {
   content:attr(data-badge);
   position:absolute;
   top:17px;
   right:-1px;
   font-size:.7em;
   background:yellow;
   color:black;
   width:18px;height:18px;
   text-align:center;
   line-height:18px;
   font-weight:bold;
   border-radius:50%;
   box-shadow:0 0 1px #333;
}
.removeFilterButton {
                background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #7892c2), color-stop(1, #476e9e));
                background:-moz-linear-gradient(top, #7892c2 5%, #476e9e 100%);
                background:-webkit-linear-gradient(top, #7892c2 5%, #476e9e 100%);
                background:-o-linear-gradient(top, #7892c2 5%, #476e9e 100%);
                background:-ms-linear-gradient(top, #7892c2 5%, #476e9e 100%);
                background:linear-gradient(to bottom, #7892c2 5%, #476e9e 100%);
                filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#7892c2', endColorstr='#476e9e',GradientType=0);
                background-color:#7892c2;
                border:1px solid #4e6096;
                display:inline-block;
                cursor:pointer;
                color:#ffffff;
                padding:0px 8px; 0px 0px;

                text-decoration:none;
                text-shadow:0px 1px 0px #103db0;
}



input[type=currency],input[type=text], textarea
{
	-webkit-transition: all 0.30s ease-in-out;
	-moz-transition: all 0.30s ease-in-out;
	-ms-transition: all 0.30s ease-in-out;
	-o-transition: all 0.30s ease-in-out;
	outline: none;
	-moz-box-shadow: 2px 2px 3px #666;

	font-size: 18px;
	x-moz-border-radius: 10px;
	x-webkit-border-radius: 10px;
	-webkit-appearance: none;
	padding: 0px 0px 0px 3px;


	border: 1px solid #DDDDDD;
	#box-shadow: 1px 1px 1px #666;
	
	
}

input[type=currency]:focus,input[type=text]:not(.material):focus, textarea:focus
{
	box-shadow: 0 0 5px rgba(81, 203, 238, 1);
	padding: 0px 0px 0px 3px;
	border: 1px solid rgba(81, 203, 238, 1);
}

select
{
}

select:focus
{
	box-shadow: 0 0 5px rgba(81, 203, 238, 1);
#	padding: 0px 7px;
	border: 1px solid rgba(81, 203, 238, 1);
}
table tbody tr td { color: #333; padding: 2px 10px; vertical-align: top; border: none; }

label
{
	width: 200px;
}
.tab_control {
	width:100%	; 
	height:860px
}

div.grouplistbox{float:left}
ul.grouplist{float:left;padding:0px;margin:0px;margin-top:2px;border:1px solid #a5acb2;overflow:auto;overflow-x:hidden;overflow-y:auto;width:80%;height:275px;line-height:25px;background-color:white}
ul.grouplist2 label{display:block;width:100%}
ul.grouplist label:hover{background-color:#efefef}h1{font-size:25px;line-height:28px}
ul.grouplist label { padding-right: unset !important; text-align:left !important }

.searchblock{padding-right:20px}
.nowrap{white-space:nowrap}

.grid-menu a {
    width: 15%;
	min-height:125px;
	min-width:100px;
    letter-spacing: normal;
    display: inline-block;
    text-align: center;
    text-decoration: none;
    #border-top: 0px solid rgb(212,212,212);
	#border-bottom: 1px solid rgb(212,212,212);
    #border-right: 1px solid rgb(212,212,212);
    padding: 5px;
  font-size: small;
  color: #444;
}

.grid-menu a:hover {
  background-color: #e6e6ff;
}

.grid-menu img {
    width: 25%;
	min-width: 100px;
	
    letter-spacing: normal;
    display: inline-block;
    text-align: center;
    text-decoration: none;
    padding: 5px;
  font-size: small;
  color: #444;
}


.detailFS {
	
}

.detailForm {
	width:100%;
}

.detailForm tr td label {
	width:225px;
	font-size: 1rem;
	font-weight: bold;
	padding-right: 20px;
	text-align: right;
	font-family: Montserrat;
}		
		.btn
		{
			height: 38px;
			min-width:50px;
		}

.ui-tabs-panel { width: calc(100% - 160px) !important; }


.gray-sec * .btn { 
	border:1px solid white !important;
}

/* fallback */
@font-face {
  font-family: 'Material Icons';
  font-style: normal;
  font-weight: 400;
  src: url(fonts/material.woff2) format('woff2');
}

.material-icons {
  font-family: 'Material Icons';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;
}
		
</style>		
	<link rel="icon" type="image/ico" href="https://localhost:8443/sunbase/favicon.ico">
	<link rel="stylesheet" href="./edit_files/font.awesome.css">
<link rel="stylesheet" href="./edit_files/chat.css">
<link rel="stylesheet" href="./edit_files/std.css">
<link rel="stylesheet" href="./edit_files/jquery.chatjs.css">


	

		
 <link rel="stylesheet" type="text/css" media="all" href="./edit_files/nav_filter.css">
<link rel="stylesheet" type="text/css" href="./edit_files/breadcrumbs.css">
	<script>

var userList = null;
		var callStack = [];
		var current_url_Address = "";
		
function loadNotificationsHistory()
{
	window.open("index.jsp?nomenu=1&page=modules/common/notification_hist_form.jsp").focus();
}
		

		function showProfileMenu()
		{
			hideQuickAdd();
			var X=$(this).attr('id');
			if(X==1)
			{
				$(".submenu").hide();
				$(this).attr('id', '0'); 
			}
			else
			{
				$(".submenu").show();
				$(this).attr('id', '1');
			}
			
		}
	
		function printScreen()
		{
		    html2canvas(document.body, 
			{
			  onrendered: function (canvas) {
				var a = document.createElement('a');
				// toDataURL defaults to png, so we need to request a jpeg, then convert for file download.
				a.href = canvas.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream");
				a.download = 'screenshot.jpg';
				a.click();
			  }
			});
		}
		
		function captureScreen()
		{
		    html2canvas(document.body, 
			{
			  onrendered: function (canvas) {
				var a = document.createElement('a');
				// toDataURL defaults to png, so we need to request a jpeg, then convert for file download.
				a.href = canvas.toDataURL("image/jpeg").replace("image/jpeg", "image/octet-stream");
				a.download = 'screenshot.jpg';
				a.click();
			  }
			});
		}

		function onPostLoad(page)
		{
/*			if ( page.indexOf("lead_") != -1 )
			{
				$("#favoriteLink").addClass('fa-star')
				$("#favoriteLink").removeClass('fa-star-o')
			}
			else
			{
				$("#favoriteLink").addClass('fa-star-o')
				$("#favoriteLink").removeClass('fa-star')
			}
*/			
		}
		function dialLeadManual(phone)
		{
			if ( typeof dialLeadManualReal === "function" ) {
				dialLeadManualReal(phone);
			}
			else {
				xdWarn("Dialer must be opened");
			}
		}
		function saveAsFavorite()
		{
			if ( document.getElementById("content").style.display != "none" )	
			{
				var page = document.getElementById("current_content").value;
				//console.log("page " + page );
				if ( page != "" )
					window.open("index.jsp?page=modules/common/add_favorite.jsp%3Flink=" + escape(page), "Edit" );
			}			
			else
			{
				xdWarn("Can not add menu to favorite");
			}
		}		

		function setQType(type)
		{
			document.getElementById('qsearchType').innerHTML="<img style='width:32px' src='img/" + type + "'/>"			
			$('#qsearchTypeType').hide();
		}
		function checkAppts()
		{
			setTimeout(checkAppts, 60000 * 15);

			var url = 'portal/api/appt_reminders_cmd.jsp?token=sz6hjZjvOsX3d4BWGKF9ZEV4I0cw26yv6nDTowsYk%2FIKLCY9CtDsfMekQ243nGrRZr%2F9aKONvBO0%0D%0As6p7iRckDg%3D%3D';
			fetch(url).then(function(response) 
			{
			  return response.text();
			}).then(function(data) {
					console.log("Count " + data );
					if ( data.indexOf("count=") != -1 )
					{
						data= data.substring( "count=".length ).trim();
						setNotifyCount( parseInt(data) );
					}
			}).catch(function() {
			  console.log("Error check appts");
			});
/*
			$.ajax({
				url: "modules/common/appt_reminders_cmd.jsp",
				type: "POST",
				dataType : 'text',
			 
				success: function( response ) {
					if ( response != null && response.indexOf("1") != -1 )
					{
						xdInfo("Appointment comming up, click on notification to see it");
						setTimeout( recount, 200 );
					}
				}			 
			});    
*/
			//appt_reminders_cmd.jsp
		}
		
		function addHistory(path)
		{
			current_url_Address = path;
			callStack.push(path);
			if ( callStack.length > 50 )
			{
				callStack.shift();
			}
			history.pushState(path, null, null);
		}
		function stepBack()
		{
			if ( document.getElementById("content").style.display == "none" )	
			{
				returnToMain();
			}
			else
			{
				var url = ( callStack.length > 0 ? callStack.pop() : null );
				if ( url == current_url_Address )
				{
					url = ( callStack.length > 0 ? callStack.pop() : null );
				}
				if ( url == null )
					loadMobileMenu();
				else
				{
					spaNavigatePageNoHistory(url);
				}
			}
		}

		function checkQuickSearchEnter(e)
		{ //e is event object passed from function invocation
			var characterCode; //literal character code will be stored in this variable

			$('#qsearchTypeType').hide();
			if(e && e.which){ //if which property of event object is supported (NN4)
				e = e;
				characterCode = e.which; //character code is contained in NN4's which property
			}
			else
			{
				e = event;
				characterCode = e.keyCode; //character code is contained in IE's keyCode property
			}

			if(characterCode == 13)
			{ //if generated character code is equal to ascii 13 (if enter key)
		
		
				if ( document.getElementById('qsearchType').innerHTML.indexOf('img/customer.png') !== -1 )
					navigateMenuItem('modules/crm/allcustomers_form.jsp?quick=' + document.getElementById('searchTextBox').value );
				else
					navigateMenuItem('modules/dispatch/servicecall_form.jsp?quick=' + document.getElementById('searchTextBox').value );
				return false;
			}
			else
			{
				return true
			}
		}

		function xdError(msg)
		{
			$.growl.error({ message: msg});
		}
		function xdInfo(msg)
		{
			$.growl.notice({ message: msg});
		}
		function xdWarn(msg)
		{
			$.growl.warning({ message: msg });
		}
		function xdConfirm(msg)
		{
			var statesdemo = {
				state0: {
					html:html,
					title: msg,
					buttons: { "Confirm": true, "Cancel": false },
					submit:function(e,v,m,f){ 
							return ( v == true )			
					}// end of submit
				  }
			}
			if ( statesdemo != null )
				$.prompt(statesdemo);
		}
		function editLookup(type, look)
		{
			if ( type == 'lookup_names' )
			{
				window.open( "/sunbase/index.jsp?nomenu=1&page=/modules/zadmin/lookup_names_form.jsp" );
			}
			else if ( type == 'lookup' )
			{
				// open edit window.
				if ( look == '' )
				{
					$.growl.error({ message: "Sorry this is a hard coded list" });
				}
				else
				{
					window.open( "/sunbase/index.jsp?nomenu=1&page=modules/zadmin/lookup_codes_form.jsp%3Fname_code=" + look );
				}
			}
			else if ( type == 'payee' )
			{
				// open edit window.
				window.open("/sunbase/index.jsp?nomenu=1&page=modules/invoice/payee_form.jsp" );
			}
			else if ( type == 'event' )
			{
				// open edit window.
				window.open("/sunbase/index.jsp?nomenu=1&page=modules//marketing/event_form.jsp" );
			}
			else
			{
				$.growl.error({ message: "Unknown edit type " + look + " " + type });
			}
		}

		window.onbeforeunload = function() {
			if ( typeof onBeforeUnload === "function" )
			{
				onBeforeUnload();
			}
//			return "Clicking refresh on the browser will take you back to the main screen, use the refresh button instead";
		}
		
		
		addHistory("");
		window.addEventListener('popstate', function(e) {
			var location = e.state;
			console.log("loc " + location );
			if ( location != null && location.length > 0 )
			{
				spaNavigatePageNoHistory(location);
			}
			else
			{
				addHistory("");
				if ( document.getElementById("content").style.display == "none" )	
				{
					returnToMain();
				}
				else if ( window.location.href.indexOf("nomenu=") == -1 )
					loadMobileMenu();

//				if ( confirm("Are you sure you want to exit the application") )
//					window.history.back();
			}
		});
		
	function closeTabWindow()
	{
		window.close();

	}		
	
	function flexReloadList(name)
	{
		$('.' + name ).flexReload();
	}
	
	var showSavePin = false;
	var pins = new Array();
	
	function savePin(pinName, pinImage, pinTooltip)
	{
		removePinForce(pinName);
		var pin = { name: pinName, tooltip: pinTooltip, image: pinImage }
		
		showSavePin = true;
		pins.push( pin );
		renderPins();
	}
	
	function removePin(pinName)
	{
		$.prompt("Are you sure you want to remove this shortcut?", {
			title: "Confirm Shortcut Removal",
			buttons: { "Yes": true, "No": false },
			submit: function(e,v,m,f){
				if ( v == true )
				{
					removePinForce(pinName);
					showSavePin = true;									
					renderPins();
				}
			}							
		});											
	}	
	function removePinForce(pinName)
	{
		for ( var i = pins.length-1; i >= 0; --i )
		{
			if ( pins[i]['name'] == pinName )
			{
				pins.splice(i,1);
				showSavePin = true;									
				renderPins();
			}
		}
	}
	
	function savePinData()
	{
		cmd = ( pins.length == 0 ? "delete" : "save");
		$.ajax({
			url: "modules/common/save_pins.jsp?cmd=" + cmd + "&data=" + escape(JSON.stringify( pins )),
			type: "POST",
			dataType : 'text',
		 
			success: function( response ) {
				showSavePin = false;
				renderPins();
			}			 
		});    		
	}
	function renderPins()
	{
		if ( pins == null || pins.length == 0 )
		{
			document.getElementById('pinBox').style.height = '0px';
		}
		else
			document.getElementById('pinBox').style.height = '30px';
		var data = '';
		for ( var i = 0; i < pins.length; ++i )
		{
			data += "<a href='#' onContextMenu=\"removePin('" + pins[i].name + "'); return false;\" onclick=\"invokePin('" + pins[i].name + "'); return false;\"><img title='" + pins[i].tooltip + "' width='30px' src='" + pins[i].image + "'/></a>";
		}		
		
		if ( showSavePin )
			data += "<a style='float:right' href='#' onclick=\"savePinData(); return false;\"><img title='Save shortcut data' width='30px' src='img/save.jpg'/></a>";
		document.getElementById('pinBox').innerHTML = data;
	}
	
	function invokePin(name)
	{
		var img = document.getElementById(name);
		if ( img != null )
			img.click();
		else
		{
			$.prompt("Shortcut does not exist anymore should we remove and save shortcuts?", {
				title: "Confirm",
				buttons: { "Yes": true, "No": false },
				submit: function(e,v,m,f){
					if ( v == true )
					{
						removePinForce(name);
						savePinData();
						showSavePin = false;
					}
				}							
			});											
		}
	}

	function loadEmailTemplateText()
	{
		var select = document.getElementById('emailTemplate');
		if ( select.value.trim() !== '' )
		{
			// get the content
			$.ajax({
				url: "modules/plugins/webmail/email_template.jsp?cmd=template_text&key=" + select.value,
				type: "POST",
				dataType : 'text',
			 
				success: function( response ) {
					document.getElementById('msgbody').innerHTML = response;
				}			 
			});    
		}		
	}
	function loadEmailTemplates(name)
	{
		var select = document.getElementById(name);
		if ( select.options.length === 0 )
		{
			// fetch the list
			$.ajax({
				url: "modules/plugins/webmail/email_template.jsp?cmd=list_templates",
				type: "POST",
				dataType : 'text',
			 
				success: function( response ) {
					
					var opt = document.createElement('option');
					opt.value = "";
					opt.innerHTML = "";
					select.appendChild(opt);
					
					var split = response.split('~');
					for ( var i = 0; i < split.length; ++i ) {
						var parts = split[i].split('=');
						if ( parts.length === 2 ) {
							opt = document.createElement('option');
							opt.value = parts[0];
							opt.innerHTML = parts[1];
							select.appendChild(opt);
						}
					}
				}			 
			});    
		}
	}
	
	</script>
	

<title>SUNBASE - solar</title><title>SUNBASE - solar</title><link rel="icon" type="image/ico" href="https://localhost:8443/sunbase/favicon.ico"><script type="text/javascript" src="./edit_files/jquery-1.10.2.js.download"></script><link rel="stylesheet" type="text/css" href="./edit_files/foundation.css"><link rel="stylesheet" type="text/css" media="all" href="./edit_files/submit.css"><style>
	
	
.multiselect {
    width:500px;
    height:15em;
    border:solid 1px #c0c0c0;
	background-color: #ffffff;
    overflow:auto;
	white-space: nowrap;
	overflow-x:scroll ;
}
 
.multiselect label {
    display:block;
}
 
.multiselect-on {
    color:#ffffff;
    background-color:#000099;
}	
	
.2submit
{		
    background-color: #0000FF;
    background-image: -webkit-gradient(linear, left top, left bottom, from(#3399FF), to(#0000FF));
    background-image: -webkit-linear-gradient(top, #3399FF, #0000FF);
    background-image: -moz-linear-gradient(top, #3399FF, #0000FF);
    background-image: -ms-linear-gradient(top, #3399FF, #0000FF);
    background-image: -o-linear-gradient(top, #3399FF, #0000FF);
    background-image: linear-gradient(top, #3399FF, #0000FF);
    
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    
    text-shadow: 0 1px 0 rgba(255,255,255,0.5);
    
     -moz-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3), 0 1px 0 rgba(255, 255, 255, 0.3) inset;
     -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3), 0 1px 0 rgba(255, 255, 255, 0.3) inset;
     box-shadow: 0 0 1px rgba(0, 0, 0, 0.3), 0 1px 0 rgba(255, 255, 255, 0.3) inset;    
    
    #float: left;
    height: 35px;
    padding: 0;
    width: 180px;
    cursor: pointer;
    font: bold 15px Arial, Helvetica;
    color: #FFF;
}

.2submit:hover,#submit:focus,#submit:active
{		
    background-color: #fddb6f;
    background-image: -webkit-gradient(linear, left top, left bottom, from(#ffb94b), to(#fddb6f));
    background-image: -webkit-linear-gradient(top, #ffb94b, #fddb6f);
    background-image: -moz-linear-gradient(top, #ffb94b, #fddb6f);
    background-image: -ms-linear-gradient(top, #ffb94b, #fddb6f);
    background-image: -o-linear-gradient(top, #ffb94b, #fddb6f);
    background-image: linear-gradient(top, #ffb94b, #fddb6f);
}	

.2submit:active
{		
#    outline: none;
   
     -moz-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5) inset;
     -webkit-box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5) inset;
     box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5) inset;		
}



    /***FIRST STYLE THE BUTTON***/
   .submit,#submit{
    cursor:pointer; /*forces the cursor to change to a hand when the button is hovered*/
    padding:5px 25px; /*add some padding to the inside of the button*/
    background:#215ca0; /*the colour of the button*/
    /*give the button curved corners, alter the size as required*/
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    border-radius: 4px;
    /*give the button a drop shadow*/
    -webkit-box-shadow: 0 0 4px rgba(0,0,0, .75);
    -moz-box-shadow: 0 0 4px rgba(0,0,0, .75);
    box-shadow: 0 0 4px rgba(0,0,0, .75);
    /*style the text*/
    color:#f3f3f3;
    font-size:1em;
    }
    /***NOW STYLE THE BUTTON'S HOVER AND FOCUS STATES***/
    .submit:hover, .submit:focus{
    background-color :#0029A3; /*make the background a little darker*/
    /*reduce the drop shadow size to give a pushed button effect*/
    -webkit-box-shadow: 0 0 1px rgba(0,0,0, .75);
    -moz-box-shadow: 0 0 1px rgba(0,0,0, .75);
    box-shadow: 0 0 1px rgba(0,0,0, .75);
    }

#advancedBtn, #resetAdvancedBtn {
   background-color: #005fb2;
    color: white;
    border: 0px;
}

.submit2::-moz-focus-inner
{
  border: none;
}


a, a:visited {
	text-decoration:none;
	outline:none;
	color:	#342D7E;
}

a:hover{
	text-decoration:underline;
}


a:link {text-decoration: none;} //the original link with no underline
a:visited {text-decoration: none;} //the visited link with no underline
a:hover {text-decoration: underline;} //mouseover link and an underline appears


html {
overflow: -moz-scrollbars-vertical; 
overflow-y: scroll;
}
		
body{font-family:Verdana,Arial,Helvetica;font-size:12px;color:black;margin:0px;padding:10px;padding-top:5px}
#languages{color:white;font-size:10px;text-align:right;padding-bottom:5px}#languages ul{list-style:none;padding:0px;margin:0px}
#languages li{display:inline;margin-left:30px;margin-right:10px}#languages a:link,#languages a:visited{color:white;text-decoration:none}
#languages a:hover,#languages a:active{color:white;text-decoration:underline}#container{background-color:white;background:#fff;min-width:800px;width:auto !important}
#glass{position:absolute;top:20px;left:0px;z-index:10}
#header{height:70px;padding:0px;margin:10px;margin-bottom:30px;color:white;font-weight:bold;background-color:#11386d;background:#11386d;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:right -70px}
#header .corner{height:70px;width:20px;padding:0px;margin:0px;float:left;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:top left}
#header #logo{position:absolute;top:51px;left:120px;width:280px;height:32px;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -210px;cursor:pointer}
#header #menu{float:right}
#header #menu .search{width:16px;height:16px;display:inline-block;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -242px;cursor:pointer}
#header #menu .forum{width:16px;height:16px;display:inline-block;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -258px;cursor:pointer}
#header #menu .groups{width:16px;height:16px;display:inline-block;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -274px;cursor:pointer}
#header #menu .help{width:16px;height:16px;display:inline-block;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -290px;cursor:pointer}

#header table{width:90%;height:60px}
#header td.bottom{vertical-align:bottom}
#header ul{list-style:none;padding:0px;margin:0px;margin-top:45px;white-space:nowrap}
#header li{display:inline;margin-left:20px;margin-right:20px;white-space:nowrap}#header a:link,
#header a:visited{color:white;text-decoration:none}#header a:hover,#header a:active{color:yellow;text-decoration:none}
#main{margin:0px;color:black;background-color:white;background:#fff;line-height:19px;width:99%;min-height:800px;height:auto !important;  height:800px}
#search{margin:10px;margin-bottom:30px}

#search #advanced{margin-top:10px}#template{margin:0px}#text,#nieuws,#termcloud{margin-left:10px;margin-right:10px}
#helpicon{width:16px;height:16px;display:inline-block;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -290px;cursor:pointer}
#rssicon{width:16px;height:16px;display:inline-block;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -306px;cursor:pointer}#nieuws td{width:50%}#nieuws .nieuwstekst{border-top:1px dotted #808080;margin-bottom:20px;text-align:justify}#results{margin-top:20px;margin-bottom:50px}#results table{width:100%}#results thead td{padding-bottom:5px}#results thead tr.line td{border-bottom:1px solid gray}#results thead a{text-decoration:none}#results tfoot td{padding-top:5px}#results tfoot tr.line td{border-top:1px solid gray}#results tfoot a{text-decoration:none}#results tbody tr.odd{background-color:#edf5ff}#results tbody tr.even{}#results tbody tr:hover,#results tbody tr.odd:hover,#results tbody tr.even:hover{background-color:#ebebeb}#results td{padding-left:10px;padding-right:10px}#results td.firstcolumn{padding-left:10px;padding-right:0px}#results .sizeblock{width:15px;height:10px;-moz-border-radius:2px;border-radius:2px;background-color:gray;margin-left:2px;float:right}#results h1{font-size:30px;line-height:35px;margin-left:10px}#results h2{font-size:16px;line-height:20px;display:inline}#results .referral{height:200px;overflow:hidden;overflow-y:auto;margin-bottom:1px}#results a.group{text-decoration:none;color:black}#results a.group:hover,#results a.group:active{text-decoration:underline}#nfos{font-family:Courier New,Courier,monospace;font-size:13px;color:black;line-height:15px}#nfos pre{white-space:pre-wrap; white-space:-moz-pre-wrap; white-space:-pre-wrap; white-space:-o-pre-wrap; word-wrap:break-word}#nfos .highlight{font-weight:inherit;background-color:yellow}#vote #form{text-align:center}#vote h2{margin-top:0px;margin-bottom:20px}#permalink ul{padding:10px;margin:10px;margin-top:0px;padding-top:0px}#termcloud{line-height:20px;text-align:center;width:600px;margin:0 auto;padding-top:30px;padding-bottom:20px}#termcloudnieuwsbericht{line-height:20px;text-align:center;margin:0 auto;padding-top:0px;padding-bottom:20px}#termcloud span,#termcloudnieuwsbericht span{margin-left:1px;margin-right:1px}#termcloud a:hover,#termcloud a:active,#termcloudnieuwsbericht a:hover,#termcloudnieuwsbericht a:active{text-decoration:underline}.question h3{margin-bottom:5px;padding-bottom:0px}.question{margin-bottom:30px}.quote{background-color:#dedede;padding:10px}#bottom{height:35px;padding:0px;margin:10px;background-color:#0b2e64;background:#0b2e64;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:left -175px;color:white}#bottom .corner{height:35px;width:20px;padding:0px;margin:0px;float:right;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:right -140px}#disclaimer{padding:10px;padding-left:20px}#disclaimer a:link,#disclaimer a:visited{color:white;text-decoration:none}#disclaimer a:hover,#disclaimer a:active{color:yellow;text-decoration:none}a:link,a:visited{color:#003CAB;text-decoration:none}a:hover,a:active{color:#003CAB;text-decoration:none}.nounderline a:link,.nounderline a:visited{text-decoration:none}.nounderline a:hover,.nounderline a:active{text-decoration:none}p{margin:0px;margin-bottom:10px}table{font-size:12px;border:0px;border-collapse:collapse}td{vertical-align:top}img{border:0px}form{padding:0px;margin:0px}select{padding:1px}label{cursor:pointer}label.error{width:16px;height:16px;display:inline-block;background-image:url('../images/images.gif');background-repeat:no-repeat;background-position:0px -322px;margin-left:5px;cursor:auto}fieldset{margin-bottom:10px;padding:10px;-moz-border-radius:3px}



fieldset.searchform{margin:0 auto;width:90%;background-color:#efefef}legend{padding-left:10px;padding-right:10px}


</style><script>

	function enter_pressed()
	{
		if(event.keyCode == 13){
			document.getElementById("searchbtn").click();
		}
	}
		
	function httpSend(url)
	{
		var xmlhttp;
		if (window.XMLHttpRequest)
		{// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp=new XMLHttpRequest();
		}
		else
		{// code for IE6, IE5
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		
		xmlhttp.open("GET",url, false );
		//+"?t=" + Math.random(),true);
		xmlhttp.send();
		
		return xmlhttp.responseText;
		
	}

	function callServer(url)
	{
		var xmlhttp;
		if (window.XMLHttpRequest)
		{// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp=new XMLHttpRequest();
		}
		else
		{// code for IE6, IE5
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		
		xmlhttp.open("GET",url, false );
		//+"?t=" + Math.random(),true);
		xmlhttp.send();
		
		return xmlhttp.responseText;
		
	}

	
	</script></head>





















	


	
	
	
		<body style="cursor: default;"><div id="main" style="override-x: hidden;">		
		<div id="search">




<!-- Right panel -->
<!--<script src="/sunbase/js/jquery.panelslider.min.js"></script> 
<script>
    $('#left-panel-link').panelslider();

    $('#close-panel-bt').click(function() {
      $.panelslider.close();
	  //window.location = 'index.jsp';
    });
  </script>
-->

<script src="./edit_files/jquery.growl.js.download" type="text/javascript"></script>
<link href="./edit_files/jquery.growl.css" rel="stylesheet" type="text/css">



<script src="./edit_files/jquery-ui-1.10.4.custom.js.download"></script>
<script src="./edit_files/spa.js.download"></script>
<script async="" src="./edit_files/chat.js.download"></script>
<link href="./edit_files/overlay.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="./edit_files/loadingoverlay_progress.min.js.download"></script>

<link rel="stylesheet" href="./edit_files/chosen.css">

<script src="./edit_files/chosen.jquery.js.download" type="text/javascript"></script>
<link href="./edit_files/bootstrap-suggest.css" rel="stylesheet">
<script src="./edit_files/bootstrap-suggest.min.js.download"></script>  




<script>
function loadCities(id)
{
/*	var selectBox = document.getElementById("city");
	var state = document.getElementById("state");
	
	if ( state.value != selectBox['state-data'] )
	{
		console.log("Would load cities");
		selectBox['state-data'] = state.value;
	}
	else
		console.log("Already loaded ");

	// get state and county lets load the cities
*/	
}

function addItemToSelect(selectId, value)
{
//	console.log("Add item " + selectId + "," + value );
	var select= document.getElementById(selectId)
	var opt = document.createElement('option');
    opt.value = value;
    opt.innerHTML = value;
    select.appendChild(opt);
	
	var idx = findIndexSelect(selectId, value);
	if ( idx > 0 )
		select.selectedIndex = idx;
}

function findIndexSelect(selectId, value)
{
	var options= document.getElementById(selectId).options;
	if ( options === undefined )
	{
		document.getElementById(selectId).value = value;
	}
	else
	{
		for (var i= 0; i < options.length; i++) 
		{
			if (options[i].value===value) {
				return i;
			}
		}
	}
	return -1;
}

function stateChanged(stateCode)
{
	var countyEntry = document.getElementById("county");
	var stateEntry = document.getElementById("state");

// if there is already a county dont search it	
	var countyValue = countyEntry.value.trim();
	if ( countyValue === 'all' )
		countyValue = "";
	if  ( stateEntry === undefined && countyEntry === undefined && stateEntry.value.trim() == "" || countyValue !== "")
	{
		// nothing to search
		return;
	}
	
	if ( countyEntry != null )
		countyEntry.innerHTML = "";
	addItemToSelect("county", "all" );
	
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=county_lookup&state=" + stateEntry.value.trim(),

		success: function (data) {
			data = data.trim();
			var results = JSON.parse( data );
			for ( var i = 0; i < results.length; ++i )
			{
				if ( results[i].length > 0 )
					addItemToSelect("county", results[i] );
			}
			
			if ( countyEntry != null )
				countyEntry.selectedIndex = 0;

		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});

}
function loadCounties()
{
	var countyEntry = document.getElementById("county");
	var stateEntry = document.getElementById("state");
	var cityList = document.getElementById("city");
	var countyValue = countyEntry.value.trim();
	if ( countyValue === 'all' )
		countyValue = "";
	console.log("Load counties " + countyValue + "," + stateEntry.value + "," + cityList.value );
	if  ( (stateEntry.value.trim() == "" || countyValue === "") && (cityList.value.trim() !== "" || cityList.value.trim() === "all") )
	{
		// nothing to search
			console.log("exit");
		return;
	}
	
	if ( cityList != null )
		cityList.innerHTML = "";
	
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=city_lookup&state=" + stateEntry.value.trim() + "&county=" + countyEntry.value.trim(),

		success: function (data) {
			data = data.trim();
			var results = JSON.parse( data );
			addItemToSelect("city", "all" );
			for ( var i = 0; i < results.length; ++i )
			{
				addItemToSelect("city", results[i] );
			}
			if ( cityList != null )
				cityList.selectedIndex = 0;
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

var prettyMode = false;

</script>

<script type="text/javascript" src="./edit_files/bootstrap.min.js.download"></script>
<!--<script src="js/chat.js"></script>-->
<link href="./edit_files/fancystyle.css" rel="stylesheet">
<script src="./edit_files/notification.js.download"></script>

  
	<script async="" src="./edit_files/materialize2.js.download"></script>

  
<!-------->
<script type="text/javascript" src="./edit_files/jquery-impromptu.js.download"></script>
   <script src="./edit_files/datepicker.js.download"></script>
  <script type="text/javascript" src="./edit_files/flexigrid.pack.js.download"></script>
<script src="./edit_files/datetimepicker.js.download"></script>


 <link rel="stylesheet" type="text/css" href="./edit_files/flexigrid.pack.css">       

 <link rel="stylesheet" media="all" type="text/css" href="./edit_files/jquery-impromptu.css">
<link rel="stylesheet" type="text/css" href="./edit_files/datepicker.css">
 <link rel="stylesheet" type="text/css" media="all" href="./edit_files/niceforms-default.css">

 	<style>

.dollar{
	display:inline-block;
	position: relative;
	}
.dollar input{
	margin-left:5px;
	padding-left:11px !important;
	}
.dollar:before {
	position: absolute;
    content:"$";
	font-size:13px;
	font:13px !important;
    left:5px;
	top:2px;
 	}

.prettyForm * label {
	font-size:14px !important;
}
.prettyForm * input[type=text], .prettyForm * input[type=number], .prettyForm * input[type=currency], .prettyForm * input[type=date], .prettyForm * select {
    overflow: hidden;
    height: 27px;
    border: 1px solid #e2dfdf;
    border-radius: 5px;
    background-color: #fff;
    background-clip: padding-box;
    box-shadow: 0 0 3px #fff inset, 0 1px 1px rgba(0, 0, 0, 0.1);
    color: #444;
    text-decoration: none;
    white-space: nowrap;
	font-size:13px;
	font:13px !important;
    line-height: 24px;
}
</style>
 
  <link rel="stylesheet" type="text/css" media="all" href="./edit_files/flexgrid_controls.css">

<link href="./edit_files/datasourcestyle.css" rel="stylesheet">
<link href="./edit_files/jquery-ui-1.10.4.custom.css" rel="stylesheet">
<!-------->	

<script>
function reloginApp()
{
	
	var user = '';
	var pass = '';
	
	var contextName = '/sunbase';
	if ( contextName == 'salesmachine' )
		contextName = 'sales_machine';
	
	var x = getCookie('sunbasedata_');
	if ( x === null || x === '' || x.indexOf('|') == -1 )
	{
		x = getCookie(contextName);
	}
	if ( x != "" )
	{
		var data = x.split("|");
		if ( data.length >= 2 )
		{
			user = data[0];
			pass = data[1];
		}
	}
	
	var html = "<img width='20px' src='img/lock.png'/> <b style='color:green;font-size: 24px;'>Just to be safe, we logged you out.</b><br/><br/>Enter your password to pick up where you left off. </center><br/><br/><label style='width:70px'>Current user: </label><input id='username' name='username' value='" + user + "'/><br/><br/><label style='width:70px'>Password: </label><input type='password' placeholder='Password' id='password' name='password' value='" + pass + "'/>";

	var statesdemo = {
	state0: {
		html:html,
		title: "Session Timeout.  Relogin",
		buttons: { "Login": 1, "Cancel": -1 },
		focus: "input[name='username']",
		submit:function(e,v,m,f){ 
			if ( v !== -1 && (f.username === '' || f.password === '' || f.username.indexOf('@') == -1 ) )
			{
				e.preventDefault(); 
				return false;
			}
			else if ( v == 1 )			
			{
				$.ajax({
					type: "GET",
					url: "login_cmd.jsp?cmd=login",
					data: f,
					success: function (data) {
						if ( data.indexOf("uccess") !== -1 )
						{
							xdInfo("Reconnected");
							if ( $('.content').html().indexOf("img/spinning.gif") !== -1 )
								spaRefreshNavigatePage();
						}
					},
					error: function (XMLHttpRequest, textStatus, errorThrown) {
						console.log( textStatus );
					}
				});
			}
		}// end of submit
	  }
	}

	if ( statesdemo != null )
		$.prompt(statesdemo);
}

</script>



<link rel="stylesheet" href="./edit_files/signaturepad.jquery.css">
<script src="./edit_files/jquery.signaturepad.min.js.download"></script> 
<script src="./edit_files/base_edit.js.download"></script>

<script src="./edit_files/jquery.growl.js.download" type="text/javascript"></script>
<link href="./edit_files/jquery.growl.css" rel="stylesheet" type="text/css">



<input id="mylat" type="hidden" value="0">
<input id="mylon" type="hidden" value="0"> 
<input id="myspeed" type="hidden" value="0"> 
<input id="myheading" type="hidden" value="0"> 
<input id="myaccur" type="hidden" value="0"> 
<input id="mylastgpstime" type="hidden" value="0"> 
<script>

var gpsPeriod = 0;



var config = {
  '.chosen-select'           : {},
  '.chosen-select-deselect'  : { allow_single_deselect: true },
  '.chosen-select-no-single' : { disable_search_threshold: 10 },
  '.chosen-select-no-results': { no_results_text: 'Oops, nothing found!' },
  '.chosen-select-rtl'       : { rtl: true },
  '.chosen-select-width'     : { width: '95%' }
}
function initSelectChoice(id) // '#form1 select'
{

}

function showMobileMenu()
{
	document.getElementById("content").style.display == 'block';
	loadMobileMenu();
	document.getElementById('mobilemenu_page').style.display='block';	
	returnToMain();
}

function returnToMain()
{
	if ( document.getElementById("mainx").style.display != "block" )
	{
		var x = document.getElementsByClassName("grid-menu");
		var i;
		for (i = 0; i < x.length; i++) {
			x[i].style.display = "none";
		}
		document.getElementById("about-menu").style.display = 'none';
		document.getElementById("logoff-menu").style.display = 'none';
		
		document.getElementById("mainx").style.display = 'block';
	}
}


function resetToMobileMenu()
{
	var menuPage = document.getElementById('mobilemenu_page');	
	var menudiv = document.getElementById('mobilemenu_details');	
	document.getElementById("content").style.display = "none";	
	menuPage.style.display = "block";
}

function loadMobileMenu()
{	
	

//spaNavigatePage("mobile/modules/common/menu_details.jsp");
	var menuPage = document.getElementById('mobilemenu_page');	
	var menudiv = document.getElementById('mobilemenu_details');	
	

	if ( menudiv != null && menudiv.innerHTML == "" )
	{  // load it
			$.ajax({
				url: "full_menu_details.jsp",
				type: "GET",
				dataType : 'text',
			 
				success: function( response ) {
					
					menudiv.innerHTML = response;
					document.getElementById("content").style.display = "none";	
					menuPage.style.display = "block";
					document.getElementById("content").innerHTML = "";
					
					
				}			 
			});    

	}
	else
	{
		if ( document.getElementById("content").style.display == 'block' )
		{
			document.getElementById("content").style.display = "none";	
			menuPage.style.display = "block";
		}
		else if ( document.getElementById("content").innerHTML != "" )
		{
			document.getElementById("content").style.display = "block";	
			menuPage.style.display = "none";			
		}
	}
	
}

function hideQuickAdd()
{
	$('.addSubmenu').removeClass('show');
}
function toggleQuickAdd()
{
	

	$('.addSubmenu').toggleClass('show');
	
}

function navigateMenuItem(ur)
{
	hideQuickAdd();
	hideNavMenu();
//	console.log("Hide menu open main");
	spaNavigatePage(ur);
}
function hideNavMenu()
{
	document.getElementById('mobilemenu_page').style.display = "none";
	document.getElementById('content').style.display = "block";
}
function showMenu(id, newmenu)
{
	if ( document.getElementById(id.trim()) == null )
			console.log("Unable to find " + id );
	if ( document.getElementById(newmenu.trim()) == null )
			console.log("Unable to find [" + newmenu.trim() + "]");

console.log("Show menu " + id + " " + newmenu );		
   if ( id != null )
	   document.getElementById(id.trim()).style.display='none';
   document.getElementById(newmenu.trim()).style.display='block';
}

function openHelp()
{
	window.open('help/help.jsp?page=' + current_url_Address ).focus();
}


function toggleQuickSearch()
{
	
		var q = document.getElementById("quickMenuSearchPanel");
		q.style.display = ( q.style.display == 'block' ? 'none' : 'block' );
		document.getElementById('searchTextBox').focus();
	
}
</script>
<script type="text/javascript" src="./edit_files/gps_location.js.download"></script>

<input type="hidden" id="current_content" value="/sunbase/modules/crm/lead_edit.jsp?key=f0b0668623a5493b982e2f216cdd6735&amp;embed=1">




</div>

<div class="chat-window" id="chat-window" style="right: 10px;display: none;">
	<div class="chat-window-title">
		<div class="text">Team 
		<img title="Close" src="./edit_files/close3.png" width="16" height="16" style="margin-left:10px; float:right" onclick="toggleChat();return false;">
		<img style="float:right" onclick="reloadChatList(); return false;" src="./edit_files/refresh.png" width="16" height="16">
		                       </div>
	</div>
	<div id="chat-window-content" class="chat-window-content" style="height: 400px; display: block;">
		<div class="chat-window-inner-content user-list" style="height: 100%">
			<div id="chat-user-list" class="user-list-item" data-val-id="2">BLANK</div>			
		</div>
	</div>
</div>

<div id="notificationContainer" style="display:none">
	<input type="hidden" id="notificationPage" value="1">
	<div id="notificationTitle">Notifications <div id="notificationActions" style="float:right">
<img title="Add notification" src="./edit_files/add.png" onclick="createNotification(escape(&quot;SunbaseData Admin&quot;), &quot;71590418a3cc43b0b4fc29f5e86d6868&quot;, &quot;blank.png&quot;, &quot;&quot;)">
                     
			&nbsp;&nbsp;&nbsp;
			<img title="Delete all" src="./edit_files/delete.png" width="16" height="16" style="margin-right:10px" onclick="clearAllNotifications();return false;">

			<img title="Refresh" src="./edit_files/refresh.png" onclick="refreshNotifications(1);return false;">
			<img title="Close" src="./edit_files/close3.png" width="16" height="16" style="margin-left:10px" onclick="toggleNotifications();return false;">
	</div> </div>
	<div id="notificationsBody" class="notifications"></div>
	<div id="notificationFooter"><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="loadMoreNotifications(); return false">See More</a>  | <a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="loadNotificationsHistory(); return false">Sent History</a></div>
</div>

	<div id="mobilemenu_page" style="display: none">
	<div id="mobilemenu_details" style="min-height:400px"></div>
	<div style="margin-top:200px">You can right click to create a shortcut
<br> <a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="window.location.href=&quot;index4.jsp&quot;; return false;">Try a new navigation mode</a>
		<div style="float:right">	
			<img width="200" height="50" src="./edit_files/logo.png">
		</div>
	</div>


	<div id="fastmenu" style="display: none"></div>
	</div>

	<br>

	<div class="content" id="content" style="display: block">




<script>

// detect if window was open in new tab
if(!window.jQuery)
{
	window.location = '/sunbase/index.jsp?page=' + escape( location.pathname.replace("/sunbase", "") );
}	


var dirtyFieldFlag = false;
function initDirtyField()
{
	$('#form1 * select').on('change click', function() {
		$('.change-message').html("Record has been modified");
		dirtyFieldFlag = true;
	});
	$('#form1 * input, #form1 * textarea').on('change keyup paste', function() {
		$('.change-message').html("Record has been modified");
		dirtyFieldFlag = true;
	});
	
	$('.input-group-addon').on('click',function() {
		$('.change-message').html("Record has been modified");
		dirtyFieldFlag = true;
	}); 
}

function updateChimpList(acct)
{	
		$.ajax({
			type: "POST",
			url: "modules/plugins/integrations/mailchimp_cmd.jsp?cmd=fetch_list&account=" + document.getElementById(acct).value,
			data: '',

			success: function (html) {
				document.getElementById('mailchimp_list').innerHTML = html;
			}
		});	
}
function mailChimpAction(email, first_name, last_name)
{
	var html = '<label for="account">Account</label><select onchange="updateChimpList(\'account\')" id="account" name="account">';
	html += loadXMLDocOnly("modules/plugins/integrations/mailchimp_cmd.jsp?cmd=list_accounts");								
	html += '</select><br/>';
	html += '<label for="list">Mail List</label><select id="list" name="list"></select><br/>';
	html += '<label for="email">Email</label><input type="email" id="email" name="email" value="' + email + '"></select><br/>';
	html += '<input type="hidden" id="first_name" name="first_name" value="' + first_name + '"><br/>';
	html += '<input type="hidden" id="last_name" name="last_name" value="' + last_name + '"><br/>';
	
	var statesdemo = {
	state0: {
		html:html,
		title: "Add/Remove Account MailChimp",
		buttons: { "Add": 1, "Remove": 2, "Cancel": -1 },
		//focus: "input[name='fname']",
		submit:function(e,v,m,f){ 
			if ( v !== -1 && (f.list === '' || f.account === '' || f.email === '') )
			{
				e.preventDefault(); 
				return false;
			}
			else if ( v == 1 )			
			{
				$.ajax({
					type: "GET",
					url: "modules/plugins/integrations/mailchimp_cmd.jsp?cmd=add_from_list",
					data: f,
					success: function (data) {
						if ( data.indexOf("uccess") !== -1 )
							$.growl.notice({ message: "Email added to list." });
					},
					error: function (XMLHttpRequest, textStatus, errorThrown) {
						console.log( textStatus );
					}
				});
			}
			else if ( v === 2 )
			{
				$.ajax({
					type: "GET",
					url: "modules/plugins/integrations/mailchimp_cmd.jsp?cmd=remove_from_list",
					data: f,

					success: function (data) {
						if ( data.indexOf("uccess") !== -1 )
							$.growl.notice({ message: "Email removed from list." });
					},
					error: function (XMLHttpRequest, textStatus, errorThrown) {
						console.log( textStatus );
					}
				});
			}
		}// end of submit
	  }
	}

	if ( statesdemo != null )
		$.prompt(statesdemo);
}


function azOnly(cc)
{
	console.log(cc);
	return ((cc>47 && cc<58) || (cc>64 && cc<91) || (cc>96 && cc<123) || cc == 95);
}

	function toggleFieldSet(name)
	{
		var div = document.getElementById( name + "_div");
		var header = document.getElementById( name + "_header");
		if ( div != null )
		{
			if( div.style.display == 'none' )
			{
				div.style.display = 'block';
				header.classList.add("active");
				header.classList.remove("closed");
			}
			else 
			{
				div.style.display = 'none';
				header.classList.remove("active");
				header.classList.add("closed");
			}
			
			console.log("Toggle " + name + " " + div.classList );
		}
	}

	function editLookup(type, look)
{
	if ( type == 'lookup_names' )
	{
		window.open( "/sunbase/index.jsp?nomenu=1&page=/modules/zadmin/lookup_names_form.jsp" );
	}
	else if ( type == 'lookup' )
	{
		// open edit window.
		if ( look == '' )
		{
			$.growl.error({ message: "Sorry this is a hard coded list" });
		}
		else
		{
			window.open( "/sunbase/index.jsp?nomenu=1&page=modules/zadmin/lookup_codes_form.jsp%3Fname_code=" + look );
		}
	}
	else if ( type == 'payee' )
	{
		// open edit window.
		window.open("/sunbase/index.jsp?nomenu=1&page=modules/invoice/payee_form.jsp" );
	}
	else if ( type == 'event' )
	{
		// open edit window.
		window.open("/sunbase/index.jsp?nomenu=1&page=modules//marketing/event_form.jsp" );
	}
	else
	{
		$.growl.error({ message: "Unknown edit type " + look + " " + type });
	}
}

	
function checkform(p) 
{
	return checkFormPost(p);;
}

function checkFormPost(p) 
{
showOverlay();	
$.ajax({
	type: 'POST',
	async: true,
	url: p,
	data: $('#form1').serialize(),
	success: function (response) {
		if ( response.indexOf('<!--lxxxogin-->'.replace('lxxxogin',"login")) != -1 )
		{
		   reloginApp();
		   return;
		}
		else if ( response.indexOf("Success") != -1 )
		{
			var embedded = false;		
			if ( typeof postSave === "function" )
				embedded = postSave();
			if ( !embedded )
			{
				var basePath = "modules/crm/";
				if ( document.getElementById("custType") != null )
				{
					var custType = document.getElementById("custType").value;
					var uuid = document.getElementById("uuid").value;
					if ( custType == 'lead' )
						spaNavigatePage( basePath + 'lead_form.jsp?key=' + uuid + '&reset=true');
					else if ( custType == 'opportunity' )
						spaNavigatePage( basePath + 'opportunity_form.jsp?key=' + uuid + '&reset=true');
					else if ( custType == 'account' )
						spaNavigatePage( basePath + 'account_form.jsp?key=' + uuid + '&reset=true');
					else
						spaNavigatePage( basePath + 'customer_form.jsp?key=' + uuid + '&reset=true');
				}
				else
				{
					basePath = "/sunbase/";
					if ( 'null'.indexOf("&src=") != -1 )
						spaNavigatePage(basePath + p.replace("_form", "_cmd") + '?cmd=afterGroup&nextPage=&reset=true');
					else if ( p.indexOf("?") == -1 )
						spaNavigatePage(basePath + p.replace("_cmd", "_form") + '?reset=true' );
					else
						spaNavigatePage( basePath + p.replace("_cmd", "_form") + '&reset=true' );
				}
			}
		}
		else
		{
			$.growl.error({ message: response });
		}
	},
	error : function() {
		$.growl.error({ message: "An unknown error has occurred" });
	},
	complete: function( xhr, status ) {
		hideOverlay();
	}	
	});
	return false;

}





function preNavigate()
{
	
	if ( dirtyFieldFlag )
	{
		if ( confirm("You have unsaved changes.  Click ok to navigate to the new page and lose your changes.  Cancel to stay on the page") == false )
		{
			return false;
		}
	}

	dirtyFieldFlag = false;

	return true;
}

</script>

<div class="change-message"></div>

<script>

function launchContract()
{
	var uuid = document.getElementById('uuid').value;
	window.open('index.jsp?nomenu=1&page=modules/common/template_type.jsp%3FcustId=' + uuid, 'Contract').focus();
}

function getNumber(id)
{
	var amt = 0;
	var v = document.getElementById(id);
	if ( v != null && v != '' )
	{
		amt = parseFloat( v.value );
		if ( isNaN( amt ) )
			amt = 0;
	}
	return amt;
}

function generateDoc(uuid)
{
	spaNavigatePage('modules/plugins/document/document_stage.jsp?key=' + uuid);
}

function updateMarginPer()
{	
	var contract = getNumber('salesPotential');
	var bomTotal = getBomTotal();

	if ( bomTotal === 0 )
		$('#quote7').val('0');
	else
	{
		var discount = getNumber('quote8');
		
		var a = ( 1 - bomTotal/ (contract-discount)) * 100;
		console.log( a.toFixed(2) );
		$('#quote7').val( a.toFixed(2) );
	}
}
function getBomTotal()
{
	var total = $('#bomTotal').html();
	if ( total !== '' && total.indexOf('$') != -1 )
		return parseFloat(total.substring(1) );
	return 0.0;
}

function updateMarginAmt()
{
	var margin = getNumber('quote7');
	var bomTotal = getBomTotal();

	//contract * margin = bomTotal
		//var total = contract-discount;
		//var margin = ( ( total-bomTotal / total ) * 100 ).toFixed(0);
    //200  = 1 - .66 + bomTotal;
	var factor = 1/( 1-margin/100);
	var amt = bomTotal * factor;
	//var amt = ( (1+ (margin/100)) * bomTotal + bomTotal );
	$('#salesPotential').val( amt.toFixed(2) );
}

function selectAccountLink(field)
{
	window.open("index.jsp?nomenu=1&page=modules/crm/select_customer_form.jsp%3Fsubtype=acct%26field=" + field + "%26pageType=parentCallback%26parent=" + document.getElementById('uuid').value, "Edit" ).focus();
}

String.prototype.replaceAll = function(search, replacement) {
    var target = this;
    return target.replace(new RegExp(search, 'g'), replacement);
};

function setForce()
{
	var f = document.getElementById('force_status_save');
	if ( f )
		f.checked = true;
}

function logAction(action, uuid, comment)
{
	var x = document.getElementById('uuid_customer');
	if ( x )
		uuid = x.value;

}

function fillPdf(uuid, hint)
{
	var extra = "%26city=" + escape(document.getElementById('city').value);
	extra += "%26county=" + escape(document.getElementById('county').value);
	extra += "%26state=" + escape(document.getElementById('state').value);
	window.open("index.jsp?nomenu=1&page=modules/common/fillable_pdf_selector.jsp%3FparentId=" + uuid + extra, "Edit").focus();
}


function actionMailTo(email)
{
	if ( email != null && email.indexOf('@') )
	{
		logAction('Email', document.getElementById("uuid").value, 'Attempted' );
		window.open( 'mailto:' + email );
	}

}


function sendSolo()
{
	var usageBox = document.getElementById('customField8');
	var usage = '1000';
	if ( usageBox )
	{
		usage = usageBox.value;
	}
	
	$.ajax({
		type: "POST",
		url: "modules/plugins/integrations/solo_cmd.jsp?cmd=create&key=" + document.getElementById('uuid').value + "&usage=" + usage,
		data: '',
		success: function (data) {			
			data = data.trim();
			if ( data.indexOf("Error") > -1 )
			{
				xdError( data );
			}
			else if ( data.indexOf("http") != -1 )
			{
				var block = data.split("|");
				if ( block.length === 2 )
				{
					var f = document.getElementById( block[0] );
					if ( f && block[1] )
					{
						f.value = block[1].trim();
						xdInfo("Solo Created");
					}
				}
				
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}


function sendCampaignSimple()
{
	var email = ( document.getElementById('email') !== null ? document.getElementById('email').value : null );
	if ( email.length <= 2 && email.indexOf('@') !== 1 )
	{
		xdWarn("You need to have an email address set");
		return;
	}
	
	$.ajax({
		type: "POST",
		url: "modules/crm/lead_cmd.jsp",
		data: 'cmd=list_campaign',
		success: function (data) {			
			var statesdemo = {
				state0: {
					html:data,
					title: '<b>Send Campaign</b>',
					position: { width: 500 },
					buttons: { "Send": 1, "Cancel": -1 },
					submit:function(e,v,m,f){ 
						if ( v == 1 )
						{
							var campaignUuid = f.campaign_uuid;	
							$.ajax({
								url: "modules/crm/lead_cmd.jsp",
								data: 'cmd=send_campaign&email=' + escape(email) + "&campaignUuid=" + campaignUuid + "&email=" + email + "&key=" + document.getElementById('uuid').value,
								success: function(result) {
									if ( result.indexOf("Error") != -1 )
									{
										logAction('Email', document.getElementById("uuid").value, 'Campaign' );
										xdError( result );
									}
									else
										xdInfo("Campaign Sent");
								}
							});
						}	
					}// end of submit
				  }
			}
			if ( statesdemo != null )
				$.prompt(statesdemo);

		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function addDripCampaign()
{
	var email = ( document.getElementById('email') !== null ? document.getElementById('email').value : null );
	if ( email.length <= 2 && email.indexOf('@') !== 1 )
	{
		xdWarn("You need to have an email address set");
		return;
	}
	
	//  + '<br/><label for="flag">Add to drip</label><input type="checkbox" checked="true" id="flag" name="flag"/>'
	
	$.ajax({
		type: "POST",
		url: "modules/crm/lead_cmd.jsp",
		data: 'cmd=list_drip_campaign&key=' + document.getElementById("uuid").value,
		success: function (data) {			
			var statesdemo = {
				state0: {
					html:data,
					title: '<b>Add to Drip Campaign</b>',
					position: { width: 500 },
					buttons: { "Send": 1, "Cancel": -1 },
					submit:function(e,v,m,f){ 
						if ( v == 1 )
						{
							var campaignUuid = f.campaign_uuid;	
							$.ajax({
								url: "modules/crm/lead_cmd.jsp",
								data: 'cmd=start_drip&campaignUuid=' + campaignUuid + "&key=" + document.getElementById('uuid').value + "&flag=" + (document.getElementById('flag').checked ? 1 : 0),
								success: function(result) {
									if ( result.indexOf("Error") != -1 )
									{
										xdError( result );
									}
									else
										xdInfo( result );
								}
							});
						}	
					}// end of submit
				  }
			}
			if ( statesdemo != null )
				$.prompt(statesdemo);

		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function dialerSimple()
{
	var phones = '<label for="phone_list">Phone Numbers</label><select id="phone_list" name="phone_list">';
	if ( document.getElementById('phone1') !== null )
	{
		var number = document.getElementById('phone1').value.trim().replace(' ','');		
		if (number.length > 5 )
			phones += '<option selected="true" value="' + number + '">' + number + '</option>';
	}
	if ( document.getElementById('phone_cell') !== null )
	{
		var number = document.getElementById('phone_cell').value.trim().replace(' ','');		
		if (number.length > 5 )
			phones += '<option value="' + number + '">' + number + '</option>';
	}
	if ( document.getElementById('phone_work') !== null )
	{
		var number = document.getElementById('phone_work').value.trim().replace(' ','');		
		if (number.length > 5 )
			phones += '<option value="' + number + '">' + number + '</option>';
	}
	phones += '</select>';
	
	$.ajax({
		type: "POST",
		url: "modules/marketing/telelist_cmd.jsp",
		data: 'cmd=dialer_html_list',
		success: function (data) {	

			if ( data.indexOf("Error:") !== -1 )
			{
				xdError( data );
			}
			else
			{
				var statesdemo = {
					state0: {
						html:data + phones,
						title: '<b>Dialer Add/Remove</b>',
						position: { width: 500 },
						buttons: { "Add Phone": 1, "Remove Phone": 2, "Purge Phone from all": 3, "Cancel": -1 },
						submit:function(e,v,m,f){ 
							if ( v == 1 )
							{
								logAction('Dialer', document.getElementById("uuid").value, 'Add to' );
								var param = "cmd=dialer_add_lead_single&uuid=" + document.getElementById('uuid').value + "&list_id=" + f.dialer_list + "&first=" + escape(document.getElementById('first_name').value) + "&last=" + escape(document.getElementById('last_name').value) + "&phone=" + escape( f.phone_list );
								console.log("Data " + param  );
	//							?cmd=addPhone&uuid=9e87e1291473439f963ed10f6a9e4a3c&first=MARIE&last=THOMPSON&phone=%28254%29251-6374
								$.ajax({
									url: "modules/marketing/tele_list_import_cmd.jsp",
									data: param,
									success: function(result) {
										if ( result.indexOf("Error") != -1 )
										{
											xdError( result );
										}
										else
											xdInfo("Phone added to list");
									}
								});
							}
							
							else if ( v == 2 )
							{
								var param = "cmd=dialer_modify_lead&uuid=" + document.getElementById('uuid').value + "&list_id=" + f.dialer_list + "&first=" + escape(document.getElementById('first_name').value) + "&last=" + escape(document.getElementById('last_name').value) + "&phone=" + escape( f.phone_list );
	//							?cmd=addPhone&uuid=9e87e1291473439f963ed10f6a9e4a3c&first=MARIE&last=THOMPSON&phone=%28254%29251-6374
								$.ajax({
									url: "modules/marketing/tele_list_import_cmd.jsp",
									data: param,
									success: function(result) {
										if ( result.indexOf("Error") != -1 )
										{
											xdError( result );
										}
										else
											xdInfo("Phone removed from list");
									}
								});
							}
							else if ( v == 3 )
							{
								var param = "cmd=dialer_modify_lead&uuid=" + document.getElementById('uuid').value + "&list_id=-1&phone=" + escape( f.phone_list );
								$.ajax({
									url: "modules/marketing/tele_list_import_cmd.jsp",
									data: param,
									success: function(result) {
											xdInfo("Phone removed from list");
									}
								});
							}
							
						}// end of submit
					  }
				}
				if ( statesdemo != null )
					$.prompt(statesdemo);
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function openAppt()
{	
	window.open('index.jsp?nomenu=1&page=modules/dispatch/calendar.jsp%3Fread_only=true%26category=appointment%26select=1&field=apptDate%26fieldTime=apptDate').focus();

}

function apptDateSet(mode)
{
	var url = 'modules/calendar/schedule' + (mode == '2' ? "_table" : "") + '.jsp?type=&zip=' + document.getElementById('zip_code').value;
	$.ajax({
		type: "GET",
		url: url,
		success: function (html) {
			var statesdemo = {
				state0: {
					html:html,
					title: "Schedule",
					buttons: { "Set": 1, "Cancel": -1 },
					//focus: "input[name='fname']",
					submit:function(e,v,m,f){ 
						if ( v == 1 )			
						{
							if ( document.getElementById('daySelect').value != null && document.getElementById('daySelect').value.indexOf(":") != -1 )
							{
								var time = document.getElementById('daySelect').value;
								console.log( time );
								//document.getElementById('apptTime').value = time.substr(0, 10);
								document.getElementById('apptTimeTime').value = time.substr(11, 5);
								document.getElementById('apptEndTimeTime').value = '';
								var parts = document.getElementById('apptTimeTime').value.split(":");
								var hour = parseInt( parts[0] );
								if ( hour > 11 )
								{
									var hh = hour > 12 ? hour - 12 : hour;
									document.getElementById('apptTimeTime').value = "" + hh + ":" + parts[1];
									document.getElementById('apptTimeMode').value = 'PM';
								}
								else
									document.getElementById('apptTimeMode').value = 'AM';
								
								parts = time.substr(0, 10).split("-");								
								document.getElementById('apptTime').value = parts[1] + "/" + parts[2] + "/" + parts[0];
								
							}
							document.getElementById('salesUuid').value = document.getElementById('person').value;
							
							//document.getElementById('scheduleBtn').click();
							
						}
					}// end of submit
				  }
				}
			if ( statesdemo != null )
				$.prompt(statesdemo);
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
	
}


function clientPortalAccess(key)
{
	var phone = ( document.getElementById('phone1') !== null ? document.getElementById('phone1').value : '' );
	phone = phone.replace("(", "");
	phone = phone.replace(")", "");
	phone = phone.replace("-", "");
	phone = phone.replace(" ", "");
	
	var email = ( document.getElementById('email') !== null ? document.getElementById('email').value : null );
	if ( email.length <= 2 )
	{
		xdWarn("You need to have an email address set");
		return;
	}
	
		$.ajax({
		type: "POST",
		url: "modules/crm/userportal_cmd.jsp",
		data: 'cmd=portal&cust_uuid=' + key,
		success: function (data) {			
			data = data.trim();
			console.log("DATA [" + data + "]");
			var html = "<label for='accessBox'>Client authorized</label><input type='checkbox' name='accessBox' id='accessBox' " + ( data === '1' ? 'checked="true"' : '' ) + "><br/>";
			html += "<label for='accessPortal'>Change Password</label><input type='text' name='accessPortal' id='accessPortal' value='" + ( data !== '1' ? phone : '' ) + "'/>";
			html += "<label for='accessPortal'>Send email invitation</label><input type='checkbox' value='true' checked='true' name='sendEmailInvite' id='sendEmailInvite' />";
			
			var statesdemo = {
				state0: {
					html:html,
					title: '<b>User Portal Access</b>',
					position: { width: 500 },
					buttons: { "Update": 1, "Update Email Address": 2,"Cancel": -1 },
					submit:function(e,v,m,f){ 
						if ( v == 1 )
						{
							var sendEmail = f.sendEmailInvite;
	
							var flag = ( f.accessBox === 'on' ? 1 : 0 );
							console.log( "Flag " + f.accessBox );
							$.ajax({
								url: "modules/crm/userportal_cmd.jsp",
								data: 'cmd=change_portal&flag=' + flag + "&pass=" + f.accessPortal + "&email=" + email.trim() + "&cust_uuid=" + key + '&sendEmailInvite=' + sendEmail,
								success: function(result) {
									if ( result.indexOf("Error") != -1 )
									{
										xdError( result );
									}
									else
										xdInfo("Client is " + ( flag === 1 ? 'authorized' : 'no longer authorized' ) );
								}
							});
						}	
						else if ( v == 2 )
						{
							var sendEmail = f.sendEmailInvite;
							var flag = ( f.accessBox === 'on' ? 1 : 0 );
							console.log( "Flag " + f.accessBox );
							$.ajax({
								url: "modules/crm/userportal_cmd.jsp",
								data: 'cmd=change_portal_email&flag=' + flag + "&pass=" + f.accessPortal + "&email=" + email + "&cust_uuid=" + key + '&sendEmailInvite=' + sendEmail,
								success: function(result) {
									if ( result.indexOf("Error") != -1 )
									{
										xdError( result );
									}
									else
										xdInfo("Client is " + ( flag === 1 ? 'authorized' : 'no longer authorized' ) );
								}
							});
						}	
					}// end of submit
				  }
			}
			if ( statesdemo != null )
				$.prompt(statesdemo);

		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}


function sendSurvey()
{
	var key = ( document.getElementById('uuid') !== null ? document.getElementById('uuid').value : '' );
	var email = ( document.getElementById('email') !== null ? document.getElementById('email').value : null );
	
		$.ajax({
		type: "POST",
		url: "modules/marketing/survey_cmd.jsp",
		data: 'cmd=html',
		success: function (data) {			
			data = data.trim();
			var html = "<label for='survey'>Select Survey</label><select id='survey' name='survey'>" + data + "</select><br/>";
			html += "<label for='accessPortal'>Send email</label><input type='checkbox' value='true' checked='true' name='sendEmailInvite' id='sendEmailInvite' />";
			
			var statesdemo = {
				state0: {
					html:html,
					title: '<b>Survey (Client Portal Access)</b>',
					position: { width: 500 },
					buttons: { "Send": 1, "Cancel": -1 },
					submit:function(e,v,m,f){ 
						if ( v == 1 )
						{
							if ( f.sendEmailInvite == false )
								email = '';
							$.ajax({
								url: "modules/marketing/survey_cmd.jsp",
								data: 'cmd=send&survey=' + f.survey + "&email=" + escape(email) +"&cust_uuid=" + key,
								success: function(result) {
									if ( result.indexOf("Error") != -1 )
									{
										xdError( result );
									}
									else
										xdInfo("Survey is authorized");
								}
							});
						}	
					}// end of submit
				  }
			}
			if ( statesdemo != null )
				$.prompt(statesdemo);

		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}


function createSms()
{
	var uuid = document.getElementById('uuid').value;
	var phone = ( document.getElementById('phone1') !== null ? document.getElementById('phone1').value : '' );
	phone = phone.replace("(", "");
	phone = phone.replace(")", "");
	phone = phone.replace("-", "");
	phone = phone.replace(" ", "");

	var phoneCell = ( document.getElementById('phone_cell') !== null ? document.getElementById('phone_cell').value : '' );
	phoneCell = phoneCell.replace("(", "");
	phoneCell = phoneCell.replace(")", "");
	phoneCell = phoneCell.replace("-", "");
	phoneCell = phoneCell.replace(" ", "");

	
	if ( (phone !== null && phone.length > 9) || (phoneCell !== null && phoneCell.length > 9) )
	{
		var options = '';
		if ( phone != null && phone.length > 9 )
			options += '<option value="' + phone + '">Home ' + phone + '</option>';
		if ( phoneCell != null && phoneCell.length > 9 )
			options += '<option value="' + phoneCell + '">Cell ' + phoneCell + '</option>';

		
		var statesdemo = {
			state0: {
				title: '<b>Send SMS</b>',
				html: '<input type="hidden" name="uuid" value="'+ uuid + '"/>' + 
					'<b>Phone</b> <select name="phone" id="phone">' + options +
					'</select><input type="hidden" name="cmd" value="sendSMS" />' +
					'<textarea id="message" name="message" maxlength="500" style="height:140px;width:100%;max-height:50%"></textarea><br />',						
				buttons: { 'Send': 1, 'Close': 0 },
				position: { y:-200 },
				focus: "textarea[name='message']",
				submit:function(e,v,m,f){ 
					if ( v === 1 )
					{
						logAction('SMS', document.getElementById("uuid").value, '' );
						$.ajax({
							type: "POST",
							url: "/sunbase/modules/crm/lead_cmd.jsp",
							data: f,

							success: function (data) {
								if ( data.indexOf("Error") !== -1 )
									xdError(data.trim() );
								else
									xdInfo(data.trim() );
							},
							error: function (XMLHttpRequest, textStatus, errorThrown) {
								try {
									if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
								} catch (e) {}
							}
						});
					}

					e.preventDefault();
					$.prompt.close();
				}
			}
		};
		if ( statesdemo != null )
			$.prompt(statesdemo);
	}
}


function createSmsSalesRep()
{
	var uuid = document.getElementById('uuid').value;
	var repuuid = document.getElementById('salesUuid').value;
	if ( repuuid != null && repuuid.length > 10 )
	{
		var statesdemo = {
			state0: {
				title: '<b>Send SMS to Sales Rep</b>',
				html: '<input type="hidden" name="uuid" value="'+ uuid + '"/>' + 
					'<input type="hidden" name="rep_id" id="rep_id" value="' + repuuid + '"/>' +
					'</select><input type="hidden" name="cmd" value="sendSMSRep" />' +
					'<textarea id="message" name="message" maxlength="500" style="height:140px;width:100%;max-height:50%"></textarea><br />',						
				buttons: { 'Send': 1, 'Close': 0 },
				position: { y:-200 },
				focus: "textarea[name='message']",
				submit:function(e,v,m,f){ 
					if ( v === 1 )
					{
						logAction('SMS', document.getElementById("uuid").value, '' );
						$.ajax({
							type: "POST",
							url: "/sunbase/modules/crm/lead_cmd.jsp",
							data: f,

							success: function (data) {
								if ( data.indexOf("Error") !== -1 )
									xdError(data.trim() );
								else
									xdInfo(data.trim() );
							},
							error: function (XMLHttpRequest, textStatus, errorThrown) {
								try {
									if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
								} catch (e) {}
							}
						});
					}

					e.preventDefault();
					$.prompt.close();
				}
			}
		};
		if ( statesdemo != null )
			$.prompt(statesdemo);
	}
}


function createSmsExt()
{
	var uuid = document.getElementById('uuid').value;
	var phone = ( document.getElementById('phone1') !== null ? document.getElementById('phone1').value : '' );
	phone = phone.replace("(", "");
	phone = phone.replace(")", "");
	phone = phone.replace("-", "");
	phone = phone.replace(" ", "");

	if ( phone === null || phone.length < 9 )
	{
		var phoneCell = ( document.getElementById('phone_cell') !== null ? document.getElementById('phone_cell').value : '' );
		phoneCell = phoneCell.replace("(", "");
		phoneCell = phoneCell.replace(")", "");
		phoneCell = phoneCell.replace("-", "");
		phone = phoneCell.replace(" ", "");
	}	

	
	if ( phone !== null && phone.length > 9 )
	{
		var link = document.createElement('a');
		link.href = "sms://+1" + phone;
		link.style = 'display:none';
		document.body.appendChild(link);
		link.click(); 
		logAction('SMS', document.getElementById("uuid").value, 'Attempted' );
	}
}


function updateContact()
{
	var contact = document.getElementById("last_contact_date");
	logAction('Call', document.getElementById("uuid").value, 'Attempted' );
	if ( contact ) {

		var d = new Date();
		
		var dateToInput = '';//d.getFullYear() + '-' ;
		if ( d.getMonth() < 10 )
			dateToInput += '0';
		dateToInput += (d.getMonth()+1) + '/' ;
		if ( d.getDate() < 10 )
			dateToInput += '0';
		dateToInput += d.getDate();
		dateToInput += '/' + d.getFullYear();
		contact.value = dateToInput;
	}
}

function openDesigner(param)
{
	var fulladdress = '';

	var uuid = document.getElementById("uuid").value;
	
	var address = document.getElementById("address1");
	if ( address !== null && address.value !== '' )
		fulladdress += escape(address.value);

	address = document.getElementById("address2");
	if ( address !== null && address.value !== '' )
		fulladdress += escape(address.value);

	address = document.getElementById("city");
	if ( address !== null && address.value !== '' )
		fulladdress += ", " + escape(address.value);

	address = document.getElementById("state");
	if ( address !== null && address.value !== '' )
		fulladdress += ", " + address.value;

	address = document.getElementById("zip_code");
	if ( address !== null && address.value !== '' )
		fulladdress += ", " + address.value;
	//spaNavigatePage('index.jsp?nomenu=1&page=modules/plugins/area.jsp%3Fuuid=' + uuid + '%26address=' + fulladdress.replaceAll(' ', '~') );
	if ( param )
		window.open('index.jsp?nomenu=1&page=addons/measure/' + param + '/locate.jsp%3Fuuid=' + uuid + '%26address=' + fulladdress.replaceAll(' ', '~') ).focus();
	else
		window.open('index.jsp?nomenu=1&page=addons/measure/locate.jsp%3Fuuid=' + uuid + '%26address=' + fulladdress.replaceAll(' ', '~') ).focus();
}

function onTimeline()
{
	if ( document.getElementById("uuid") != null )
	{
		var uuid = document.getElementById("uuid").value;
		
		window.open("index.jsp?nomenu=1&page=modules/crm/timeline.jsp%3Fkey=" + uuid, "Edit").focus();
	}
}

function onExportJson()
{
	if ( document.getElementById("uuid") != null )
	{
		var uuid = document.getElementById("uuid").value;
		
		window.location = "modules/crm/customer_cmd.jsp?cmd=json&uuid=" + uuid;
	}
}

function recalculateQuoteAmt(idx)
{
	var quoteQty = document.getElementById("quoteQty" + idx );
	var quantity = ( quoteQty.value != null && quoteQty.value.length > 0 ? parseInt(quoteQty.value) : 0 );
	
	var bundle = document.getElementById("bundle" + idx + "Uuid").value;
	
	if ( bundle != null && bundle!= "" )
	{
		// fetch price of bundle
		console.log("Fetch " + bundle + " " + quantity );
		
//		var typeCode = bundle.substr(0, 1);		
//		bundle = bundle.substr(1);
		
//		if ( typeCode == "P" )
			var typeCode = "Package";
	//	else
		//	typeCode = "Equipment";
	
		$.ajax({
			type: "POST",
			url: "modules/invoice/fetch_equipment.jsp?type=" + typeCode + "&uuid=" + bundle + "&mode=basic",
			data: '',

			success: function (data) {
				var parts = data.split("|");
				console.log( parts );
				if ( parts.length > 4 )
				{
					var key = "quote" + idx;			
					if ( document.getElementById(key) != null )
					{
						document.getElementById(key).value = parseFloat(parts[4]) * quantity;
						console.log( key + " = " + document.getElementById(key) );
					}
					else
						console.log( key + " is null ");
				}		
			}
		});	

	}
//		<FormField type='currency' label="" field='quote8' placeholder="0.0" required='false' enabled='true' showList="false" sortable='false' filterable='false' size='10' maxlength='10' inlineScript="onblur=&quot;onLeadStatusChange();totalQuote()&quot;" ></FormField>								
	
}
			



function zipBlur()
{
	// if county and state and city are empty
	var countyEntry = document.getElementById("county");
	var stateEntry = document.getElementById("state");
	var cityEntry = document.getElementById("city");
	
	if  ( cityEntry != null && stateEntry != null && cityEntry.value.trim() != "" && stateEntry.value.trim() != "" && countyEntry.value.trim() != "")
	{
		// all ready have data
		return;
	}
	
	var zipEntry = document.getElementById("zip_code");
	var zip = null;
	if ( zipEntry != null )
	{
		zip = zipEntry.value;
	}
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=zip&terr=1&zip=" + zip,

		success: function (data) {
			data = data.trim();
			//console.log('success ' + data )
			if ( data.indexOf('smart-app-banner.css') > 0 )
			{
				reloginApp();
				return;
			}
			var split = data.split("|");
			if ( split.length >= 3 )
			{
//				console.log('city ' + split[0] );
				if ( cityEntry != null && cityEntry != undefined && cityEntry.value.trim() == "" )
				{
					var idx = findIndexSelect("city", split[0]);
					if ( idx > 0 )
						document.getElementById("city").selectedIndex = idx;
					else
						addItemToSelect("city", split[0]);
				}				
//				console.log('state ' + split[1] );
				if ( stateEntry != null && stateEntry != undefined && stateEntry.value.trim() == "" )
				{
					var idx = findIndexSelect("state", split[1]);
					if ( idx > 0 )
						document.getElementById("state").selectedIndex = idx;
					else
						addItemToSelect("state", split[1]);
				}
				
//				console.log('county ' + split[2] );
				if ( countyEntry != null && countyEntry != undefined && countyEntry.value.trim() == "" )
				{
					var idx = findIndexSelect("county", split[2]);
					if ( idx > 0 )
						document.getElementById("county").selectedIndex = idx;
					else
						addItemToSelect("county", split[2]);
				}
				
				var territoryEntry = document.getElementById("territory");
				if ( split.length === 4 && territoryEntry != null && territoryEntry != undefined && territoryEntry.value.trim() == "" )
				{
					var idx = findIndexSelect("territory", split[3]);
					if ( idx > 0 )
						territoryEntry.selectedIndex = idx;
				}
			}
//			findIndexSelect(selectId, value)
/*
				<FormField type='select' label="County" field='county' lookup_name='county' required='false' enabled='true' showList="false" sortable='false' filterable='false' size='20'></FormField>
				<FormField type='select' label="City" maxlength='100' field='city' lookup_name='city' required='false' enabled='true' size='20'></FormField>
				<FormField type='select' label="State" field='state' lookup_name='state_code' required='false' enabled='true' showList="false" sortable='false' filterable='false' size='20'></FormField>
*/
			
			//$(".flexmeNotes").flexReload();
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}


function zipBillBlur()
{
	// if county and state and city are empty
	var countyEntry = document.getElementById("billaddress2");
	var stateEntry = document.getElementById("billstate");
	var cityEntry = document.getElementById("billcity");
	
	if  ( cityEntry != null && stateEntry != null && cityEntry.value.trim() != "" && stateEntry.value.trim() != "" && countyEntry.value.trim() != "")
	{
		// all ready have data
		return;
	}
	
	var zipEntry = document.getElementById("billzip");
	var zip = null;
	if ( zipEntry != null )
	{
		zip = zipEntry.value;
	}
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=zip&terr=1&zip=" + zip,

		success: function (data) {
			data = data.trim();
			//console.log('success ' + data )
			if ( data.indexOf('smart-app-banner.css') > 0 )
			{
				reloginApp();
				return;
			}
			var split = data.split("|");
			if ( split.length >= 3 )
			{
//				console.log('city ' + split[0] );
				if ( cityEntry != null && cityEntry != undefined && cityEntry.value.trim() == "" )
				{
					var idx = findIndexSelect("billcity", split[0]);
					if ( idx > 0 )
						document.getElementById("billcity").selectedIndex = idx;
					else
						addItemToSelect("billcity", split[0]);
				}				
//				console.log('state ' + split[1] );
				if ( stateEntry != null && stateEntry != undefined && stateEntry.value.trim() == "" )
				{
					var idx = findIndexSelect("billstate", split[1]);
					if ( idx > 0 )
						document.getElementById("billstate").selectedIndex = idx;
					else
						addItemToSelect("billstate", split[1]);
				}
				
//				console.log('county ' + split[2] );
				if ( countyEntry != null && countyEntry != undefined && countyEntry.value.trim() == "" )
				{
					var idx = findIndexSelect("billaddress2", split[2]);
					if ( idx > 0 )
						document.getElementById("billaddress2").selectedIndex = idx;
					else
						addItemToSelect("billaddress2", split[2]);
				}
				
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}



function manualEnterCity()
{
	var statesdemo = {
	state0: {
		title: "Enter the name of the city?",
		html: '<input type="text" name="fname" size="70" value=""></input>',
		focus: "input[name='fname']",
		buttons: { OK: true, Cancel: false },
		submit:function(e,v,m,f){
		  if(v)
		  {
			 e.preventDefault();
			 $.prompt.close();
			 var cityList = document.getElementById('city');
			 
			 cityList.value = f.fname;
			 console.log("Set city to " + f.fname );
			 var idx = findIndexSelect("city", f.fname);
			 if ( idx > 0 )
		 		cityList.selectedIndex = idx;
		 	 else
				addItemToSelect("city", f.fname);
		  }
		}
	},
};

$.prompt(statesdemo);
}

function sighten(uuid)
{
	$.ajax({
		type: "GET",
		url: "modules/plugins/integrations/sighten_cmd.jsp?cmd=postlead&key=" + uuid,
		data: "",
		success: function (data) {
			data = data.trim();
			if ( data.indexOf("Success") != -1 )
			{
				xdInfo("Information pushed to Sighten");
			}
			else
			{
				xdError( data );
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});	
}

function formstack(uuid)
{
	$.ajax({
		type: "GET",
		url: "modules/plugins/integrations/formstack_cmd.jsp?cmd=postlead&key=" + uuid,
		data: "",
		success: function (data) {
			data = data.trim();
			if ( data.indexOf("Success") != -1 )
			{
				xdInfo("Information pushed to FormStack");
			}
			else
			{
				xdError( data );
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});	
}
function eperiscope(uuid)
{
	$.ajax({
		type: "GET",
		url: "modules/plugins/integrations/eperiscope_cmd.jsp?cmd=postlead&key=" + uuid,
		data: "",
		success: function (data) {
			data = data.trim();
			if ( data.indexOf("Success") != -1 )
			{
				xdInfo("Information pushed to Energy Periscope");
			}
			else
			{
				xdError( data );
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});	
}

function stateBlur()
{
	var countyEntry = document.getElementById("county");
	var stateEntry = document.getElementById("state");

// if there is already a county dont search it	
	if  ( stateEntry.value.trim() == "" || countyEntry.value.trim() !== "")
	{
		// nothing to search
		console.log("Exit");
		return;
	}
	
	if ( countyEntry != null )
		countyEntry.innerHTML = "";
	addItemToSelect("county", "" );
	
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=county_lookup&state=" + stateEntry.value.trim(),

		success: function (data) {
			data = data.trim();
			var results = JSON.parse( data );
			for ( var i = 0; i < results.length; ++i )
			{
				addItemToSelect("county", results[i] );
			}
			
			if ( countyEntry != null )
				countyEntry.selectedIndex = 0;

		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function stateBillBlur()
{
	var countyEntry = document.getElementById("billaddress2");
	var stateEntry = document.getElementById("billstate");

// if there is already a county dont search it	
	if  ( stateEntry.value.trim() == "" || countyEntry.value.trim() !== "")
	{
		// nothing to search
		console.log("Exit");
		return;
	}
	
	if ( countyEntry != null )
		countyEntry.innerHTML = "";
	addItemToSelect("billaddress2", "" );
	
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=county_lookup&state=" + stateEntry.value.trim(),

		success: function (data) {
			data = data.trim();
			var results = JSON.parse( data );
			for ( var i = 0; i < results.length; ++i )
			{
				addItemToSelect("billaddress2", results[i] );
			}
			
			if ( countyEntry != null )
				countyEntry.selectedIndex = 0;

		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}



function clearZip()
{
	var countyEntry = document.getElementById("county");
	if ( countyEntry != null )
		countyEntry.value = '';
	var stateEntry = document.getElementById("state");
	if ( stateEntry != null )
		stateEntry.value = '';
	var cityList = document.getElementById("city");
	if ( cityList != null )
		cityList.value = '';
	var zip = document.getElementById("zip");
	if ( zip != null )
		zip.value = '';
	zip = document.getElementById("zip_code");
	if ( zip != null )
		zip.value = '';
}

function countyBlur()
{
	var countyEntry = document.getElementById("county");
	var stateEntry = document.getElementById("state");
	var cityList = document.getElementById("city");
	
	if  ( (stateEntry.value.trim() == "" && countyEntry.value.trim() == "") || cityList.value.trim() !== "")
	{
		// nothing to search
		return;
	}
	
	if ( cityList != null )
		cityList.innerHTML = "";
	addItemToSelect("city", "" );
	
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=city_lookup&state=" + stateEntry.value.trim() + "&county=" + countyEntry.value.trim(),

		success: function (data) {
			data = data.trim();
			var results = JSON.parse( data );
			for ( var i = 0; i < results.length; ++i )
			{
				addItemToSelect("city", results[i] );
			}
			if ( cityList != null )
				cityList.selectedIndex = 0;
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}



function clearBillZip()
{
	var countyEntry = document.getElementById("billaddress2");
	if ( countyEntry != null )
		countyEntry.value = '';
	var stateEntry = document.getElementById("billstate");
	if ( stateEntry != null )
		stateEntry.value = '';
	var cityList = document.getElementById("billcity");
	if ( cityList != null )
		cityList.value = '';
	var zip = document.getElementById("billzip");
	if ( zip != null )
		zip.value = '';
}

function countyBillBlur()
{
	var countyEntry = document.getElementById("billaddress2");
	var stateEntry = document.getElementById("billstate");
	var cityList = document.getElementById("billcity");
	
	if  ( (stateEntry.value.trim() == "" && countyEntry.value.trim() == "") || cityList.value.trim() !== "")
	{
		// nothing to search
		return;
	}
	
	if ( cityList != null )
		cityList.innerHTML = "";
	addItemToSelect("billcity", "" );
	
	$.ajax({
		type: "GET",
		url: "modules/common/zip_cmd.jsp",
		data: "cmd=city_lookup&state=" + stateEntry.value.trim() + "&county=" + countyEntry.value.trim(),

		success: function (data) {
			data = data.trim();
			var results = JSON.parse( data );
			for ( var i = 0; i < results.length; ++i )
			{
				addItemToSelect("billcity", results[i] );
			}
			if ( cityList != null )
				cityList.selectedIndex = 0;
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}



function getField(field)
{
	text = document.getElementById(field);
	var val = "";
	if ( text != null )
		val = text.value;
	
	return val;
}

function openSolar()
{
	window.open("https://www.opensolar.com?nomenu=1").focus();
}

function googleSunRoof()
{
	var address = document.getElementById("address1").value;
	if ( document.getElementById("address2").value != "" )
		address += ", " + document.getElementById("address2").value;
	address += ", " + document.getElementById("city").value;
	address += ", " + document.getElementById("state").value;
	address += ", " + document.getElementById("zip_code").value;
	address = address.replace(" ", "%20");
	window.open("https://www.google.com/get/sunroof#a=" + address + ",%20USA&b=125&f=buy&np=35&nomenu=1&p=1" ).focus();
}

function openAddress(url)
{
	var address = document.getElementById("address1").value;
	if ( document.getElementById("address2").value != "" )
		address += "%20" + document.getElementById("address2").value;
	address = address.replace(" ", "%20");
	window.open(url + address, 'Edit2' ).focus();
}

function openGoogleMaps()
{
	var url = 'https://www.google.com/maps/place/$F{address1},+$F{city},+$F{state}+$F{zip}/&nomenu=1';
	
	url = url.replace("$F{state}", getField('state') );
	url = url.replace("$F{city}", getField('city') );
	url = url.replace("$F{address1}", getField('address1') );
	url = url.replace("$F{zip}", getField('zip_code') );
	
	url = url.replace(" ", "%20");
	window.open( url ).focus();
}

function openZillowMaps()
{
	var url = 'http://www.zillow.com/homes/$F{address1}-$F{city}-$F{state}-$F{zip}_rb/';
	
	url = url.replace("$F{state}", getField('state').replace("%20", "-") );
	url = url.replace("$F{city}", getField('city').replace("%20", "-") );
	url = url.replace("$F{address1}", getField('address1').replace("%20", "-") );
	url = url.replace("$F{zip}", getField('zip_code') );
	
	url = url.replace(" ", "-");
	window.open( url + "&nomenu=1").focus();
}


function onCustClick()
{
	if ( document.getElementById("cust_div").style.display == 'block' )
	{		
		document.getElementById("cust_div").style.display='none';
	}
	else
	{
		document.getElementById("cust_div").style.display='block';
	}
}

function setLastContact()
{
	var contact = document.getElementById("last_contact_date");
	if ( contact ) {

		var d = new Date();
		
		var dateToInput = '';//d.getFullYear() + '-' ;
		if ( d.getMonth() < 10 )
			dateToInput += '0';
		dateToInput += (d.getMonth()+1) + '/' ;
		if ( d.getDate() < 10 )
			dateToInput += '0';
		dateToInput += d.getDate();
		dateToInput += '/' + d.getFullYear();
		contact.value = dateToInput;
	}	
}

function afterDateSet(type)
{
	if ( type === 'statusFollowDate' )
	{
		var follow = $('#follow_up_date');
		var dt = $('#statusFollowDate').val();
		if ( follow.length === 1 && dt != '' )
		{
			follow.val( dt );
			var cb = document.getElementById('force_status_save');
			if ( cb )
				cb.checked = true;
		}
		
		setLastContact();
	}
}

function openCallFollowupCalendar()
{
	$('#statusFollowDate').focus();
window.open('modules/dispatch/calendar.jsp?nomenu=1&read_only=true&category=call_followup&select=1&field=statusFollowDate&fieldTime=statusFollowDate').focus();
}

function openApptFollowupCalendar()
{
window.open('modules/dispatch/calendar.jsp?nomenu=1&read_only=true&category=appointment_followup&select=1&field=apptFollowDate&fieldTime=apptFollowDate').focus();
}

function openAppt()
{
	$('#apptTimeTime').focus();
	
window.open('index.jsp?nomenu=1&page=modules/dispatch/calendar.jsp%3Fread_only=true%26category=appointment%26select=1%26field=apptTime%26fieldTime=apptTime').focus();
}

function openFollowup()
{
window.open('modules/dispatch/calendar.jsp?nomenu=1&read_only=true&category=followup&select=1&field=follow_up_date').focus();
}

function emailSalesRep(uuid)
{
	$.ajax({
		type: "GET",
		url: "modules/crm/lead_cmd.jsp",
		data: "cmd=email&uuid=" + uuid,
		success: function (data) {
			xdInfo("Sent customer information to assigned user");
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function onLeadSourceChange(flag)
{
	var lead_source = document.getElementById("lead_source").value;
	var lead_name = document.getElementById("refer").value;
	var lead_name_other = ( document.getElementById("refer_other") == null ? '' : document.getElementById("refer_other").value );

	
//	console.log("XXX " + lead_source + " ---- " + lead_name + " " + lead_name_other );
	
	if ( lead_source != "" )
	{
		if ( lead_name == "" )
			lead_name = lead_name_other;
	
		var url = "/sunbase/modules/crm/lead_cmd.jsp?cmd=load_leads";
		url += "&lead_source=" + escape(lead_source.trim());
		url += "&lead_name=" + escape(lead_name.trim());
		url += "&flag=" + flag;
		console.log( url );
		
/*		
        showOverlay();
		$.ajax({
				url: url,
				success: function(result) {
					$('#refer')[0].options.length = 0;
					if ( result.trim() == '' ) // if no value show text
					{
						document.getElementById("refer").style.display = "none";
						document.getElementById("refer_other").style.display = "";		
						document.getElementById("refer").value = "";
					}
					else
					{
						document.getElementById("refer").style.display = "";
						document.getElementById("refer_other").style.display = "none";		
						document.getElementById("refer_other").value = "";
			//			console.log( result );
						$('#refer')[0].options.length = 0;
						$("#refer").append(result);
					}
				},
				complete: function( xhr, status ) {
					hideOverlay();
				}
			}); 	
*/


		$.ajax({
			type: "POST",
			url: url,
			data: '',

			success: function (result) {
					$('#refer')[0].options.length = 0;
					if ( result.trim() == '' ) // if no value show text
					{

						document.getElementById("refer").style.display = "none";
						document.getElementById("refer_other").style.display = "";		
						document.getElementById("refer").value = "";
					}
					else
					{
						document.getElementById("refer").style.display = "";
						document.getElementById("refer_other").style.display = "none";		
						document.getElementById("refer_other").value = "";
			//			console.log( result );
						$('#refer')[0].options.length = 0;
						$("#refer").append(result);
					}
			}
		});	
	}
		/*
	   select = document.getElementById('selectElementId');

for (var i = min; i<=max; i++){
    var opt = document.createElement('option');
    opt.value = i;
    opt.innerHTML = i;
    select.appendChild(opt);
	*/

}
function setHist()
{
	var apptHist = document.getElementById('appt_save_backup');
	if ( apptHist )
	{
		apptHist.checked = true;
	}
}

function onApptStatusChange()
{
	var apptStatus = document.getElementById('appointment_status');
	var leadStatus = document.getElementById('lead_status');
	var custType = document.getElementById('custType');
	
	var apptStatusCode = ( apptStatus != null ? apptStatus.value.toLowerCase() : 0 ); 
	if ( apptStatus && apptStatusCode.trim() === '' )
	{
		return;
	}
	if ( apptStatus != null && apptStatusCode == 'set' )
	{
		leadStatus.value = 'Set';
		if ( custType.value == 'lead' )
			custType.value='opportunity';
	}
else if ( apptStatusCode != null && apptStatusCode.length > 2 && "set".indexOf(apptStatusCode) != -1 ) { custType.value='opportunity'; }
else if ( apptStatusCode != null && apptStatusCode.length > 2 && "sold deal".indexOf(apptStatusCode) != -1 ) { custType.value='customer'; }

	else if ( apptStatus != null && apptStatusCode == 'quote' )
	{
//		leadStatus.value = 'Set';
		if ( custType.value == 'lead' )
			custType.value='opportunity';
	}
	else if ( apptStatus != null && apptStatusCode.indexOf('sold') != -1 )
	{
//	Sold pending install OR SOLD SHEDULE INSTALL
		if ( custType.value == 'lead' || custType.value == 'opportunity' )
		{
			custType.value='customer';
			leadStatus.value = 'New Sales';
		}
	}
	else if ( apptStatus != null && apptStatus.length > 1 )
	{	
		
	}



	
	
}


	function choosePrint(uuid)
	{

			window.open("modules/common/print_record.jsp?recordType=customer&parentId=" + uuid).focus()
		
}

function dupCheck()
{
	var uuid = document.getElementById("uuid");
	
	var firstName = document.getElementById("first_name");
	var lastName = document.getElementById("last_name");
	var address = document.getElementById("address1");

	if ( lastName.value == "" && address.value == "")
		return;
	
	var secFirstName = document.getElementById("second_first_name");
	var secLastName = document.getElementById("second_last_name");
	
	var phone1 = document.getElementById("phone1");

	var url = "modules/crm/lead_cmd.jsp?cmd=dup_check";
	url += "&first_name=" + firstName.value;
	url += "&last_name=" + lastName.value;
	url += "&address=" + address.value;
	
	url += "&second_first_name=" + secFirstName.value;
	url += "&second_last_name=" + secLastName.value;
	url += "&phone1=" + phone1.value;
	url += "&key=" + uuid.value;
	//alert( url );
	
	
	$.ajax({
		type: "POST",
		url: url,
		data: '',

		success: function (result) {
			if ( result.trim() == 'dup' )
				document.getElementById("duplicate").style.display = 'block';
			else
				document.getElementById("duplicate").style.display = 'none';
		}
	});		
}

function onLeadStatusChange()
{
	var apptStatus = document.getElementById('appointment_status');
	var leadStatus = document.getElementById('lead_status');
	
	var contact = document.getElementById("last_contact_date");
	if ( contact ) {

		var d = new Date();
		
		var dateToInput = '';//d.getFullYear() + '-' ;
		if ( d.getMonth() < 10 )
			dateToInput += '0';
		dateToInput += (d.getMonth()+1) + '/' ;
		if ( d.getDate() < 10 )
			dateToInput += '0';
		dateToInput += d.getDate();
		dateToInput += '/' + d.getFullYear();
		contact.value = dateToInput;
	}
	
}


var scheduleFieldname = "";
function setApptTimeSelectedCust(day, time)
{
	console.log(" " + day + " " + time + " " + scheduleFieldname );
	time = parseInt(time);
	
	var date = document.getElementById(scheduleFieldname);
	if ( date )
	{
		if ( date.type === 'text' )
		{
			var p = day.split('-');
			date.value = "" + p[1] + '/' + p[2] + '/' + p[0];
			var mode = 0;
			if ( time > 11 )
				mode = 1;
			
			if ( time > 12 )
				time -= 12;
			
			document.getElementById( scheduleFieldname + 'Time').value = ( time > 9 ? time : '0' + time ) + ":00";
			document.getElementById( scheduleFieldname +'Mode').selectedIndex = mode;
		}
		else if ( date === 'date' )
		{
			date.value = "" + day + " " + time + ":00:00";
		}
	}
	
	
	// apptDate
/*	document.getElementById('apptDate').value = day;
	
	var timeEntry = '';
	if ( time == '9' )
	{
		document.getElementById('apptDateTime').value = "0" + time + ":00:00";
	}
	else if ( time == '11' )
	{
		document.getElementById('apptDateTime').value = "" + time + ":00:00";
	}
	else if ( time == '1' || time == '13' )
	{
		document.getElementById('apptDateTime').value = "13:00:00";
	}
	else if ( time == '3' || time == '15' )
	{
		document.getElementById('apptDateTime').value = "15:00:00";
	}
	else if ( time == '5' || time == '17' )
	{
		document.getElementById('apptDateTime').value = "17:00:00";
	}
*/
	$.prompt.close();
}


function scheduleNow(field, mode)
{
	scheduleFieldname = field;
	
	
	var date = new Date();
	
	var terr = '';
	var territory = document.getElementById('territory');
	if ( territory && territory.value !== '' )
		terr = '&terr=' + territory.value;
		
	
	var url = 'modules/calendar/schedule_table.jsp?type=&main=1&zip=' + document.getElementById('zip_code').value + '&callback=Cust&typeMode=' + escape(mode) + terr;
	$.ajax({
		type: "GET",
		url: url,
		success: function (html) {
			var statesdemo = {
				state0: {
					html:html,
					title: "Schedule",
					buttons: { "Add": 1, "Cancel": -1 },
					//focus: "input[name='fname']",
					submit:function(e,v,m,f){ 
					}// end of submit
				  }
				}
			if ( statesdemo != null )
				$.prompt(statesdemo);
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function convertDateToString(d)
{
	var text = '';
	var month = d.getMonth() + 1;
	if ( month < 10 )
		text = '0';
	text += month + "/";

	if ( d.getDate() < 10 )
		text += '0';
	text += d.getDate();

	text += '/' + ( 1900 + d.getYear() );

	return text;
}

function setFollowupBlur()
{
	$('#statusFollowDate').blur(function(){
		
		console.log(2);
		var follow = $('#follow_up_date');
		var dt = $('#statusFollowDate').val();
		if ( dt != '' )
		{
			follow.val( dt );
			last_contact_date.value = convertDateToString( new Date() );
			
			var cb = document.getElementById('force_status_save');
			if ( cb )
				cb.checked = true;
		}
	});
	$('#statusFollowDateTime').change(function(){
		console.log(1);
		var follow = $('#follow_up_date');
		var dt = $('#statusFollowDate').val();
		if ( follow && dt != '' )
		{
			last_contact_date.value = convertDateToString( new Date() );
			follow.val( dt );
			var cb = document.getElementById('force_status_save');
			if ( cb )
				cb.checked = true;
		}
	});
	
	$('#apptTimeTime').blur(function(){
		
		var dt = $('#apptTime').val();
		var dtTime = $('#apptTimeTime').val();
		if ( dt != '' && dtTime != '' && document.getElementById('appointment_status').value.trim() === '' && document.getElementById('custType').value === 'lead' )
		{
			$.prompt("Do you want to mark this as an opportunity?", {
				title: "Confirm",
				buttons: { "Yes": true, "No": false },
				submit: function(e,v,m,f){
					if ( v == true )
					{
						
						document.getElementById('appointment_status').value = "set";
						document.getElementById('custType').value = "opportunity";
					}
				}							
			});										
		}
	});
	
}


function creditCheck()
{
	var data = 'key=' + uuid.value;
	var field = document.getElementById('first_name');
	if ( field )
		data += '&first_name=' + escape( field.value );
	
	field = document.getElementById('last_name');
	if ( field )
		data += '&last_name=' + escape( field.value );

	field = document.getElementById('address1');
	if ( field )
		data += '&address1=' + escape( field.value );

	field = document.getElementById('city');
	if ( field )
		data += '&city=' + escape( field.value );

	field = document.getElementById('state');
	if ( field )
		data += '&state=' + escape( field.value );

	field = document.getElementById('zip_oode');
	if ( field )
		data += '&zip=' + escape( field.value );

	field = document.getElementById('ssn');
	if ( field )
		data += '&ssn=' + escape( field.value );
	
	field = document.getElementById('date_of_birth');
	if ( field )
		data += '&date_of_birth=' + escape( field.value );

	field = document.getElementById('email');
	if ( field )
		data += '&email=' + escape( field.value );

	$.ajax({
		type: "GET",
		url: "modules/plugins/integrations/credit_cmd.jsp?cmd=creditCheck",
		data: data,
		success: function (data) {
			data = data.trim();
			if ( data.indexOf("Success") != -1 )
			{
				xdInfo("Information pushed");
			}
			else
			{
				xdError( data );
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});	
}

</script>





<script>

function convertLead()
{
	//window.open('../dispatch/servicecall_edit.jsp?cust_uuid=' + f0b0668623a5493b982e2f216cdd6735 );
	
	spaNavigatePath('modules/crm/customer_edit.jsp?key=f0b0668623a5493b982e2f216cdd6735');
}

function cancelGeocode()
{
	document.getElementById('container').style.display="block";
	document.getElementById('geocode_div').style.display="none";
}

function mapIt()
{
	var address = document.getElementById("address1").value;
	address += "+" + document.getElementById("address2").value;
	address += "+" + document.getElementById("city").value;
	address += "+" + document.getElementById("state").value;
	address += "+" + document.getElementById("zip_code").value;
	
	address = address.replace(" ", "+");
	window.open("https://www.google.com/maps/place/" + address ).focus();
}
function selectGeocode(lat, longi)
{
	document.getElementById("latitude").value = lat;
	document.getElementById("longitude").value = longi;

	document.getElementById("address1").style.background = 'LightGreen';

	document.getElementById('container').style.display="block";
	document.getElementById('geocode_div').style.display="none";

}
function geocodeAddress()
{

	document.getElementById('container').style.display="none";
	document.getElementById('geocode_div').style.display="block";

	var address = document.getElementById("address1").value.trim();
	//address += " " + document.getElementById("address2").value;
//	address += " " + document.getElementById("city").value;
//	address += " " + document.getElementById("state").value;
	address += " " + document.getElementById("zip_code").value;
	address = address.trim();

//	address = address.replace("", /\+/g);

	$("#geocode_div").load("modules/common/geocode.jsp?address=" + escape(address) + "&zip=" + document.getElementById("zip_code").value);
}

function stopRKey(evt) { 
  var evt = (evt) ? evt : ((event) ? event : null); 
  var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
  if ((evt.keyCode == 13) && (node.type=="text"))  {return false;} 
} 

document.onkeypress = stopRKey; 

</script>

<div id="geocode_div" style="display:none">
Searching for GPS
</div>
	
	

	<div align="right" id="commandButtons">	
		<fieldset>
			<input type="button" id="saveButton" name="saveButton" onclick="checkFormCloseOnSuccess(&#39;modules/crm/lead_cmd.jsp&#39;)" class="primary-btn btn-tall btn-medium" value="Save">		
		<input type="button" onclick="checkFormAndReload(&#39;modules/crm/lead_cmd.jsp&#39;, &#39;&#39;)" class="btn-tall btn-medium" name="submitStay" id="submitStay" value="Save/Stay">		
			<input type="button" style="width: 140px" onclick="closeTabWindow()" class="btn-tall btn-medium" name="cancel" id="cancel" value="Cancel">		
		</fieldset>
	</div>		
	

<div id="duplicate" style="display:none">
	<img src="./edit_files/dup.png">
</div>

<div id="container" style="display:block">

<table>
<tbody><tr>


<td>
		<h1>Edit a Lead  (test tester)</h1>
</td>
<!--		<a href='#' onclick='window.open("/sunbase/index.jsp?page=modules/crm/lead_edit.jsp%3Fprint_mode=1%26key=f0b0668623a5493b982e2f216cdd6735").focus()'>Print Mode</a> -->

<td>					
		
			<a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="window.open(&quot;modules/common/print_record.jsp?nomenu=1&amp;recordType=customer&amp;parentId=f0b0668623a5493b982e2f216cdd6735&quot;)"><img width="32" title="Print Record" height="32" src="./edit_files/print.png"></a>			
			<a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="mapIt()"><img width="32" title="Google Map It" height="32" src="./edit_files/icon_google_maps.png"></a>									
				
</td>
</tr>
</tbody></table>
		
		<form class="prettyForm" onsubmit="return false;" id="form1" action="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" method="get" style="height:2000px">	
			<input type="hidden" id="stay_flag" value="">		
			<input type="hidden" name="cmd" id="cmd" value="update">
			<input type="hidden" name="uuid" id="uuid" value="f0b0668623a5493b982e2f216cdd6735">
			<input type="hidden" name="uuid_customer" id="uuid_customer" value="f0b0668623a5493b982e2f216cdd6735" size="50">

			<input type="hidden" name="longitude" id="longitude" value="" size="50">
			<input type="hidden" name="latitude" id="latitude" value="" size="50">
						

			<div id="tabs" style="display: block;" class="ui-tabs ui-widget ui-widget-content ui-tabs-vertical ui-helper-clearfix">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix" role="tablist">
<li class="ui-state-default ui-tabs-active ui-state-active ui-corner-left" role="tab" tabindex="0" aria-controls="tabs-1" aria-labelledby="ui-id-1" aria-selected="true"><a onclick='$(".tab_control").hide(); $("#tabs-1").show(); return false' href="#" class="ui-tabs-anchor" role="presentation" tabindex="-1" id="ui-id-1">Customer Details</a></li>
<li class="ui-state-default ui-corner-left" role="tab" tabindex="-1" aria-controls="tabs-2b" aria-labelledby="ui-id-2" aria-selected="false"><a href="#" onclick='$(".tab_control").hide(); $("#tabs-2b").show(); return false' class="ui-tabs-anchor" role="presentation" tabindex="-1" id="ui-id-2">Energy Details</a></li>
<li class="ui-state-default ui-corner-left" role="tab" tabindex="-1" aria-controls="tabs-3" aria-labelledby="ui-id-3" aria-selected="false"><a href="#" onclick='$(".tab_control").hide(); $("#tabs-3").show(); return false' class="ui-tabs-anchor" role="presentation" tabindex="-1" id="ui-id-3">Interests</a></li>
<li class="ui-state-default ui-corner-left" role="tab" tabindex="-1" aria-controls="tabs-4" aria-labelledby="ui-id-4" aria-selected="false"><a href="#" onclick='$(".tab_control").hide(); $("#tabs-4").show(); return false' class="ui-tabs-anchor" role="presentation" tabindex="-1" id="ui-id-4">Call/Appointment History</a></li>
<li style="display:none" class="ui-state-default ui-corner-left" role="tab" tabindex="-1" aria-controls="tabs-2" aria-labelledby="ui-id-5" aria-selected="false"><a href="#" onclick='$(".tab_control").hide(); $("#tabs-2").show(); return false' class="ui-tabs-anchor" role="presentation" tabindex="-1" id="ui-id-5">Preference</a></li>
<li class="ui-state-default ui-corner-left" role="tab" tabindex="-1" aria-controls="tabs-9" aria-labelledby="ui-id-9" aria-selected="false"><a href="#" onclick='$(".tab_control").hide(); $("#tabs-9").show(); return false' class="ui-tabs-anchor" role="presentation" tabindex="-1" id="ui-id-9">Actions</a></li>
</ul>
<div id="tabs-1" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-1" role="tabpanel" aria-expanded="true" aria-hidden="false">

<fieldset class="detailFS"><table class="detailForm"><tbody><tr><td><label for="leadReceived">Lead Date</label><div class="fieldBox"><input type="text" name="leadReceived" id="leadReceived" value="11/13/2020" onblur="isValidDate(this)" size="10"><span class="input-group-addon" title="Pick the date" onclick="displayDatePicker(&#39;leadReceived&#39;)"><span class="actBox glyphicon glyphicon-calendar"></span></span><span class="input-group-addon" title="Clear" onclick="document.getElementById(&#39;leadReceived&#39;).value=&#39;&#39;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div></td><td><label for="custType">Record Type</label><div class="fieldBox"><select name="custType" id="custType"><option value="lead" selected="">Lead</option><option value="opportunity">Opportunity</option><option value="customer">Customer</option></select></div></td></tr><tr><td><label for="lead_source">Lead Source</label><div class="fieldBox"><select name="lead_source" id="lead_source" onblur="onLeadSourceChange(0)"><option value=""> </option><optgroup label="Internet"><option value="Website">Website</option><option value="Facebook">Facebook</option><option value="Google Adwords">Google Adwords</option><option value="Paid Leads">Paid Leads</option><option value="Email Blast">Email Blast</option></optgroup><optgroup label="Referral"><option value="Customer Referral">Customer Referral</option><option value="Employee Referral">Employee Referral</option></optgroup><optgroup label="SelfGen"><option value="Sales Rep">Sales Rep</option><option value="Phone Inquiry">Phone Inquiry</option><option value="Canvassing">Canvassing</option><option value="Yard Sign">Yard Sign</option></optgroup><option value=" " selected=""> </option></select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;lead_source&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td><td><label for="refer">Lead Name</label><input type="text" name="refer_other" id="refer_other" value=" " size="20"><select name="refer" id="refer" style="display:none"></select><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="editLookup(&quot;event&quot;, &quot;&quot;)" title="Edit Lookup"> <img src="./edit_files/edit.png"></a></td></tr><tr><td><label for="last_contact_date">Last Contact Date</label><div class="fieldBox"><input type="text" name="last_contact_date" id="last_contact_date" value="11/13/2020" onblur="isValidDate(this)" size="10"><span class="input-group-addon" title="Pick the date" onclick="displayDatePicker(&#39;last_contact_date&#39;)"><span class="actBox glyphicon glyphicon-calendar"></span></span><span class="input-group-addon" title="Clear" onclick="document.getElementById(&#39;last_contact_date&#39;).value=&#39;&#39;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div></td><td><label for="createTime">Received</label><div class="fieldBox"><input readonly="true" disabled="true" type="text" onblur="isDate(&#39;createTime&#39;)" name="createTime" id="createTime" value="11/13/2020" placeholder="MM/DD/YYYY" size="10"><span class="input-group-addon" title="Pick the date" onclick="displayDatePicker(&#39;createTime&#39;)"><span class="actBox glyphicon glyphicon-calendar"></span></span><span class="input-group-addon" title="Clear" onclick="document.getElementById(&#39;createTime&#39;).value=&#39;&#39;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div><input type="text" readonly="true" disabled="true" name="createTimeTime" id="createTimeTime" placeholder="HH:MM" size="6" value="10:32" onblur="validateHhMm(&#39;createTimeTime&#39;);;"><select class="amMode" readonly="true" disabled="true" name="createTimeMode" id="createTimeMode"><option value="AM" selected="selected">AM</option><option value="PM">PM</option></select></td></tr><tr><td><label for="first_name">Customer #1 First Name</label><input type="text" name="first_name" id="first_name" value="test" size="20" maxlength="255"></td><td><label for="last_name">Customer #1 Last Name</label><input type="text" name="last_name" id="last_name" value="tester" size="20" maxlength="255"></td></tr><tr><td><label for="second_first_name">Customer #2 First Name</label><input type="text" name="second_first_name" id="second_first_name" value="" size="20" maxlength="255"></td><td><label for="second_last_name">Customer #2 Last Name</label><input type="text" name="second_last_name" id="second_last_name" value="" size="20" maxlength="255"></td></tr><tr><td><label for="address1">Address</label><input type="text" name="address1" id="address1" value="" size="20" maxlength="255" onblur="dupCheck()"></td><td><label for="address2">Address2</label><input type="text" name="address2" id="address2" value="" size="20" maxlength="255"></td></tr><tr><td><label for="zip_code">Zip Code</label><div class="fieldBox"><input type="text" name="zip_code" id="zip_code" value="" size="10" maxlength="5" onblur="zipBlur()"><span class="input-group-addon" title="Geocode" onclick="geocodeAddress(); return false;"><span class="actBox glyphicon glyphicon-map-marker"></span></span><span class="input-group-addon" title="Clear Zip/State/County/City" onclick="clearZip(); return false;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div></td><td><label for="state">State</label><div class="fieldBox"><select name="state" id="state" onblur="stateBlur()"><option value=""> </option><option value="AL">Alabama</option><option value="AK">Alaska</option><option value="AZ">Arizona</option><option value="AR">Arkansas</option><option value="CA">California</option><option value="CO">Colorado</option><option value="CT">Connecticut</option><option value="DE">Delaware</option><option value="FL">Florida</option><option value="GA">Georgia</option><option value="HI">Hawaii</option><option value="ID">Idaho</option><option value="IL">Illinois</option><option value="IN">Indiana</option><option value="IA">Iowa</option><option value="KS">Kansas</option><option value="KY">Kentucky</option><option value="LA">Louisiana</option><option value="ME">Maine</option><option value="MD">Maryland</option><option value="MA">Massachusetts</option><option value="MI">Michigan</option><option value="MN">Minnesota</option><option value="MS">Mississippi</option><option value="MO">Missouri</option><option value="MT">Montana</option><option value="NE">Nebraska</option><option value="NV">Nevada</option><option value="NH">New Hampshire</option><option value="NJ">New Jersey</option><option value="NM">New Mexico</option><option value="NY">New York</option><option value="NC">North Carolina</option><option value="ND">North Dakota</option><option value="OH">Ohio</option><option value="OK">Oklahoma</option><option value="OR">Oregon</option><option value="PA">Pennsylvania</option><option value="PR">Puerto Rico</option><option value="RI">Rhode Island</option><option value="SC">South Carolina</option><option value="SD">South Dakota</option><option value="TN">Tennessee</option><option value="TX">Texas</option><option value="UT">Utah</option><option value="VT">Vermont</option><option value="VA">Virginia</option><option value="WA">Washington</option><option value="WV">West Virginia</option><option value="WI">Wisconsin</option><option value="WY">Wyoming</option><option value=" " selected=""> </option></select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;state_code&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td></tr><tr><td><label for="county">County</label><div class="fieldBox"><select name="county" id="county" onblur="countyBlur()"><option value=""> </option><option value=" " selected=""> </option></select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;county&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td><td><label for="city">City</label><div class="fieldBox"><select name="city" id="city"><option value=""> </option><option value=" " selected=""> </option></select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;city&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div><span title="Manual Override City" onclick="manualEnterCity(); return false;" class="actBox glyphicon glyphicon-option-vertical"></span></td></tr><tr><td><label for="territory">Territory</label><div class="fieldBox"><select name="territory" id="territory"><option value=""> </option><option value="872a82c0ecaa4bfab534779c4d85a103">East</option><option value="d5245d76bd7b4607a9b4fcf0b88d1e6b">North</option><option value="00b0a48814654147afcaeff4a0df1134">South</option><option value="2106f0e510db4a9eb02cf31e8a21f894">West</option></select><span class="input-group-addon" title="Edit Territory" onclick="spaNavigatePage(&#39;modules/dispatch/territory_form.jsp&#39;);return false;"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td><td><label for="gateCode">Gate Code</label><input type="text" name="gateCode" id="gateCode" value="" size="15" maxlength="10"></td></tr><tr><td><label for="phone1">Phone</label><div class="fieldBox"><input type="text" name="phone1" onblur="mask(this)" id="phone1" value="" maxlength="15" size="15"><input type="text" name="phone1_ext" id="phone1_ext" maxlength="7" value=" " size="5"></div></td><td><label for="phone_cell">Phone (Cell)</label><div class="fieldBox"><input type="text" name="phone_cell" onblur="mask(this)" id="phone_cell" value="" maxlength="15" size="15"><input type="text" name="phone_cell_ext" id="phone_cell_ext" maxlength="7" value=" " size="5"></div></td></tr><tr><td><label for="phone_work">Phone (Work)</label><div class="fieldBox"><input type="text" name="phone_work" onblur="mask(this)" id="phone_work" value="" maxlength="15" size="15"><input type="text" name="phone_work_ext" id="phone_work_ext" maxlength="7" value=" " size="5"></div></td><td><label for="email">Email</label><div class="fieldBox"><input type="text" name="email" id="email" value=" " size="20" maxlength="100"></div></td></tr><tr><td><label for="follow_up_date">Follow Up Date</label><div class="fieldBox"><input type="text" name="follow_up_date" id="follow_up_date" value="11/19/2020" onblur="isValidDate(this)" size="10"><span class="input-group-addon" title="Pick the date" onclick="displayDatePicker(&#39;follow_up_date&#39;)"><span class="actBox glyphicon glyphicon-calendar"></span></span><span class="input-group-addon" title="Clear" onclick="document.getElementById(&#39;follow_up_date&#39;).value=&#39;&#39;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div></td><td><label for="leadGenCost">Lead Cost</label><div class="dollar"><input type="text" onkeypress="return isDecimalKey(event)" name="leadGenCost" id="leadGenCost" size="10"></div></td></tr><tr><td colspan="2"><label for="customerComments">Call Comments</label><textarea spellcheck="true" name="customerComments" id="customerComments" maxlength="300" row="5" style="width:500px;height:90px"> </textarea></td></tr>
</tbody></table></fieldset></div>
<div id="tabs-2b" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-2" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">
<fieldset class="detailFS"><table class="detailForm"><tbody><tr><td><table style="width:100%"><tbody><tr><td><label for="customField1">Utility Company </label>	<div class="fieldBox"><select name="customField1" id="customField1"><option id=""></option><option value="Duke">Duke</option><option value="FPL">FPL</option><option value="KUA">KUA</option><option value="OUC">OUC</option><option value="SECO">SECO</option><option value="Weststar">WS</option>	</select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;util_companies&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td><td><label for="customField26">System Size </label>	<input type="number" step=".01" onkeypress="return isDecimalKey(event)" name="customField26" id="customField26" value="" size="20"></td></tr><tr><td><label for="customField15">Roof Type </label>	<div class="fieldBox"><select name="customField15" id="customField15"><option id=""></option><option value="Barrel Tile">Barrel Tile</option><option value="Cement Tile">Cement Tile</option><option value="Flat">Flat</option><option value="Ground Rack">Ground Rack</option><option value="Metal">Metal</option><option value="Roof Rack">Roof Rack</option><option value="Shingle">Shingle</option><option value="Tar-N-Gravel">Tar-N-Gravel</option><option value="Tile">Tile</option><option value="unknown">unknown</option>	</select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;roof_type&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td><td><label for="customField17">Roof Stories </label>	<div class="fieldBox"><select name="customField17" id="customField17"><option id=""></option><option value="One Story">One Story</option><option value="Two Story">Two Story</option><option value="Three Story">Three Story</option>	</select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;roof_story&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td></tr><tr><td><label for="customField37">Avg Electric $ </label>	<input type="number" step="1" onkeypress="return isDecimalKey(event)" name="customField37" id="customField37" value="" size="10"></td></tr></tbody></table></td></tr>
</tbody></table></fieldset></div>
<div id="tabs-3" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-3" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">
<fieldset class="detailFS"><table class="detailForm"><tbody><tr><td><div class="grouplistbox"><ul id="grouplist" class="grouplist"><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_0" id="interest_0" value="fan">Attic Fan</label><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_1" id="interest_1" value="En Eval">Energy Evaluation</label><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_2" id="interest_2" value="insu">Insulation</label><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_3" id="interest_3" value="pump">Pump</label><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_4" id="interest_4" value="serv">Service</label><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_5" id="interest_5" value="elec">Solar Electric</label><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_6" id="interest_6" value="h2o">Solar Hot Water Heater</label><label style="overflow: hidden; text-overflow: ellipsis;display:inline-flex"><input type="checkbox" name="interest_7" id="interest_7" value="pool">Solar Pool Heater</label></ul><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="editLookup(&quot;lookup&quot;, &quot;lead_interest&quot;)" title="Edit Lookup"> <img src="./edit_files/edit.png"></a></div></td></tr><tr><td colspan="2"><label for="interest_other">Other</label><textarea spellcheck="true" name="interest_other" id="interest_other" maxlength="100" row="1" style="width:500px;height:90px"> </textarea></td></tr><tr><td colspan="2"><label for="interestComments">Interest Comments</label><textarea spellcheck="true" name="interestComments" id="interestComments" maxlength="300" row="1" style="width:500px;height:90px"> </textarea></td></tr>
</tbody></table></fieldset></div>
<div id="tabs-4" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-4" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">
<fieldset class="detailFS" id="cust_divxx"><table class="detailForm"><tbody><tr><td></td><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="onTimeline(); return false;"><img width="20" title="View timeline" height="16" src="./edit_files/timeline.png">View timeline</a><br><br></td></tr>
</tbody></table></fieldset><fieldset class="detailFS"><table class="detailForm"><tbody><tr><td><b>Telemarketing</b></td><td><b>Appointment Setter</b></td></tr><tr><td><label for="lead_status">Call Status</label><div class="fieldBox"><select name="lead_status" id="lead_status" onchange="setHist()" onblur="onLeadStatusChange()"><optgroup label="Campaign"><option value="Call Attempt 1 - NA">Call Attempt 1 - NA</option><option value="Call Attempt 2 - NA">Call Attempt 2 - NA</option><option value="Call Attempt 3 - NA">Call Attempt 3 - NA</option><option value="Bad #">Bad #</option><option value="No Number">No Number</option></optgroup><optgroup label="Other"><option value="Email">Email</option><option value="Text">Text</option><option value="Follow Up">Follow Up</option><option value="Stop By">Stop By</option></optgroup><option value="Call" selected="">Call</option></select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;LEAD_STATUS&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td><td><label for="appointment_status">Appointment Status</label><div class="fieldBox"><select name="appointment_status" id="appointment_status" onblur="onApptStatusChange()"><option value=""> </option><optgroup label="Appointment"><option value="Set">Set</option><option value="Presentation Made">Presentation Made</option><option value="Proposal Issued">Proposal Issued</option><option value="Reset">Reset</option></optgroup><optgroup label="Lost"><option value="Dead">Dead</option><option value="Price">Price</option><option value="WWAC">WWAC</option><option value="Not Interested">Not Interested</option></optgroup><optgroup label="Won"><option value="Paperwork Completed">Paperwork Completed</option><option value="Sold Deal">Sold Deal</option><option value="Completed">Completed</option></optgroup><option value=" " selected=""> </option></select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;appointment_status&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td></tr><tr><td><label for="appointmentSetter">Appointment Setter</label><select name="appointmentSetter" id="appointmentSetter"><option value=""></option><option value="d1f1779f29524e3281721f64ec316c8c">Jake A.</option><option value="c445ed7304074920b898b73b3011ef23">John L.</option><option value="e3a3fafa761944e1bfe2df6d831e31be">Josh D.</option></select></td><td><label for="salesUuid">Sales Rep</label><select name="salesUuid" id="salesUuid"><option value=""></option><option value="d1f1779f29524e3281721f64ec316c8c">Jake A.</option><option value="c445ed7304074920b898b73b3011ef23">John L.</option><option value="e3a3fafa761944e1bfe2df6d831e31be">Josh D.</option></select></td></tr><tr><td><label for="force_status_save">Force Status Save</label><input type="checkbox" name="force_status_save" id="force_status_save" title="The status saves a history record on change of status, if it has not changed you can click this to force it"></td><td><label for="apptTime">Appointment Start Time</label><div class="fieldBox"><input type="text" onblur="isDate(&#39;apptTime&#39;)" name="apptTime" id="apptTime" value="" readonly="true" placeholder="MM/DD/YYYY" size="10"><span class="input-group-addon" title="Pick the date" onclick="displayDatePicker(&#39;apptTime&#39;)"><span class="actBox glyphicon glyphicon-calendar"></span></span><span class="input-group-addon" title="Clear" onclick="document.getElementById(&#39;apptTime&#39;).value=&#39;&#39;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div><input type="text" name="apptTimeTime" id="apptTimeTime" placeholder="HH:MM" size="6" value="" onblur="validateHhMm(&#39;apptTimeTime&#39;);;"><select class="amMode" name="apptTimeMode" id="apptTimeMode"><option value="AM" selected="selected">AM</option><option value="PM">PM</option></select><a onclick="openAppt()" href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" title="Open scheduler calendar"><img width="25" height="25" src="./edit_files/scheduler.jpg"> </a></td></tr><tr><td></td><td><label for="apptEndTime">Appointment End Time</label><input type="text" name="apptEndTimeTime" id="apptEndTimeTime" placeholder="HH:MM" size="6" value="" onblur="validateHhMm(&#39;apptEndTimeTime&#39;);;"><select class="amMode" name="apptEndTimeMode" id="apptEndTimeMode"><option value="AM" selected="selected">AM</option><option value="PM">PM</option></select></td></tr><tr><td></td><td><label for="sendInvite">Send invite on save</label><input type="checkbox" name="sendInvite" id="sendInvite"></td></tr><tr><td><label for="statusFollowDate">Call Followup</label><div class="fieldBox"><input type="text" onblur="isDate(&#39;statusFollowDate&#39;)" name="statusFollowDate" id="statusFollowDate" value="" readonly="true" placeholder="MM/DD/YYYY" size="10"><span class="input-group-addon" title="Pick the date" onclick="displayDatePicker(&#39;statusFollowDate&#39;)"><span class="actBox glyphicon glyphicon-calendar"></span></span><span class="input-group-addon" title="Clear" onclick="document.getElementById(&#39;statusFollowDate&#39;).value=&#39;&#39;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div><input type="text" name="statusFollowDateTime" id="statusFollowDateTime" placeholder="HH:MM" size="6" value="" onblur="validateHhMm(&#39;statusFollowDateTime&#39;);;"><select class="amMode" name="statusFollowDateMode" id="statusFollowDateMode"><option value="AM" selected="selected">AM</option><option value="PM">PM</option></select><a onclick="openCallFollowupCalendar();setFollowupBlur()" href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" title="Open appointment followup calendar"><img width="25" height="25" src="./edit_files/scheduler.jpg"> </a></td><td><label for="apptFollowDate">Appointment Followup Time</label><div class="fieldBox"><input type="text" onblur="isDate(&#39;apptFollowDate&#39;)" name="apptFollowDate" id="apptFollowDate" value="" readonly="true" placeholder="MM/DD/YYYY" size="10"><span class="input-group-addon" title="Pick the date" onclick="displayDatePicker(&#39;apptFollowDate&#39;)"><span class="actBox glyphicon glyphicon-calendar"></span></span><span class="input-group-addon" title="Clear" onclick="document.getElementById(&#39;apptFollowDate&#39;).value=&#39;&#39;"><span class="actBox glyphicon glyphicon-remove-circle"></span></span></div><input type="text" name="apptFollowDateTime" id="apptFollowDateTime" placeholder="HH:MM" size="6" value="" onblur="validateHhMm(&#39;apptFollowDateTime&#39;);;"><select class="amMode" name="apptFollowDateMode" id="apptFollowDateMode"><option value="AM" selected="selected">AM</option><option value="PM">PM</option></select><a onclick="openApptFollowupCalendar()" href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" title="Open appointment followup calendar"><img width="25" height="25" src="./edit_files/scheduler.jpg"> </a></td></tr><tr><td><label for="verified_by">Verified By</label><select name="verified_by" id="verified_by"><option value=""></option><option value="d1f1779f29524e3281721f64ec316c8c">Jake A.</option><option value="c445ed7304074920b898b73b3011ef23">John L.</option><option value="e3a3fafa761944e1bfe2df6d831e31be">Josh D.</option></select></td></tr><tr><td><label for="bestTimeCall">Best Time</label><div class="fieldBox"><select name="bestTimeCall" id="bestTimeCall"><option value=""> </option><option value="morning">morning</option><option value="afternoon">afternoon</option><option value="evenings">evenings</option><option value=" " selected=""> </option></select><span class="input-group-addon" title="Edit Lookup" onclick="editLookup(&#39;lookup&#39;, &#39;best_time_call&#39;)"><span class="actBox glyphicon glyphicon glyphicon-pencil"></span></span></div></td></tr><tr><td></td><td><label for="salesPotential">Sales Potential</label><div class="dollar"><input type="text" onkeypress="return isDecimalKey(event)" name="salesPotential" id="salesPotential" size="10"></div></td></tr><tr><td></td><td><label for="closeProbability">Close Probability</label><input type="text" onkeypress="return isNumberKey(event)" name="closeProbability" id="closeProbability" value="" maxlength="10" size="10">%</td></tr><tr><td><label for="statusComments">Call Comments</label><textarea spellcheck="true" name="statusComments" id="statusComments" maxlength="300" row="5" style="width:300px;height:90px"></textarea></td><td><label for="appointmentComments">Appointment Notes/Comments</label><textarea spellcheck="true" name="appointmentComments" id="appointmentComments" maxlength="300" row="5" style="width:300px;height:90px"> </textarea></td></tr>
</tbody></table></fieldset>	


  
		<div class="flexigrid" style="width: 100%;"><div class="nDiv" style="margin-bottom: -198.889px; display: none; top: 0px; height: auto; width: auto;"><table cellpadding="0" cellspacing="0"><tbody><tr style="display:none"><td class="ndcol1"><input type="checkbox" class="togCol" value="0"></td><td class="ndcol2">key</td></tr><tr><td class="ndcol1"><input type="checkbox" checked="checked" class="togCol" value="1"></td><td class="ndcol2">Call Status</td></tr><tr><td class="ndcol1"><input type="checkbox" checked="checked" class="togCol" value="2"></td><td class="ndcol2">Followup Date</td></tr><tr><td class="ndcol1"><input type="checkbox" checked="checked" class="togCol" value="3"></td><td class="ndcol2">Note</td></tr><tr><td class="ndcol1"><input type="checkbox" checked="checked" class="togCol" value="4"></td><td class="ndcol2">User Id</td></tr><tr><td class="ndcol1"><input type="checkbox" checked="checked" class="togCol" value="5"></td><td class="ndcol2">Verified By</td></tr><tr><td class="ndcol1"><input type="checkbox" checked="checked" class="togCol" value="6"></td><td class="ndcol2">Date</td></tr></tbody></table></div><div class="mDiv"><div class="ftitle">Call History</div></div><div class="tDiv">
			<div class="tDiv2"><div class="fbutton"><div><span class="add" style="padding-left: 20px;">Add</span></div></div><div class="fbutton"><div><span class="edit" style="padding-left: 20px;">Edit</span></div></div><div class="fbutton"><div><span class="delete" style="padding-left: 20px;">Delete</span></div></div><div class="btnseparator"></div></div><div style="clear:both"></div></div><div class="hDiv"><div class="hDivBox"><table cellpadding="0" cellspacing="0"><thead><tr><th axis="col0" abbr="key" align="center" hidden="" style="display: none;"><div style="text-align: center; width: 40px;">key</div></th><th axis="col1" data-abbr="status" align="left"><div style="text-align: left; width: 100px;">Call Status</div></th><th axis="col2" data-abbr="followupDate" align="left"><div style="text-align: left; width: 135px;">Followup Date</div></th><th axis="col3" data-abbr="note" align="left"><div style="text-align: left; width: 500px;">Note</div></th><th axis="col4" abbr="createUserId" align="left"><div style="text-align: left; width: 150px;">User Id</div></th><th axis="col5" abbr="apptStatusVerifiedBy" align="left"><div style="text-align: left; width: 150px;">Verified By</div></th><th axis="col6" abbr="createDate" align="left"><div style="text-align: left; width: 135px;">Date</div></th></tr></thead></table></div></div><div class="cDrag" style="top: 1px;"><div style="height: 233.889px; display: none;"></div><div style="height: 233.889px; display: none;"></div><div style="height: 233.889px; display: none;"></div><div style="height: 233.889px; display: none;"></div><div style="height: 233.889px; display: none;"></div><div style="height: 233.889px; display: none;"></div><div style="height: 233.889px; display: none;"></div></div><div class="bDiv" style="height: 200px;"><table class="flexmeCallNotes" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td align="center" style="display: none;"><div style="text-align: center; width: 40px;">38a027dc5a6140abbf3bd653c65d28ec</div></td><td align="left"><div style="text-align: left; width: 100px;">Call</div></td><td align="left"><div style="text-align: left; width: 135px;"> </div></td><td align="left"><div style="text-align: left; width: 500px;"> </div></td><td align="left"><div style="text-align: left; width: 150px;">jdubin</div></td><td align="left"><div style="text-align: left; width: 150px;"> </div></td><td align="left"><div style="text-align: left; width: 135px;">11/13/2020 10:32 AM</div></td></tr></tbody></table><div class="iDiv" style="display: none;"></div></div><div class="pDiv"><div class="pDiv2"> <div class="pGroup"> <div class="pFirst pButton"><span></span></div><div class="pPrev pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"><span class="pcontrol">Page <input type="text" size="4" value="1"> of <span>1</span></span></div> <div class="btnseparator"></div> <div class="pGroup"> <div class="pNext pButton"><span></span></div><div class="pLast pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"> <div class="pReload pButton"><span></span></div> </div> <div class="btnseparator"></div> <div class="pGroup"><span class="pPageStat">Displaying 1 to 1 of 1 items</span></div></div><div style="clear:both"></div></div><div class="vGrip"><span></span></div><div class="hGrip" style="height: 0px;"><span></span></div></div>
        <script type="text/javascript">
            $(".flexmeCallNotes").flexigrid({
                url : '/sunbase/modules/common/call_notes_cmd.jsp?cmd=list&parent_uuid=f0b0668623a5493b982e2f216cdd6735&typeCode=call_hist',
                dataType : 'xml',

                colModel : [ 
					{ display : 'key', name : 'key', width : 40, hide:true,sortable : true, align : 'center' }, 					
					{ display : 'Call Status', name : 'status', width : 100, sortable : false, align : 'left'}, 
					{ display : 'Followup Date', name : 'followupDate', width : 135, sortable : false, align : 'left'}, 
					{ display : 'Note', name : 'note', width : 500, sortable : false, align : 'left'}, 
					{ display : 'User Id', name : 'createUserId', width : 150, sortable : true, align : 'left'},
					{ display : 'Verified By', name : 'apptStatusVerifiedBy', width : 150, sortable : true, align : 'left'},					
					{ display : 'Date', name : 'createDate', width : 135, sortable : true, align : 'left'}
					
                ],
                buttons : [ 
					{  name : 'Add', bclass : 'add', onpress : testNotesHist},                     
					{  name : 'Edit', bclass : 'edit', onpress : testNotesHist},                     
					{  name : 'Delete', bclass : 'delete', onpress : testNotesHist }, 
					{separator : true} 
				],
				sortname : "note",
                sortorder : "asc",
                usepager : true,
				title : 'Call History',
                useRp : false	,
                rp : 15,
				blockOpacity: .5,
                showTableToggleBtn : false,
				showToggleBtn : false,
                width : '100%',
                height : 200,
				singleSelect: true
            });      
		
            function testNotesHist(com, g, p, grid) 
			{
                if (com == 'Delete') {				
					if ( $('.flexmeCallNotes .trSelected', grid).length > 0 )
					{
						$.prompt("Are you sure you want to delete this record?", {
							title: "Confirm",
							buttons: { "Yes": true, "No": false },
							submit: function(e,v,m,f){
								// use e.preventDefault() to prevent closing when needed or return false. 
								// e.preventDefault(); 

								console.log("Value clicked was: "+ v);
								if ( v == true )
								{
									var key = $('.flexmeCallNotes .trSelected td:eq(0)').text();

									$.ajax({
										type: "POST",
										url: "/sunbase/modules/common/call_notes_cmd.jsp?cmd=delete&key=" + key,
										data: '',

										success: function (result) {
											$(".flexmeCallNotes").flexReload();
										}
									});	

								}
							}
						});	
					}
				}
                else if (com == 'View' || com == 'Edit' ) {
					if ( $('.flexmeCallNotes .trSelected', grid).length > 0 )
					{
						var key = $('.flexmeCallNotes .trSelected td:eq(0)').text();
						//window.open("notes_cmd.jsp?cmd=onEdit&key=" + key, "Edit" );
//						$( "#callNotesDialog" ).dialog();

					window.open("/sunbase/index.jsp?nomenu=1&page=modules/crm/lead_history_edit.jsp%3Fembedded=1%26key=" + key + "%26parentUuid=f0b0668623a5493b982e2f216cdd6735%26typeCode=call_hist", "EditC" ).focus();
					}
                } 
				else if (com == 'Add') {
                    //alert('Add New Item');
					
//					$( "#notesDialog" ).dialog();
//		html:'<label>Enter comment <input type="text" name="fname" value=""></label><br />'+
//			'<label>Last <input type="text" name="lname" value=""></label><br />',
//<input id="follow_date" name="follow_date" type="text" value="" readonly="true" size="25">' +
//			'<a href="javascript:NewCal(\'follow_date\',\'MMDDYYYY\',true,24)"><img src="/sunbase/img/calendar.png" width="25" height="25" border="0" alt="Pick a date"></a>'+
//			'</input><img width="15" height="15" title="Clear" src="/sunbase/img/redx.jpg" onclick="document.getElementById(\'follow_date\').value=\'\'"/>'+
			
			

window.open("/sunbase/index.jsp?nomenu=1&page=modules/crm/lead_history_edit.jsp%3Fembedded=1%26parentUuid=f0b0668623a5493b982e2f216cdd6735%26typeCode=call_hist", "EditC" ).focus();

/*

var statesdemo = {
	state0: {
		title: '<b>Comment Details</b>',
		
		html: '<label for="call_status">Call Status</label><select name="call_status" id="call_status"><option value=""> </option><option value="Call Attempt 1 - NA">Call Attempt 1 - NA</option><option value="Call Attempt 2 - NA">Call Attempt 2 - NA</option><option value="Call Attempt 3 - NA">Call Attempt 3 - NA</option><option value="Bad #">Bad #</option><option value="No Number">No Number</option><option value="Email">Email</option><option value="Text">Text</option><option value="Follow Up">Follow Up</option><option value="Stop By">Stop By</option></select><br/>' +
			'<label for="follow_date">Follow up Date/Time</label>' + 		
			'<input type="text" onblur="isDate(\'follow_date\')" name="follow_date" id="follow_date" value="" placeholder="MM/DD/YYYY" size="10" />' + 
			'<img width="25" height="25" title="Pick the date" src="/sunbase/img/calendar.png" onclick="displayDatePicker(\'follow_date\')"/>' + 
			'<img width="15" height="15" title="Clear" src=\'/sunbase/img/redx.jpg\' onclick="document.getElementById(\'follow_date\').value=\'\'"/>' + 
			'<input name="follow_dateTime" placeholder="HH:MM" SIZE="5" MAXLENGTH="5" id="follow_dateTime" onblur="validateHhMm(\'follow_dateTime\')"  value="" >' +
			'<select name="follow_dateMode" id="follow_dateMode">' + 
				'<option value="AM" selected="selected" >AM</option>' + 
				'<option value="PM">PM</option>' + 
			'</select>' +			
			'<br />'+
			'<label>Enter comment <textarea id="body" name="body" maxlength="500" rows="8" style="width:800px;height:300px"></textarea></label><br />'+
			'<input type="hidden" name="parentUuid" value="f0b0668623a5493b982e2f216cdd6735" /><input type="hidden" name="typeCode" value="call_hist" /><input type="hidden" name="cmd" value="insert" /><br />',
		buttons: { Save: 0 },
		//focus: "input[name='fname']",
		submit:function(e,v,m,f){ 
			//console.log(f);
			
//					dataType: p.dataType,			
				$.ajax({
					type: "GET",
					url: "/sunbase/modules/common/call_notes_cmd.jsp",
					data: f,

					success: function (data) {
	//					alert('success')
						$(".flexmeCallNotes").flexReload();
					},
					error: function (XMLHttpRequest, textStatus, errorThrown) {
//						alert( textStatus );
					
						try {
							if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
						} catch (e) {}
					}
				});


			e.preventDefault();
			$.prompt.close();
		}
	}
};

$.prompt(statesdemo);
*/

//					window.location = "notes_cmd.jsp?cmd=onAdd";
                }
            }


			$(".flexmeCallNotes").dblclick(
				function (e)
				{
					var key = $('.flexmeCallNotes .trSelected td:eq(0)').text();
					window.open("/sunbase/index.jsp?nomenu=1&page=modules/crm/lead_history_edit.jsp%3Fembedded=1%26key=" + key + "%26parentUuid=f0b0668623a5493b982e2f216cdd6735%26typeCode=call_hist", "EditC" ).focus();






/*
					var url = "/sunbase/modules/common/call_notes_cmd.jsp?cmd=read&uuid=" + key;
					
					$.ajax({
						type: "POST",
						url: url,
						data: '',

						success: function (note) {

							var pieces = note.split("|");
							
							
							var time = pieces[0].split(",");
							
		//					var note = "NOTES";
		var statesdemo = {
			state0: {
			
				title: '<b>Comment Details</b>',
				html: '<label for="call_status">Call Status</label><input type="text" name="call_status" readonly="true" id="call_status" value="' +  pieces[2] + '"/><br/>' +
					'<label for="follow_date">Follow up Date/Time</label>' + 		
					'<input type="text" onblur="isDate(\'follow_date\')" name="follow_date" id="follow_date" value="' +  time[0] + '" placeholder="MM/DD/YYYY" size="10" />' + 
					'<img width="25" height="25" title="Pick the date" src="/sunbase/img/calendar.png" onclick="displayDatePicker(\'follow_date\')"/>' + 
					'<img width="15" height="15" title="Clear" src=\'/sunbase/img/redx.jpg\' onclick="document.getElementById(\'follow_date\').value=\'\'"/>' + 
					'<input name="follow_dateTime" placeholder="HH:MM" SIZE="5" MAXLENGTH="5" id="follow_dateTime" onblur="validateHhMm(\'follow_dateTime\')"  value="' +  time[1] + '" >' +
					'<select name="follow_dateMode" id="follow_dateMode">' + 
						'<option value="AM" ' + ( time[2] == 'AM' ? 'selected="selected"' : "" ) + '>AM</option>' + 
						'<option value="PM" ' + ( time[2] == 'PM' ? 'selected="selected"' : "" ) + '>PM</option>' + 
					'</select>' +			
					'<br />'+
					'<label>Enter comment <textarea id="body" name="body" maxlength="500" rows="8" style="width:800px;height:300px">' + pieces[3] + '</textarea></label><br />'+
					'<input type="hidden" name="uuid" value="' + pieces[1] + '"/><input type="hidden" name="parentUuid" value="f0b0668623a5493b982e2f216cdd6735" /><input type="hidden" name="typeCode" value="call_hist" /><input type="hidden" name="cmd" value="update" /><br />',
				buttons: { Save: 0 },
				submit:function(e,v,m,f){ 
		//			console.log( "LOG " +  f.comment_details + " " + f.parent_uuid );


						$.ajax({
							type: "GET",
							url: "/sunbase/modules/common/call_notes_cmd.jsp",
							data: f,

							success: function (data) {
			//					alert('success')
								$(".flexmeCallNotes").flexReload();
							},
							error: function (XMLHttpRequest, textStatus, errorThrown) {
		//						alert( textStatus );
							
								try {
									if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
								} catch (e) {}
							}
						});

					e.preventDefault();
					$.prompt.close();
					
		//			$('#flexmeNotes').flexReload()
				}
			}
		};

		//statesdemo.call_status.value= pieces[2];

		$.prompt(statesdemo);
							
							}
					});	
*/
					
					
//					$( "#notesDialog" ).dialog();
					//window.location = "notes_cmd.jsp?cmd=onEdit&key=" + key;
				}
			) 
			

        </script>

</div>
<div id="tabs-2" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-5" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">
<fieldset class="detailFS"><table class="detailForm"><tbody><tr><td><label for="email_status">Email Status</label><input type="checkbox" name="email_status" id="email_status" checked=""></td><td><label for="email_coupons">Email Coupons</label><input type="checkbox" name="email_coupons" id="email_coupons" checked=""></td></tr><tr><td><label for="email_newsletter">Email Newsletter</label><input type="checkbox" name="email_newsletter" id="email_newsletter" checked=""></td><td><label for="sms_status">SMS Status</label><input type="checkbox" name="sms_status" id="sms_status" checked=""></td></tr><tr><td><label for="email_ads">Email Ads</label><input type="checkbox" name="email_ads" id="email_ads" checked=""></td><td><label for="email_off">Do not Email</label><input type="checkbox" name="email_off" id="email_off"></td></tr><tr><td><label for="phoneDnc">Do Not Call</label><input type="checkbox" name="phoneDnc" id="phoneDnc"></td></tr>
</tbody></table></fieldset></div>
<div id="tabs-5" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-6" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">

	<style>
div.jqi
{
	position : 0px, 50px;
	width: 80%;
}

</style>



<script>


var notes = false;
function handle_note_click()
{
	if ( notes == false )
	{
		notes = true;
		setupNotes();
	}
}

function initPrompt()
{
	if ( userList === null )
	{
		$.ajax({
			type: "GET",
			url: "/sunbase/modules/common/notes_cmd.jsp?cmd=user_list",
			dataType:'json',
			success: function (data) {
				userList = data;
				
				$('.mentions').suggest('@', {
				  data: userList,
				  map: function(user) {
					return {
					  value: user.username,
					  text: '<strong>'+user.username+'</strong> <small>'+user.fullname+'</small>'
					}
				  }
				})
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {
				try {
					if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
				} catch (e) {}
			}
		});
	}
	else
	{
		$('.mentions').suggest('@', {
		  data: userList,
		  map: function(user) {
			return {
			  value: user.username,
			  text: '<strong>'+user.username+'</strong> <small>'+user.fullname+'</small>'
			}
		  }
		})
	}
}

function sendNote(uuid)
{
	
	$.ajax({
		type: "POST",
		url: "/sunbase/modules/common/notes_cmd.jsp?cmd=sendNoteHtml",
		success: function (data) {
			
//						String parentUuid  = request.getParameter("parentUuid");
//String parentUuid2 = request.getParameter("parentUuid2");
//String typeCode = request.getParameter("type");

	
			var statesdemo = {
				state0: {
					title: '<b>Send Comment</b>',
					html: '<input type="hidden" name="uuid" value="'+ uuid + '"/>' + data +
						'<input type="hidden" name="parent_uuid" value="f0b0668623a5493b982e2f216cdd6735" />' +
						'<input type="hidden" name="parent_uuid2" value="null" />' + 
						'<input type="hidden" name="typeCode" value="C" />' + 
						'<input type="hidden" name="mentions" value="mentions" />' + 
						'<input type="hidden" name="cmd" value="sendNote" /><br />',
						
					buttons: { 'Send': 1, 'Close': 0 },
					position: { y:-200 },
					submit:function(e,v,m,f){ 
						if ( v === 1 )
						{
							$.ajax({
								type: "POST",
								url: "/sunbase/modules/common/notes_cmd.jsp",
								data: f,

								success: function (data) {
				//					alert('success')
								},
								error: function (XMLHttpRequest, textStatus, errorThrown) {
									try {
										if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
									} catch (e) {}
								}
							});
						}

						e.preventDefault();
						$.prompt.close();
					}
				}
			};

			$.prompt(statesdemo, {prefix:'jqi'} );
			window.scrollTo(0, 0);
			
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			try {
				if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
			} catch (e) {}
		}
	});
	
	
}

</script>

	
		<table class="flexmeNotes"></table>
        <script type="text/javascript">
		
function setupNotes() {
		
            $(".flexmeNotes").flexigrid({
                url : '/sunbase/modules/common/notes_cmd.jsp?cmd=list&parent_uuid=f0b0668623a5493b982e2f216cdd6735&parent_uuid2=null&parenttype=C&typeCode=null',
                dataType : 'xml',
				nowrap:false,
				
                colModel : [ 
					{ display : 'key', name : 'key', width : 40, hide:true,sortable : true, align : 'center' }, 
					{ display : 'Note', name : 'note', width : 800, sortable : false, align : 'left'}, 
					{ display : 'User Id', name : 'createUserId', width : 150, sortable : true, align : 'left'},
					{ display : 'Date', name : 'createDate',  width : 100, sortable : true, align : 'left'},
					{ display : 'Action', name : 'action', width : 50, sortable : false, align : 'left'}					
                ],
                buttons : [ 
					{  label: 'Add', name : 'Add', bclass : 'add', onpress : testNotes},                     
                    {  label: 'Edit', name : 'View',   bclass : 'edit',   onpress : testNotes },
					{  label: 'Delete', name : 'Delete', bclass : 'delete', onpress : testNotes }, 
					{separator : true} 
				],
				sortname : "note",
                sortorder : "asc",
                usepager : true,
				title : 'Notes',
                useRp : false	,
                rp : 15,
				blockOpacity: .5,
                showTableToggleBtn : false,
				showToggleBtn : false,
                width : '100%',
                height : 200,
				singleSelect: true
            });      
			
}
		
			
            function testNotes(com, g, p, grid) 
			{
                if (com == 'Delete') {				
					if ( $('.flexmeNotes .trSelected', grid).length > 0 )
					{
						$.prompt("Are you sure you want to delete this record?", {
							title: "Confirm",
							buttons: { "Yes": true, "No": false },
							submit: function(e,v,m,f){
								// use e.preventDefault() to prevent closing when needed or return false. 
								// e.preventDefault(); 

								console.log("Value clicked was: "+ v);
								if ( v == true )
								{
									var key = $('.flexmeNotes .trSelected td:eq(0)').text();
									$.ajax({
										url: "/sunbase/modules/common/notes_cmd.jsp?cmd=delete&key=" + key,
										success: function(result) {
											$(".flexmeNotes").flexReload();
										}
									}); 
								}
							}
						});	
					}
				}
                else if (com == 'View' || com == 'Edit' ) {
					if ( $('.flexmeNotes .trSelected', grid).length > 0 )
					{
						var key = $('.flexmeNotes .trSelected td:eq(0)').text();
						var url = "/sunbase/modules/common/notes_cmd.jsp?cmd=read&uuid=" + key;
						
						$.ajax({
							type: "POST",
							url: url,
							data: '',

							success: function (note) {
							var statesdemo = {
								state0: {
									title: '<b>Comment Details</b>',
									html:'<label>Enter comment</label> <textarea class="mentions" id="comment_details" name="comment_details" style="height:300px;width:100%;max-height:50%">' + note + '</textarea></label><input type="hidden" name="uuid" value="' + key + '" /><input type="hidden" name="cmd" value="update" /><input type="hidden" name="mentions" value="mentions" /><br />',
									focus: "textarea[name='comment_details']",
									buttons: { 'Save': 1, 'Close': 0 },
									submit:function(e,v,m,f){ 
										console.log(f);
										
										if ( v == 1 )
										{
											var m = getMentions( f['comment_details'] );
											console.log(m);
											var mentions = '';
											if ( m ) {
												for ( var i = 0; i < m.length; ++i )
												{
													for ( var j = 0; j < userList.length; ++j )
													{
														if ( m[i].trim() == ('@' + userList[j].username).trim() )
														{
															if ( i > 0 )
																mentions += ';';
															mentions += userList[j].uuid;
															break;
														}
													}
												}
											}
											f.mentions = mentions;
							

											$.ajax({
												type: "POST",
												url: "/sunbase/modules/common/notes_cmd.jsp",
												data: f,

												success: function (data) {
													$(".flexmeNotes").flexReload();
												},
												error: function (XMLHttpRequest, textStatus, errorThrown) {
													try {
														if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
													} catch (e) {}
												}
											});
										}

										e.preventDefault();
										$.prompt.close();
									}
								}
							};

							var myPrompt = $.prompt(statesdemo, {prefix:'jqi'} );
							myPrompt.on('impromptu:loaded', function(e){ initPrompt() });
							window.scrollTo(0, 0);
						}
					});	
							
					}
                } 
				else if (com == 'Add') {
					
var statesdemo = {
	state0: {
		title: '<b>Comment Details</b>',
		html:'<label>Enter comment </label><textarea class="mentions" id="body" name="body" rows="12" style="height:300px;width:100%;max-height:70%"></textarea></label><br />'+
			'<input type="hidden" id="typeCode" name="typeCode" value="C" /><input type="hidden" name="mentions" value="mentions" />' + 
			'<input type="hidden" name="parentUuid" value="f0b0668623a5493b982e2f216cdd6735" /><input type="hidden" name="cmd" value="insert" /><br />',
		buttons: { Save: 1, Cancel: 0 },
		position: { y:0 },
		focus: "textarea[name='body']",
		submit:function(e,v,m,f){ 
			//console.log(f);

				if ( v == 1 )
				{					
					var m = getMentions( f.body );
					var mentions = '';
					if ( m ) {
						for ( var i = 0; i < m.length; ++i )
						{
							for ( var j = 0; j < userList.length; ++j )
							{
								
								if ( m[i].trim() == ('@' + userList[j].username).trim() )
								{
									if ( i > 0 )
										mentions += ';';
									mentions += userList[j].uuid;
									break;
								}
							}
						}
					}
console.log(mentions );					
					f.mentions = mentions;

					
	//					dataType: p.dataType,			
					$.ajax({
						type: "POST",
						url: "/sunbase/modules/common/notes_cmd.jsp",
						data: f,

						success: function (data) {
		//					alert('success')
							$(".flexmeNotes").flexReload();
						},
						error: function (XMLHttpRequest, textStatus, errorThrown) {
	//						alert( textStatus );
						
							try {
								if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
							} catch (e) {}
						}
					});
				}

			e.preventDefault();
			$.prompt.close();
		}
	}
};

var myPrompt = $.prompt(statesdemo, {prefix:'jqi'} );
myPrompt.on('impromptu:loaded', function(e){ initPrompt() });
window.scrollTo(0, 0);
//					window.location = "notes_cmd.jsp?cmd=onAdd";
                }
            }


			$(".flexmeNotes").dblclick(
				function (e)
				{

										var key = $('.flexmeNotes .trSelected td:eq(0)').text();
						var url = "/sunbase/modules/common/notes_cmd.jsp?cmd=read&uuid=" + key;
						
						$.ajax({
							type: "POST",
							url: url,
							data: '',

							success: function (note) {
							var statesdemo = {
								state0: {
									title: '<b>Comment Details</b>',
									html:'<label>Enter comment</label> <textarea class="mentions" id="comment_details" name="comment_details" style="height:300px;width:100%;max-height:50%">' + note + '</textarea></label><input type="hidden" name="uuid" value="' + key + '" /><input type="hidden" name="cmd" value="update" /><input type="hidden" name="mentions" value="mentions" /><br />',
									focus: "textarea[name='comment_details']",
									buttons: { 'Save': 1, 'Close': 0 },
									submit:function(e,v,m,f){ 
										console.log(f);
										
										if ( v == 1 )
										{
											f['comment_details'] = f['comment_details'].trim();
											
											var m = getMentions( f['comment_details'] );
											console.log(m);
											var mentions = '';
											if ( m ) {
												for ( var i = 0; i < m.length; ++i )
												{
													for ( var j = 0; j < userList.length; ++j )
													{
														if ( m[i].trim() == ('@' + userList[j].username).trim() )
														{
															if ( i > 0 )
																mentions += ';';
															mentions += userList[j].uuid;
															break;
														}
													}
												}
											}
											f.mentions = mentions;
							
											$.ajax({
												type: "POST",
												url: "/sunbase/modules/common/notes_cmd.jsp",
												data: f,

												success: function (data) {
													$(".flexmeNotes").flexReload();
												},
												error: function (XMLHttpRequest, textStatus, errorThrown) {
													try {
														if (p.onError) p.onError(XMLHttpRequest, textStatus, errorThrown);
													} catch (e) {}
												}
											});
										}

										e.preventDefault();
										$.prompt.close();
									}
								}
							};

							var myPrompt = $.prompt(statesdemo, {prefix:'jqi'} );
							myPrompt.on('impromptu:loaded', function(e){ initPrompt() });
							window.scrollTo(0, 0);
						}
					});	
				});
			

        </script>

</div>
<div id="tabs-6" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-7" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">
<style>
#previewImg {
  transform-origin: top left;
  /* IE 10+, Firefox, etc. */
  -webkit-transform-origin: top left;
  /* Chrome */
  -ms-transform-origin: top left;
  /* IE 9 */
}
.rotate90 {
  transform: rotate(90deg) translateY(-100%);
  -webkit-transform: rotate(90deg) translateY(-100%);
  -ms-transform: rotate(90deg) translateY(-100%);
}
.rotate180 {
  transform: rotate(180deg) translate(-100%, -100%);
  -webkit-transform: rotate(180deg) translate(-100%, -100%);
  -ms-transform: rotate(180deg) translateX(-100%, -100%);
}
.rotate270 {
  transform: rotate(270deg) translateX(-100%);
  -webkit-transform: rotate(270deg) translateX(-100%);
  -ms-transform: rotate(270deg) translateX(-100%);
}
</style>

<label for="_attach_file_code">Type </label><select onchange="$(&quot;.flexmeAttachment&quot;).flexReload();" id="_attach_file_code" name="_attach_file_code"><option value="">All</option></select><br>




		<table class="flexmeAttachment"></table>
        <script type="text/javascript">
		
function extendedSearch2()
{
	if ( document.getElementById('_attach_file_code') )
		return "&_attach_file_code=" + escape( document.getElementById('_attach_file_code').value);
	return "";
}	

function getSelected(grid)
{
	var group_ids = "";

	var selc = $('tr', grid);
	for ( var i = 1; i <= selc.length; ++i )
	{
		var row = selc[i];
		var id = $('td:eq(0)', row).text();
		if ( id != "" )
		{
			var selectedFlag = document.getElementById("cb_" + id );
			if ( selectedFlag != null )
			{
				if ( selectedFlag.checked )
				{
					group_ids += id + ";";
				}
			}
		}						
	}
	
	return group_ids;
}

		
var attachmentsFlag = false;
function handle_attachments_click()
{
	if ( attachmentsFlag == false )
	{
		attachmentsFlag = true;
		setupAttachment();
		
	$.ajax({
		type: "POST",
		url: "modules/common/attachment_cmd.jsp?cmd=types",
		success: function (data) {
			data = data.trim();

			var select= document.getElementById('_attach_file_code');

			var parts = data.split("|");
			for ( var v = 0; v < parts.length; ++v )
			{
				var item = parts[v].split("#");
				if ( item.length == 2 )
				{
					var opt = document.createElement('option');
					opt.value = item[0];
					opt.innerHTML = item[1];
					select.appendChild(opt);
				}
			}
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
		
	}
}

function emailFile(uuid)
{
	var statesdemo = {
		state0: {
			html:'<label>Email File to</label><input type="email" name="emailAddr"/><br/><label>Message:</label><textarea name="msgb" style="height:200px"></textarea>',
			title: "Email Attachment",
			buttons: { "Send": true, "Cancel": false },
			focus: "input[name='emailAddr']",
			submit:function(e,v,m,f){ 
				//console.log(f);
				var email = f.emailAddr;
				if ( email && email.indexOf("@") > 0 )
				{
					console.log("Email " + email );
					$.ajax({
						type: "POST",
						url: "modules/common/attachment_cmd.jsp?cmd=email&key=" + uuid + "&email=" + escape(email) + "&body=" + escape(f.msgb),
						success: function (data) {
							if( data.indexOf("uccess") > 0 )
								xdInfo("Sent file");
							else
								xdError("Failed to send file");
						},
						error: function (XMLHttpRequest, textStatus, errorThrown) {
							console.log( textStatus );
						}
					});
				}
				return true;
			}// end of submit
		  }
		}
	
	if ( statesdemo != null )
		$.prompt(statesdemo);
}


function onChangeFileType()
{
	var total = 0;
	var v = $('.fileCB');
	for ( var i = 0; i < v.length; ++i )
	{
		if ( v[i] && v[i].checked )
		{
			console.log( v[i].getAttribute('data-size') );
			total += parseFloat( v[i].getAttribute('data-size') );
		}
	}
	var x = document.getElementById('totalSize');
	if ( x )
	{
		
		x.innerHTML = ( total / 1024 ).toFixed(2);
	}
//	xdInfo("Total Size " + total );
}

function findCustomerCode()
{
var customerCode = '';
	
	return customerCode;
}

function loadThumb(img, uuid)
{
	var v = document.getElementById('syncSchema');
	var hint = '';
	if ( v && v.value && v.value.length > 1 ) {
		hint = '&syncSchema=' + escape(v.value);
	}
	img.src = 'modules/common/attachment_dl_view.jsp?thumb=1&uuid=' + uuid + hint;
	img.onmouseover = null;
	img.onclick = null;
}

function browseFolder()
{
	var folder = findCustomerCode();
	$.ajax({
		type: "GET",
		url: "modules/common/attachmentExt_cmd.jsp?cmd=url&path=" + folder,
		data: '',
		success: function (data) {
			data = data.trim();
			if ( data.indexOf("https:") != -1 )
				window.open( data ).focus();
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function downloadAttach(url, file)
{
	nativePreview(url);

}	

function activatePortal(key)
{
	$.ajax({
		type: "POST",
		url: "modules/common/formlist_cmd.jsp",
		data: 'cmd=portal&key=' + key,
		success: function (data) {
			data = data.trim();
			var title = "Do you want to " + ( data === '1' ? 'disable' : 'enable' ) + " attachment access in the client portal? ";

			$.prompt(title, {
			title: "Confirm",
			buttons: { "Yes": true, "No": false },
			submit: function(e,v,m,f){
				if ( v == true )
				{
					$.ajax({
						url: "modules/common/formlist_cmd.jsp",
						data: 'cmd=change_portal&flag=' + ( data === '1' ? 0 : 1 ) + '&key=' + key + "&cust_uuid=f0b0668623a5493b982e2f216cdd6735",
						success: function(result) {
							if ( result.indexOf("Error") != -1 )
							{
								xdError( result );
							}
							else
								$(".flexmeFormTypes").flexReload();
						}
					});
				}
			}
			});				
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			console.log( textStatus );
		}
	});
}

function closePreview()
{
		 var $dialogContent = $("#dlPreviewPanel");		
		   $dialogContent.dialog("destroy");
		   $dialogContent.hide();

}
function replaceAll(val, old, replace) {
  
  var idx = val.indexOf(old);
  while ( idx != -1 )
  {
	  val = val.replace(old, replace);
	  idx = val.indexOf(old);
  }
  return val;
}

function nativePreview(url)
{
  var userAgent = navigator.userAgent || navigator.vendor || window.opera;
  if (/android/i.test(userAgent)) {
      return;
  }
  

  // only ios  
  var urlx = window.location.href.substring( 0, window.location.href.indexOf("/sunbase/") );
  urlx = replaceAll(urlx, "https://", "https%3A%2F%2F");
  urlx += "%2Fsunbase%2F" + escape(url);
  urlx = replaceAll(urlx, "/", "%2F");

  window.open('npopup.html?title=PDF_Download&download=file.pdf&url=' + urlx );
}


function pdfPreview(url)
{	
	window.open(url, 'AEdit').focus();
}


var angle = 0;
function rotatePreview() {
	var img = document.getElementById('previewImg');
	if ( img ) {
		angle = (angle + 90) % 360;
		img.className = "rotate" + angle;
	}
}
function imgPreview(url, filename)
{
	//String url = "modules/common/img_viewer.jsp?source=" + java.net.URLEncoder.encode("modules/common/attachment_dl_cmd.jsp?" + data);
	console.log( "modules/common/attachment_dl_cmd.jsp?" + url );
	document.getElementById('dlPreviewPanel').innerHTML = "<button onclick='rotatePreview(); return false;'>Rotate</button><button onclick='closePreview(); return false;'>Close</button><br/><img width='100%' id='previewImg' src='modules/common/attachment_dl_cmd.jsp?" + url + "'/>";
	  
	img = document.getElementById('container');
	angle = 0;
	 var $dialogContent = $("#dlPreviewPanel");		
	 $dialogContent.dialog({
		modal: true,
		title: 'Preview ' + filename,
		position: 'top',
		width: 1100,
		height: 700,
		close: function() {
		   $dialogContent.dialog("destroy");
		   $dialogContent.hide();
		},
	 }).show();

	 document.getElementById("dlPreviewPanel").style.display = 'contents';
	 $(window).resize().resize();	
}
		
function setupAttachment() {
		

            $(".flexmeAttachment").flexigrid({
                url : '/sunbase/modules/common/attachment_cmd.jsp?cmd=list&parent_uuid2=null&parent_uuid=f0b0668623a5493b982e2f216cdd6735&fileCode=' + findCustomerCode(),
                dataType : 'xml',

                colModel : [ 
					{ display : 'Key', name : 'key', width : 40, hide:true,sortable : true, align : 'center' }, 
					
						
					{ display : 'Selected', name : 'Selected', width : 100, hide:false,sortable : false, align : 'left' }, 
					{ display : 'File Type', name : 'fileType', width : 200, sortable : true, align : 'left'}, 
					{ display : 'Filename', name : 'name', width : 300, sortable : false, align : 'left'}, 
					{ display : 'Label', name : 'label', width : 300, sortable : false, align : 'left'}, 
					{ display : 'Thumbnail', name : 'thumb', width : 120, sortable : false, align : 'left'}, 
					{ display : 'File Size KB', name : 'fileSize', width : 200, sortable : true, align : 'left'}, 
					{ display : 'User Id', name : 'createUserId', width : 150, sortable : false, align : 'left'},
					{ display : 'Date', name : 'createDate', width : 100, sortable : false, align : 'left'},
					{ display : 'Actions', name : 'action', width : 100, sortable : false, align : 'left'}
				
                ],
                buttons : [ 
					{  label:'Add', name : 'Add', bclass : 'add', onpress : testAttachment},   
                  
					{ label:'Edit', name : 'Edit', bclass : 'edit',   onpress : testAttachment },

					{  label:'Delete', name : 'Delete', bclass : 'delete', onpress : testAttachment },
					{ label:'Multi', name : 'Multi',  bclass : 'add',   onpress : testAttachment },									
					{ label:'Survey Report', name : 'Report',  bclass : 'pdf', onpress : testAttachment },					
					{ label:'Installation Report', name : 'Report Install',  bclass : 'pdf', onpress : testAttachment },					
					
					
					{ label:'Selected Report', name : 'Report Selected',  bclass : 'pdf', onpress : testAttachment },					
					{ label:'Email Files', name : 'Email Files',  bclass : 'email', onpress : testAttachment },					
					
					{ label:'Multi Delete', name : 'DeleteMulti',  bclass : 'delete', onpress : testAttachment },					
					
					{separator : true} 
				],
				sortname : "createDate",
                sortorder : "desc",
                usepager : true,
				title : 'Attachment',
                useRp : true	,
                rp : 15,
                showTableToggleBtn : false,
				showToggleBtn : false,
                width : '100%',
                height : 500,
				singleSelect: true
            });      
			
}
		
		
            function testAttachment(com, g, p,grid) 
			{
				
                if (com == 'DeleteMulti') {
					var selected = getSelected(grid);
					if ( selected.length > 0 )
					{
						$.prompt("Are you sure you want to delete all selected attachment records?", {
							title: "Confirm",
							buttons: { "Yes": true, "No": false },
							submit: function(e,v,m,f){
								// use e.preventDefault() to prevent closing when needed or return false. 
								// e.preventDefault(); 

								if ( v == true )
								{
									$.ajax({
										url: "/sunbase/modules/common/attachment_cmd.jsp?cmd=multi_delete&key=" + selected,
										success: function(result) {
											$(".flexmeAttachment").flexReload();
										}
									}); 																		
								}
							}
						});	
					}
					else
					{
						xdError("Please select a image file");
					}
				}
                else if (com == 'Report Selected') {
					var selected = getSelected(grid);
					if ( selected.length > 0 && selected.indexOf(";") != -1 )
					{
						var url = "modules/common/attachment_report.jsp?cmd=generate&key=f0b0668623a5493b982e2f216cdd6735&val=" + escape(selected);
						window.open( url, 'Report' ).focus();
					}
					else
						xdError("Please select a image file");
				}
                else if (com == 'Delete') {
					if ( $('.flexmeAttachment .trSelected', grid).length > 0 )
					{
						$.prompt("Are you sure you want to delete this record?", {
							title: "Confirm",
							buttons: { "Yes": true, "No": false },
							submit: function(e,v,m,f){
								// use e.preventDefault() to prevent closing when needed or return false. 
								// e.preventDefault(); 

								console.log("Attachment Value clicked was: "+ v);
								if ( v == true )
								{
									var key = $('.flexmeAttachment .trSelected td:eq(0)').text();
									$.ajax({
										url: "/sunbase/modules/common/attachment_cmd.jsp?cmd=delete&key=" + key + findCustomerCode(),
										success: function(result) {
											$(".flexmeAttachment").flexReload();
										}
									}); 																		
								}
							}
						});	
					}
				}
				else if ( com === 'Report' )
				{
						$.ajax({
							type: "POST",
							url: "modules/common/attachment_report.jsp?cmd=html&screen=Survey&key=f0b0668623a5493b982e2f216cdd6735",
							data: '',
							success: function (html) {							
								var statesdemo = {
									state0: {
										html:html,
										title: "Select File Types",
										buttons: { "Generate PDF": true, "Generate Zip": 2, "Cancel": false },
										//focus: "input[name='fname']",
										submit:function(e,v,m,f){ 
											//console.log(f);
											if ( v == 2 )
											{
												var size = 0;
												try { size = parseFloat( document.getElementById('totalSize') ); } catch(xt){}
												if ( size == 0 || size > 5000 )
												{
													xdWarn("Currently we have a 5 MB limit");
													e.preventDefault();
													return false;
												}
												else
												{
													var v = $('.fileCB');
													var values = "";
													for ( var i = 0; i < v.length; ++i )
													{
														if ( v[i] && v[i].checked )
														{
															values += v[i].getAttribute('value') + "|";
														}
													}
													var url = "modules/common/attachment_report.jsp?cmd=generate_zip&key=f0b0668623a5493b982e2f216cdd6735&fileCode=" + escape(values);
													
													if ( values === '' )
													{
														xdWarn("Must select at least once type");
														e.preventDefault();
														return false;
													}
													else
													{
														window.open( url, 'Report' ).focus();
													}
												}
											}
											else if ( v == true )			
											{
												var size = 0;
												try { size = parseFloat( document.getElementById('totalSize') ); } catch(xt){}
												if ( size == 0 || size > 5000 )
												{
													xdWarn("Currently we have a 5 MB limit");
													e.preventDefault();
													return false;
												}
												else
												{
													var v = $('.fileCB');
													var values = "";
													for ( var i = 0; i < v.length; ++i )
													{
														if ( v[i] && v[i].checked )
														{
															values += v[i].getAttribute('value') + "|";
														}
													}
													var url = "modules/common/attachment_report.jsp?cmd=generate&key=f0b0668623a5493b982e2f216cdd6735&fileCode=" + escape(values);
													
													if ( values === '' )
													{
														xdWarn("Must select at least once type");
														e.preventDefault();
														return false;
													}
													else
													{
														window.open( url, 'Report' ).focus();
													}
												}
											}
										}// end of submit
									  }
									}
								
								if ( statesdemo != null )
									$.prompt(statesdemo);
							}
						});	
					
					// fetch fields
					// show box
					// generate
				}
				else if ( com === 'Report Selected' )
				{
					var v = $('.fileCB');
					var values = "";
					for ( var i = 0; i < v.length; ++i )
					{
						if ( v[i] && v[i].checked )
						{
							values += v[i].getAttribute('value') + "|";
						}
					}
					var url = "modules/common/attachment_report.jsp?cmd=generate&key=f0b0668623a5493b982e2f216cdd6735&fileCode=" + escape(values);

					if ( values === '' )
					{
						xdWarn("Must select at least once type");
						e.preventDefault();
						return false;
					}
					else
					{
						window.open( url, 'Report' ).focus();
					}
				}
				else if ( com === 'Report Install' )
				{
						$.ajax({
							type: "POST",
							url: "modules/common/attachment_report.jsp?cmd=html&screen=Installation&key=f0b0668623a5493b982e2f216cdd6735",
							data: '',

							success: function (html) {							
								var statesdemo = {
									state0: {
										html:html,
										title: "Select File Types",
										buttons: { "Generate PDF": true, "Generate Zip": 2, "Cancel": false },
										//focus: "input[name='fname']",
										submit:function(e,v,m,f){ 
											//console.log(f);
											if ( v == 2 )
											{
												var size = 0;
												try { size = parseFloat( document.getElementById('totalSize') ); } catch(xt){}
												if ( size == 0 || size > 5000 )
												{
													xdWarn("Currently we have a 5 MB limit");
													e.preventDefault();
													return false;
												}
												else
												{
													var v = $('.fileCB');
													var values = "";
													for ( var i = 0; i < v.length; ++i )
													{
														if ( v[i] && v[i].checked )
														{
															values += v[i].getAttribute('value') + "|";
														}
													}
													var url = "modules/common/attachment_report.jsp?cmd=generate_zip&key=f0b0668623a5493b982e2f216cdd6735&fileCode=" + escape(values);
													
													if ( values === '' )
													{
														xdWarn("Must select at least once type");
														e.preventDefault();
														return false;
													}
													else
													{
														window.open( url, 'Report' ).focus();
													}
												}
											}
											else if ( v == true )			
											{
												var size = 0;
												try { size = parseFloat( document.getElementById('totalSize') ); } catch(xt){}
												if ( size == 0 || size > 5000 )
												{
													xdWarn("Currently we have a 5 MB limit");
													e.preventDefault();
													return false;
												}
												else
												{
													var v = $('.fileCB');
													var values = "";
													for ( var i = 0; i < v.length; ++i )
													{
														if ( v[i] && v[i].checked )
														{
															values += v[i].getAttribute('value') + "|";
														}
													}
													var url = "modules/common/attachment_report.jsp?cmd=generate&key=f0b0668623a5493b982e2f216cdd6735&fileCode=" + escape(values);
													
													if ( values === '' )
													{
														xdWarn("Must select at least once type");
														e.preventDefault();
														return false;
													}
													else
													{
														window.open( url, 'Report' ).focus();
													}
												}
											}
										}// end of submit
									  }
									}
								
								if ( statesdemo != null )
									$.prompt(statesdemo);
							}
						});	
					
					// fetch fields
					// show box
					// generate
				}
                else if (com == 'View' ) {
					if ( $('.flexmeAttachment .trSelected', grid).length > 0 )
					{
						$('.flexmeAttachment .trSelected td:eq(7) .viewAction').click();
					}
                }
                else if ( com == 'Edit' ) {
					if ( $('.flexmeAttachment .trSelected', grid).length > 0 )
					{
						var key = $('.flexmeAttachment .trSelected td:eq(0)').text();
						window.open("/sunbase/index.jsp?nomenu=1&page=modules/common/attachment_edit.jsp%3Fkey=" + key + "%26parent_uuid2=null%26parent_uuid=f0b0668623a5493b982e2f216cdd6735", "AEdit" ).focus();
					}
                }
				else if (com == 'Multi' ) {
					window.open("/sunbase/index.jsp?nomenu=1&page=modules/common/attachment_multi.jsp%3FparentUuid=f0b0668623a5493b982e2f216cdd6735", "AEdit" ).focus();
                }
                else if ( com == 'Email Files' ) {
					//var key = $('.flexmeBOM .trSelected td:eq(0)').text();

					createEmailMessageAttach();
				}
				else if ( com == 'Web Camera')
				{
//console.log("Web cam");
					window.open("/sunbase/index.jsp?nomenu=1&page=modules/common/attachment_webcam.jsp%3FparentUuid=f0b0668623a5493b982e2f216cdd6735", "Edit" ).focus();
				}
				else if (com == 'Add Camera') {
					window.open("/sunbase/index.jsp?nomenu=1&page=modules/common/attachment_edit.jsp%3Fcamera=1%26parentUuid=f0b0668623a5493b982e2f216cdd6735", "Edit" ).focus();
                }
				else if (com == 'Add') {
                    //alert('Add New Item');
					
					
					window.open("/sunbase/index.jsp?nomenu=1&page=modules/common/attachment_edit.jsp%3FparentUuid=f0b0668623a5493b982e2f216cdd6735%26type=" + findCustomerCode().replace("&", "%26") + '', "AEdit" ).focus();
					//window.open("/sunbase/modules/common/attachment_cmd.jsp?cmd=onAdd&parentUuid=f0b0668623a5493b982e2f216cdd6735", "Edit" ).focus();
//					$( "#notesDialog" ).dialog();
//		html:'<label>Enter comment <input type="text" name="fname" value=""></label><br />'+
//			'<label>Last <input type="text" name="lname" value=""></label><br />',

//					window.location = "attachment_cmd.jsp?cmd=onAdd";
                }
            }


			$(".flexmeAttachment").dblclick(
				function (e)
				{
		
					var key = $('.flexmeAttachment .trSelected td:eq(0)').text();
					
					window.open("/sunbase/index.jsp?nomenu=1&page=modules/common/attachment_edit.jsp%3Fkey=" + key + "%26parent_uuid2=null%26parent_uuid=f0b0668623a5493b982e2f216cdd6735", "AEdit" ).focus();
	
                } 
			) 
			

function createEmailMessageAttach()
{
	var v = $('.flexmeAttachment * .tf');
	var values = "";
	var count = 0;
	for ( var i = 0; i < v.length; ++i )
	{
		if ( v[i] && v[i].checked )
		{
			++count;
			values += v[i].getAttribute('id').replace("cb_","") + "|";
		}
	}

	$.ajax({
		type: "POST",
		url: "modules/common/attachment_cmd.jsp?cmd=emailfiles_validate&files=" + values,
		data: '',
		success: function (html) {
			if ( html.indexOf("Error") != -1 )
			{
				xdError( html );
			}
			else
				createEmailMessageBox();
		},
		error: function (XMLHttpRequest, textStatus, errorThrown) {
			xdError( textStatus );
		}
	});
	
}


function createEmailMessageBox()
{
	var subject = 'Files'
	document.getElementById('attach_msgbody').innerHTML = '';
	 var $dialogContent = $("#attach_email");		


			
	var v = $('.flexmeAttachment * .tf');
	var values = "";
	var count = 0;
	for ( var i = 0; i < v.length; ++i )
	{
		if ( v[i] && v[i].checked )
		{
			++count;
			values += v[i].getAttribute('id').replace("cb_","") + "|";
		}
	}
	$('#attach_notes').html( count + " files attached");


	 document.getElementById('attach_todiv').innerHTML = '';
	 $('#attach_todiv').append( $("<input type='text' id='attach_toInput' name='attach_toInput' class='form-control' value='' style='width:100%'/>") );
	
	 document.getElementById('attach_subjectx').value = subject;
	 $.prompt.close();
	 
	 
	 document.getElementById('attach_msgbody').value = '';
	 document.getElementById('attach_toInput').value = '';
	 document.getElementById('attach_email_cc').value = '';

	 $dialogContent.dialog({
		modal: true,
		title: 'Email',
		position: { my: 'top', at: 'top+10' },
		width: 1100,
		height: 600,
		close: function() {
		   $dialogContent.dialog("destroy");
		   $dialogContent.hide();
		},
		open: function() {
			document.getElementById('attach_toInput').focus();
		},
		buttons: {
		   Send : function() {

			var data = '&subjectx=' + encodeURIComponent(document.getElementById('attach_subjectx').value);
			data += '&body=' + encodeURIComponent(document.getElementById('attach_msgbody').value);
			data += '&email=' + escape( document.getElementById('attach_toInput').value );
			data += '&cc=' + escape( document.getElementById('attach_email_cc').value );
			
			var v = $('.flexmeAttachment * .tf');
			var values = "";
			for ( var i = 0; i < v.length; ++i )
			{
				if ( v[i] && v[i].checked )
				{
					values += v[i].getAttribute('id').replace("cb_","") + "|";
				}
			}
			data += '&files=' + escape( values );

			var email = document.getElementById('attach_toInput').value;
			if ( email && email.indexOf("@") > 0 )
			{
				$dialogContent.dialog("close");	
				$.ajax({
					type: "POST",
					url: "modules/common/attachment_cmd.jsp?cmd=emailfiles&parentId=f0b0668623a5493b982e2f216cdd6735" + data,
					data: '',
					success: function (html) {
						if ( html.indexOf("Error") == -1 )
						{
							xdInfo("Email sent");
							
							for ( var i = 0; i < v.length; ++i )
							{
								if ( v[i] && v[i].checked )
								{
									v[i].checked = false;
								}
							}
						}
						else
							xdError( html.trim() );
					},
					error: function (XMLHttpRequest, textStatus, errorThrown) {
						xdError( textStatus );
					}
				});
			}
		   },
		   Cancel : function() {
			  $dialogContent.dialog("close");
		   }
		}
	 }).show();
}

        </script>


<div id="dlPreviewPanel" align="center" style="display:none">

</div>




	<div id="attach_email" style="background: white; display:none; width:90%">
		
					<div style="width: 100%">
						<div style="float:left; display:inline; width:99%">
							<span class="fromMsg"><b>From:</b> </span><select id="attach_from" name="attach_from" style="width:60%; max-width:350px; margin-left:5px">
							<option value="system">System Account</option>
</select>								
							<br>
							<span class="fromMsg"><b>To  :</b> </span>
							<div id="attach_todiv" style="display:inline-block; width:60%">
								<input type="text" id="attach_toInput" name="attach_toInput" class="form-control" value="" style="width:100%">
							</div>
							<br>
							<span class="attach_email_cc"><b>CC  :</b> </span>
							<div style="display:inline-block; width:60%">
							    <input type="text" id="attach_email_cc" style="width:100%; margin-left:52px">
							</div>

							<div>
							    <span class="fromMsg"><b>Subject:</b></span><input type="text" id="attach_subjectx" style="width:60%; margin-left:5px" maxlength="50"><br>
							</div>
							<div style="width:100%; text-align:right" id="attach_notes"></div>
						</div>
					</div>
					<br>
				
				<div style="width: 100%; float:left; padding 2px 5px 5px 5px;">
					<textarea id="attach_msgbody" style="width:100%; height:390px"></textarea>
				</div>
		
	</div>
</div>
<div id="tabs-10" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-8" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">
	


  
<script>
var audit = false;
function handle_audit_click()
{
	if ( audit == false )
	{
		audit = true;
		setupAudit();
	}
}
</script>

	
		<table class="flexmeAudit"></table>
        <script type="text/javascript">
		
function setupAudit() {
		
            $(".flexmeAudit").flexigrid({
                url : '/sunbase/modules/common/audit_cmd.jsp?cmd=list&parent_uuid=f0b0668623a5493b982e2f216cdd6735&typeCode=null',
                dataType : 'xml',

                colModel : [ 
					{ display : 'key', name : 'key', width : 40, hide:true,sortable : true, align : 'center' }, 
					{ display : 'Field Name', name : 'fieldName', width : 200, sortable : true, align : 'left'}, 
					{ display : 'Changed Value', name : 'afterValue', width : 250, sortable : false, align : 'left'}, 
					{ display : 'Original Value', name : 'beforeValue', width : 250, sortable : false, align : 'left'}, 					
					{ display : 'User Id', name : 'createUserId', width : 150, sortable : true, align : 'left'},
					{ display : 'Timestamp', name : 'createTime', width : 150, sortable : true, align : 'left'}
					
                ],
				sortname : "createTime",
                sortorder : "desc",
                usepager : true,
				title : 'Changed Fields',
                useRp : false	,
                rp : 15,
				blockOpacity: .5,
                showTableToggleBtn : false,
				showToggleBtn : false,
                width : '100%',
                height : 200,
				singleSelect: true
            });      
			
}
		
			
            function testAudit(com, g, p, grid) 
			{
            }


			$(".flexmeAudit").dblclick(
				function (e)
				{
				}
			) 
			

        </script>

</div>
<div id="tabs-9" class="tab_control ui-tabs-panel ui-widget-content ui-corner-bottom" aria-labelledby="ui-id-9" role="tabpanel" aria-expanded="false" aria-hidden="true" style="display: none;">
<fieldset class="detailFS"><table class="detailForm"><tbody><tr><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="actionMailTo(&quot; &quot;);return false;"><img width="32" title="Send email" height="32" src="./edit_files/email.png">Send email</a><br><br></td></tr><tr><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="openGoogleMaps()"><img width="32" title="Google Maps" height="32" src="./edit_files/icon_google_maps.png">Google Maps</a><br><br></td><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="openZillowMaps()"><img width="32" title="Zillow" height="32" src="./edit_files/icon_zillow.png">Zillow</a><br><br></td></tr><tr><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="googleSunRoof(); return false;"><img width="32" title="Google SunRoof" height="32" src="./edit_files/google-sunroof.png">Google SunRoof</a><br><br></td><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="clientPortalAccess(&quot;f0b0668623a5493b982e2f216cdd6735&quot;); return false;"><img width="32" title="Client Portal Access" height="32" src="./edit_files/cportal.png">Client Portal Access</a><br><br></td></tr><tr><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="sendCampaignSimple();return false;"><img width="32" title="Send Campaign" height="32" src="./edit_files/email.png">Send Campaign</a><br><br></td><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="dialerSimple();return false;"><img width="32" title="Dialer" height="32" src="./edit_files/phone.png">Dialer</a><br><br></td></tr><tr><td><a href="https://localhost:8443/sunbase/index.jsp?nomenu=1&amp;page=modules/crm/lead_edit.jsp%3Fkey=f0b0668623a5493b982e2f216cdd6735%26embed=1#" onclick="window.open(&quot;modules/marketing/telecampaign_cmd.jsp?cmd=fetchRecordings&amp;phone= &quot;).focus()"><img width="32" title="Dialer Recordings" height="32" src="./edit_files/google-sunroof.png">Dialer Recordings</a><br><br></td></tr><tr><td></td><td></td></tr>
</tbody></table></fieldset></div>
<script>if ( $("a[href=#tabs-5]") != null ){$("a[href=#tabs-5]").click(function() {handle_note_click();});}if ( $("a[href=#tabs-6]") != null ){$("a[href=#tabs-6]").click(function() {handle_attachments_click();});}if ( $("a[href=#tabs-10]") != null ){$("a[href=#tabs-10]").click(function() {handle_audit_click();});}</script>

			
			
			
			</div></form><br>		
			

</div>



<div align="right" id="commandButtons2"></div>
<script>

	$(function() {
	
		if ( false == false )
		{
			$( "#tabs" ).tabs();
			
//			if ( typeof initSelectChoice === 'function' ) initSelectChoice('.prettyForm select');
		$( '#tabs' ).addClass('ui-tabs-vertical ui-helper-clearfix');
document.getElementById('tabs').style.display = 'inline-block';
$( '#tabs li' ).removeClass( 'ui-corner-top' ).addClass( 'ui-corner-left' );

		}
		
		document.getElementById("tabs").style.display = 'block';
		
	});
	
	if ( document.getElementById('longitude').value != '' ) 
	{
		document.getElementById("address1").style.background = 'LightGreen';
	}

	
	onLeadSourceChange(1);





setFollowupBlur();




	//spaNavigatePage('modules/crm/lead_edit.jsp?addr=100+AAA+dr&first=John&last=Smith&state=FL&city=Sunrise&zip=32733&phone=4074335454')
</script>
</div>
<script>
//	spaNavigatePage('/sunbase/modules/crm/lead_edit.jsp?key=f0b0668623a5493b982e2f216cdd6735&embed=1');

	
	
	function startChat()
	{
		setTimeout( recount, 200 );
		
			var start = "ws://" + window.location.hostname;
			if ( window.location.protocol == 'https:' )
					start = "wss://" + window.location.hostname + "";
			var wsUri = start + "/sunbase/chatws?schema=solar&session=A2478391158BBB1ABB8FF03E525D45EF&useruuid=71590418a3cc43b0b4fc29f5e86d6868&color=black&uuid=71590418a3cc43b0b4fc29f5e86d6868&label=" + escape("SunbaseData Admin") + "&avatar=blank.png"; 
			
			setTimeout(function(){ 
				initializeChat(wsUri, escape("SunbaseData Admin"), 'blank.png', 'solar');	
			}, 2000 );
		
		//setTimeout( recount, 200 );
	}
	
	$(document).ready(function(){

		
		
		
        $("body").keydown(function(key) 
		{
			var isShift;
			if (window.event) {
				isShift = !!window.event.shiftKey; // typecast to boolean
			} else {
				isShift = !!key.shiftKey;
			}
            if (isShift && key.which == 113) { // F2 key
                spaRefreshNavigatePage();
            }
			
        });
		

    });
	
</script>

	<div id="overlay" style="display:none">
		<div id="overlaydiv" style="border:1">
			Please wait while we process your request.<br>
			<center><div class="loader">Loading...</div></center>
		</div>
	</div>
	
	
	
	        <script type="text/javascript">
            $(document).ready(function()
            {
                
                //Mouseup textarea false
                $(".submenu").mouseup(function()
                {
                    return false
                });
                $(".quickAddI").mouseup(function()
                {
                    return false;
                });
                $(".account").mouseup(function()
                                      {
                    return false
                });
                //Textarea without editing.
                $(document).mouseup(function()
                {
					hideQuickAdd();
                    $(".submenu").hide();
                    $(".account").attr('id', '');
                });

            });

        </script>
        <style type="text/css">
			.dial_row_div {
				min-width:100px;padding-left:0; padding-right:0
			}
            div.dropdown {
                color: #555;
                margin: 0 auto;
                width: 143px;
                position: relative;
                height: 17px;
                text-align:left;
            }
			li.dropMenuSeparator {
    height: 1px;
    background-color: #e5e5e5;
}

			div.addSubmenu
			{
                position: absolute;
                z-index: 0;
                width: 135px;
                margin-left: 10px;
                border-radius: 6px;
				display:none;
            }
			div.addSubmenu.show
			{
				display:block;
				z-index: 99;
            }
            div.submenu
            {

                position: absolute;
                z-index: 99;
                width: 135px;
                display: none;
                margin-left: 10px;
                padding: 40px 0 5px;
                border-radius: 6px;

            }
            .dropdown  li a {

                color: #555555;
                display: block;
                font-family: arial;
                font-weight: bold;
                padding: 6px 15px;
                cursor: pointer;
                text-decoration:none;
            }

            .dropdown li a:hover{
                background:#155FB0;
                color: #FFFFFF;
                text-decoration: none;

            }
            .account {
                font-size: 11px;
                line-height: 16px;
                color: #555;
                position: absolute;
                z-index: 100;
                display: block;
                padding: 11px 0 40px 20px;
                height: 28px;
                width: 121px;
                margin: -11px 0 0 -10px;
                text-decoration: none;
                background: url('img/arrow.png') 80px 32px no-repeat;
                cursor:pointer;
            }
            .root
            {
                list-style: none;
                font-size: 11px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.45);
                background: #fff;
                padding: 10px 0 10px 0;
                border-radius: 5px 5px 5px 5px;
                margin: 21px 0 0 -70;
				width:225px;
            }
            .root:before {
                content: '';
                display: inline-block;
                border-left: 7px solid transparent;
                border-right: 7px solid transparent;
                border-bottom: 7px solid #ccc;
                border-bottom-color: #ffffff;
                position: absolute;
                color: #ffffff;
                top: 54px;
                left: 17px;
            }
            .menudroproot
            {
                list-style: none;
                font-size: 11px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.45);
                background: #fff;
                border-radius: 5px 5px 5px 5px;
                margin: 21px 0 0 0;
				width:150px;
            }
            .profile-circle {
                width: 40px;
                height: 39px;
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center center;
                -webkit-border-radius: 99em;
                -moz-border-radius: 99em;
                border-radius: 99em;
                border: 2px solid #eee;
                box-shadow: 0 3px 2px rgba(0, 0, 0, 0.3);
                vertical-align: middle;
            }
			.dial-flat-act-button {
			  position: relative;
			  vertical-align: top;
			  height: 36px;
			  width: 100%;
			  padding: 0;
			  border: 1px solid #000000;
			  font-size: 14px;
			  color: white;
			  text-align: center;
			  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);
			  background: #bdc3c7;
			  cursor: pointer;
			  padding-left: 0px !important;
			  padding-right: 0px !important;
			}

			.dial-flat-button {
			  position: relative;
			  vertical-align: top;
			  height: 30px;
			  width: 100%;
			  padding: 0;
			  border: 0px;
			  font-size: 14px;
			  color: white;
			  text-align: center;
			  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);
			  background: #f1c40f;
			  cursor: pointer;
			  padding-left: 0px !important;
			  padding-right: 0px !important;
			}
			
.primary-btn {
	color:white !important;
    background-color: #2e6e9e !important;
    border: 0px solid #2e6e9e !important;
}

.btn-tall
{
	height:40px !important;
	font-weight:600;
}
.primary-btn:hover {
    background-color: #2e8e9e !important;
}

.btn-medium:hover {
    background: #e7e7e7;
}
.btn-medium {
    display: inline-block;
    padding: 4px 10px;
    margin-bottom: 0;
    font-size: 13px;
    line-height: 18px;
    color: #212835;
    text-align: center;
    cursor: pointer;
    background: #f5f7f8;
    border: 1px solid #cbd5db;
    -webkit-border-radius: 4px;
    -moz-border-radius: 4px;
    border-radius: 4px;
    -webkit-transition: box-shadow .05s linear;
    -moz-transition: box-shadow .05s linear;
    -ms-transition: box-shadow .05s linear;
    -o-transition: box-shadow .05s linear;
    transition: box-shadow .05s linear;
}			
			
			.notify_box {
	margin-top:3px;
    background-color: #e6f8ff;
    border: 1px solid #ccf0ff!important;
    color: #00a2e6;
    box-shadow: 0 2px 0 #ccf0ff;
    border-radius: 4px;
    padding: 8px 35px 8px 14px;
}

.notify_box h3 {
	margin-bottom:14px;
	font-weight:700;
	background-color: #e6f8ff;
	color: #00a2e6;
}

.notify_box .close {
    position: relative;
    top: -10px;
    left: 30px;
    float: right;
    font-size: 20px;
    font-weight: 700;
    line-height: 18px;
    color: #212835;
    text-shadow: 0 1px 0 #fff;
    opacity: .2;
}

        </style>
<style>
</style>
<div id="dialerTransferDiv" style="display:none">
  <div class="row" style="padding-bottom:2px">
	  <div class="col-md-4"><label>External number</label></div>
	  <div class="col-md-4"><label>Internal Transfer</label></div>
	  <div class="col-md-4"><label style="width:100px">Agent Transfer</label><a onclick="reloadAgentList(); return false;">(reload list)</a></div>
   </div>
  <div class="row">
	  <div class="col-md-4"><input type="text" maxlength="15" name="externalPhone" placeholder="Transfer call to"></div>
	  <div class="col-md-4"><select disabled="true"></select></div>
	  <div class="col-md-4"><select disabled="true"></select></div>
   </div>
	<br>
  <div class="row">
	  <div class="col-md-4"><button class="dial-flat-button" style="border-bottom: 2px solid #2a8bcc; -webkit-box-shadow:#2a8bcc; box-shadow: #2a8bcc; background: #3498db">Blind Transfer</button></div>
	  <div class="col-md-4"><button class="dial-flat-button" style="border-bottom: 2px solid #2a8bcc; -webkit-box-shadow:#2a8bcc; box-shadow: #2a8bcc; background: #3498db">Dial with Customer</button></div>
	  <div class="col-md-4"><button class="dial-flat-button" disabled="true" style="border-bottom: 2px solid grey; -webkit-box-shadow:grey; box-shadow: grey; background: grey">Internal Transfer</button></div>
   </div>
	<br>
  <div class="row">
	  <div class="col-md-4"><button class="dial-flat-button" style="border-bottom: 2px solid #db4334; -webkit-box-shadow:#db4334; box-shadow: #db4334; background: #e74c3c">Leave 3 Way Call</button></div>
	  <div class="col-md-4"><button class="dial-flat-button" style="border-bottom: 2px solid #db4334; -webkit-box-shadow:#db4334; box-shadow: #db4334; background: #e74c3c">Hangup Xfer line</button></div>
	  <div class="col-md-4"><button class="dial-flat-button" style="border-bottom: 2px solid #db4334; -webkit-box-shadow:#db4334; box-shadow: #db4334; background: #e74c3c">Hangup Both Lines</button></div>
   </div><br>
</div>
<script>
function onDialerIncommingQue2ueSelect()
{
   var html = '<div style="overflow-y:scroll; height: 200px">';
   html += '     <input type="checkbox" class="incomQueue"/><label style="padding:5px">Queue #1</label><br/>';
   html += '</div>';
   html += '<hr/>';
   html += '<div class="row">';
/*	for ( var i = 0; i < dispositionCodes.length; ++i )
	{
		codes += '     <input type="checkbox" /><label style="padding:5px">Select All</label><br/>';
//'<option value="' + dispositionCodes[i].code + '">' + dispositionCodes[i].name + '</option>';
	}
*/
   html += '     <input type="checkbox" id="queueAll" onclick="incommingSelectAll()"/><label style="padding:5px">Select All</label><br/>';
   html += '</div>';
   html += '<br/>';

	var statesdemo = {
		state0: {
			html: html,
			title: "<b>Select Inbound Process</b>",
			buttons: { "Close": false },
			
			submit:function(e,v,m,f){ 
				//console.log(f);

				if ( v == true )			
				{
//focus: "select[name='disp_code']",
//					console.log( 'Disp code ' + f.disp_code );
					//dialerManualDial(agent_user, f.pause_code );
				}
			}// end of submit
		}
	}
	
	if ( statesdemo != null ) {
		var myPrompt = $.prompt(statesdemo);
	}
}

function incommingSelectAll()
{
	var flag = document.getElementById('queueAll').checked;
	var queues = document.getElementsByClassName('incomQueue');

	for ( var i = 0; i < queues.length; ++i )
	{
		queues[i].checked = flag;
	}
}

function emailAction(com, g, p, grid)
{
	newEmail('new', '', '', -1, "INBOX");
}


function newEmail(action, to, subject, messageNumber, folder)
{
	document.getElementById('emailTemplate').selectedIndex = 0;
	document.getElementById('msgbody').innerHTML = '';
         var $dialogContent = $("#event_new_container");		

		 if ( to.length > 2 )
		 {
			 //$dialogContent.dialog("close");
			 var toSplit = to.split(",");
			 to = '[';		 
			 for ( var i = 0; i < toSplit.length; ++i )
			 {
				to += '"' + toSplit[i] + '"';
				if ( i < toSplit.length-1 )
					to += ',';
			 }
			 to += ']';
		 } 
	     else {
			 to = '';
		 }

		 document.getElementById('todiv').innerHTML = '';
		 $('#todiv').append( $("<input type='text' id='toInput' name='toInput' class='form-control' value='' style='width:80%'/>") );

		 document.getElementById('toInput').value = to;
		 $('#toInput').multiple_emails({position: "bottom"});

		 document.getElementById('subjectx').value = subject;

         $dialogContent.dialog({
            modal: true,
            title: 'Email',
			width: 1100,
			height: 600,
            close: function() {
               $dialogContent.dialog("destroy");
               $dialogContent.hide();
            },
			open: function() {
				document.getElementById('msgbody').focus();
			},
            buttons: {
			   Send : function() {
				   
				   
				var data = 'cmd=send&subjectx=' + escape(document.getElementById('subjectx').value);
				data += '&from=' + escape(document.getElementById('from').value);
				data += '&body=' + escape(document.getElementById('msgbody').value);
				data += '&to=' + escape( document.getElementById('toInput').value );
				
				   
				$.ajax({
					type: "POST",
					url: "modules/plugins/webmail/webmail_cmd.jsp",
					data: data,

					success: function (data) {
						if ( data != null && data.indexOf("Success") != -1 )
						{
							xdInfo("Email sent");
							$dialogContent.dialog("close");					
							ticketUuid = "";
						}
						else
						{
							xdError( "Error: " + data );
						}
					},
					error: function (XMLHttpRequest, textStatus, errorThrown) {
						console.log( textStatus );
					}
				});
				   
			   },
               Cancel : function() {
                  $dialogContent.dialog("close");
				  ticketUuid = "";
               }
            }
         }).show();

         $(window).resize().resize();	
}

</script>


	<div id="event_new_container" style="background: white; display:none; width:90%">
		<form>
					<div class="messageItemHeader" style="font-family: seri; ">
				
					<span class="flagParent g-ui-user-select-none"><i class="icon-star-empty flagOff" data-bind="css: {&#39;icon-star flagOn&#39;: viewIsFlagged, &#39;icon-star-empty flagOff&#39;: !viewIsFlagged()}" style="padding-top: 2px;"></i></span>
					<b style="color: red; margin-right: 5px; display: none;" data-bind="visible: viewIsImportant">!</b>

					<div style="width: 100%">
						<div style="float:left">
							<img class="fromPic" src="./edit_files/blank_profile.png">
						</div>
						<div style="float:left; display:inline; width:85%">
							<span class="fromMsg"><b>From:</b> </span><select id="from" name="from" style="width:60%; max-width:350px; margin-left:5px">
							<option value="07064c48bbec4eea9c8dbf5a84dc84b4">jareddubin@gmail.com</option>
</select>								
							<span class="emailTemplate"> <b>Email Template:</b>
								<select name="emailTemplate" id="emailTemplate" style="width:150px" onfocus="loadEmailTemplates(&#39;emailTemplate&#39;)">
								</select>
								<button onclick="loadEmailTemplateText(); return false;">Load</button>
							</span>
							<br>
							<span class="fromMsg"><b>To  :</b> </span>
							<div id="todiv" style="display:inline-block">
								<input type="text" id="toInput" name="toInput" class="form-control" value="" style="width:80%">
							</div>

							<div>
							    <span class="fromMsg"><b>Subject:</b></span><input type="text" id="subjectx" style="width:60%; margin-left:5px" maxlength="50"><br>
							</div>
						</div>
					</div>
					<br>
				
				<div style="width: 100%; float:left; padding 2px 5px 5px 5px;">
					<textarea id="msgbody" style="width:100%; height:390px"></textarea>
				</div>
		
	</div></form>



	

					

</div></div><div class="hiddendiv common"></div></body></html>